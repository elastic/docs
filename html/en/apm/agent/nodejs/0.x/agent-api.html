<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Agent API
        | APM Node.js Agent Reference (Beta) [0.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="APM Node.js Agent Reference (Beta) [0.x]" /><link rel="up" href="api.html" title="API Reference" /><link rel="prev" href="api.html" title="API Reference" /><link rel="next" href="transaction-api.html" title="Transaction API" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/APM Node.js Agent/Reference/0.x" /><meta name="DC.subject" content="APM" /><meta name="DC.identifier" content="0.x" />
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	 

    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="text/javascript">
  // -------------------- set language based on browser language --------------------
  var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/pt/': '/pt/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

  if($.cookie("is_lang_detected") == undefined){
    if(locales[lang] != undefined && locales[lang] != currentlocale){
      locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
      $.cookie("is_lang_detected",true ,{ path: '/'}); 
      window.location = locale_lang_url;
    } 
  }
        
  // --------------------- end of set language based on browser language -----------------
  </script>

	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
<script src="/static/js/elastic-apm-js-base.umd.min.2.1.0.js"></script>


<script type="text/javascript">
  var active;
  
  active = Math.random() < 1 //0.9 
  
  elasticApm.init({
    active: active,
    serviceName: "elastic-co-frontend",
    serverUrl: "https://elastic-co-apm-server.app.elstc.co"
  })

  var pageLoadName
  var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
  var parts = pathname.split('/');

  if (parts.length && parts[1] === 'blog') {
    if (parts.length === 2) {
      pageLoadName =  '/blog';
    }
    else if (parts[2] === 'category') {
      pageLoadName =  '/blog/category';
    }
    else if (parts[2] === 'archive') {
      pageLoadName =  '/blog/archive';
    }
    else {
      pageLoadName =  '/blog/detail';
    }
  }
  else if (parts.length && parts[1] === 'elasticon') {
    if (parts.length === 2) {
      pageLoadName =  '/elasticon';
    }
    else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/overview';
    }
    else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/video';
    }
  }
  else if (parts.length && parts[1] === 'guide') {
    pageLoadName =  '/guide';
  }
  else if (parts.length === 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos';
  }
  else if (parts.length > 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos/detail';
  }
  else if (parts.length > 2 && parts[1] === 'webinars') {
    pageLoadName =  '/webinars/detail';
  }
  else {
    pageLoadName =  window.location.pathname;
  }

  console.log('apm pageLoadName:', pageLoadName, parts)
  elasticApm.setTags({env:"production"});
  elasticApm.setInitialPageLoadName(pageLoadName);
</script>

<!-- Elastic APM -->


    <!-- Header Section -->
    
<header class="header-wrapper">
  



  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <div id="logo">
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/blta09706b1c5cc1e99/elastic-logo-mobile.svg" alt="elastic-logo-mobile">
              </a>
            </div>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>

            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                  
                  <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="#" data-value="/" id="locale-select">English</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/es/" data-value="/es/" id="locale-select">Español</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                  
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <div id="logo">
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt244a845f141977c3/elastic-logo.svg" alt="elastic-logo">
          </a>
        </div>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>

          <li class="hidden-xs lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
              
                
                  
                
              
              <li><a class="" href="#" data-value="/">English</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/es/" data-value="/es/">Español</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at the documentation for a beta release.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Node.js Agent Reference (Beta)
      [0.x]
    </a></span> » <span class="breadcrumb-link"><a href="api.html">API Reference</a></span> » <span class="breadcrumb-node"><code class="literal">Agent</code> API</span></div><div class="navheader"><span class="prev"><a href="api.html">
              « 
              API Reference</a>
           
        </span><span class="next">
           
          <a href="transaction-api.html"><code class="literal">Transaction</code> API
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="agent-api"></a><code class="literal">Agent</code> API<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This is the API documentation for the Elastic APM Node.js Agent.
For getting started,
we recommend that you take a look at our framework specific documentation for either <a class="link" href="express.html" title="Get started with Express">Express</a>, <a class="link" href="hapi.html" title="Get started with hapi">hapi</a>, <a class="link" href="koa.html" title="Get started with Koa">Koa</a>, or <a class="link" href="custom-stack.html" title="Get started with a custom Node.js stack">custom frameworks</a>.</p></div></div><p>The Elastic APM agent for Node.js is a singleton.
You get the agent instance by either requiring <code class="literal">elastic-apm-node</code> or <code class="literal">elastic-apm-node/start</code>.
For details on the two approaches,
see the <a class="link" href="advanced-setup.html" title="Advanced Setup and Configuration">Setup and Configuration</a> guide.</p><p>The agent is also returned by the <code class="literal">start()</code> function,
which allows you to require and start the agent on the same line:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">var apm = require('elastic-apm-node').start(...)</pre></div><p>If you need to access the <code class="literal">Agent</code> in any part of your codebase,
you can simply require <code class="literal">elastic-apm-node</code> to access the already started singleton.
You therefore don’t need to manage or pass around the started <code class="literal">Agent</code> yourself.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-start"></a><code class="literal">apm.start()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.start([options])</pre></div><p>Starts the Elastic APM agent for Node.js and returns itself.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Put the call to this function at the very top of your main app file - before requiring any other modules.</p><p>If you are using Babel calling this function will not have the desired effect.
See the <a class="link" href="advanced-setup.html#es-modules" title="Babel / ES Modules supportedit">Babel / ES Modules support documentation</a> for details.</p></div></div><p>The available configuration options are listed below.
Most configuration options can be set either in the optional <code class="literal">options</code> object,
by using environment variables,
or via the <a class="link" href="advanced-setup.html#agent-configuration-file" title="Agent configuration fileedit">agent configuration file</a>.
Their equivalent environment variable name is listed together with each option.</p><p>Properties on the <code class="literal">options</code> object will always take precedence over environment variables.</p><p>The only required parameter is <a class="link" href="agent-api.html#app-name" title="appName"><code class="literal">appName</code></a>.</p><p>Example usage configuring the agent to only be active in production:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">// Add this to the VERY top of the first file loaded in your app
require('elastic-apm-node').start({
  // Set required app name (allowed characters: a-z, A-Z, 0-9, -, _, and space)
  appName: '',

  // Use if APM Server requires a token
  secretToken: '',

  // Set custom APM Server URL (default: http://localhost:8200)
  serverUrl: '',

  // Only activate the agent if it's running in production
  active: process.env.NODE_ENV === 'production'
})</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="app-name"></a><code class="literal">appName</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_APP_NAME</code>
</li></ul></div><p>Your Elastic APM app name.
Required unless set <a class="link" href="advanced-setup.html#configuring-the-agent" title="Configuring the agentedit">via other means</a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="secret-token"></a><code class="literal">secretToken</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SECRET_TOKEN</code>
</li></ul></div><p>The secret token optionally expected by the APM Server.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="server-url"></a><code class="literal">serverUrl</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">http://localhost:8200</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SERVER_URL</code>
</li></ul></div><p>The URL to where the APM Server is deployed.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="validate-server-cert"></a><code class="literal">validateServerCert</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_VALIDATE_SERVER_CERT</code>
</li></ul></div><p>By default the agent will validate the TLS/SSL certificate of the APM Server if using HTTPS.
You can switch this behavior off by setting this option to <code class="literal">false</code>.
Disabling validation is normally required if using self-signed certificates.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="app-version"></a><code class="literal">appVersion</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_APP_VERSION</code>
</li></ul></div><p>The version of the app currently running.
This could be the version from your <code class="literal">package.json</code> file,
a git commit reference,
or any other string that might help you pinpoint a specific version or deployment.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="active"></a><code class="literal">active</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_ACTIVE</code>
</li></ul></div><p>A boolean specifying if the agent should be active or not.
If active,
the agent will instrument incoming HTTP requests and track errors.
Normally you would not want to run the agent in your development or testing environments.
If you are using the <code class="literal">NODE_ENV</code> environment variable,
you can use this to determine the state:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">var options = {
  active: process.env.NODE_ENV === 'production'
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="instrument"></a><code class="literal">instrument</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_INSTRUMENT</code>
</li></ul></div><p>A boolean specifying if the agent should collect performance metrics for the app.</p><p>Note that both <code class="literal">active</code> and <code class="literal">instrument</code> needs to be <code class="literal">true</code> for instrumentation to be running.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="async-hooks"></a><code class="literal">asyncHooks</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_ASYNC_HOOKS</code>
</li></ul></div><p>A boolean specifying if the agent should use the experimental <a class="ulink" href="https://nodejs.org/api/async_hooks.html" target="_top">Async Hooks</a> API found in Node.js version 8.2.0 and above.
This setting have no effect when running a Node.js version older than 8.2.0.</p><p>If you experience any issues related to using Async Hooks,
please <a class="ulink" href="https://github.com/elastic/apm-agent-nodejs/issues" target="_top">open an issue</a>.</p><p>Note that not all core Node.js API’s can be instrumented without the use of Async Hooks if running Node.js 8 or above.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ignore-urls"></a><code class="literal">ignoreUrls</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Array
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">undefined</code>
</li></ul></div><p>Used to restrict requests to certain URL’s from being instrumented.</p><p>This property should be set to an array containing one or more strings or <code class="literal">RegExp</code> objects.
When an incoming HTTP request is detected,
its URL will be tested against each element in this list.
If an element in the array is a <code class="literal">String</code>,
an exact match will be performed.
If an element in the array is a <code class="literal">RegExp</code> object,
its test function will be called with the URL being tested.</p><p>Example usage:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">require('elastic-apm-node').start({
  ignoreUrls: [
    '/ping',
    /^\/admin\//i,
    new RegExp('^/api/v1')
  ]
})</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ignore-user-agents"></a><code class="literal">ignoreUserAgents</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Array
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">undefined</code>
</li></ul></div><p>Used to restrict requests from certain User-Agents from being instrumented.</p><p>This property should be set to an array containing one or more strings or <code class="literal">RegExp</code> objects.
When an incoming HTTP request is detected,
the User-Agent from the request headers will be tested against each element in this list.
If an element in the array is a <code class="literal">String</code>,
it’s matched against the beginning of the User-Agent.
If an element in the array is a <code class="literal">RegExp</code> object,
its test function will be called with the User-Agent string being tested.</p><p>Example usage:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">require('elastic-apm-node').start({
  ignoreUserAgents: [
    'curl/',
    /pingdom/i,
    new RegExp('Safari/[0-9\.]+')
  ]
})</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="log-body"></a><code class="literal">logBody</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_LOG_BODY</code>
</li></ul></div><p>The HTTP body of incoming HTTP requests is not recorded and sent to the APM Server by default.
If you wish to collect the HTTP request body,
set this config option to <code class="literal">true</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="error-on-aborted-requests"></a><code class="literal">errorOnAbortedRequests</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">false</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_ERROR_ON_ABORTED_REQUESTS</code>
</li></ul></div><p>A boolean specifying if the agent should monitor for aborted TCP connections with un-ended HTTP requests.
An error will be generated and sent to the APM Server if this happens.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="aborted-error-threshold"></a><code class="literal">abortedErrorThreshold</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">25000</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_ABORTED_ERROR_THRESHOLD</code>
</li></ul></div><p>Specify the threshold (in milliseconds) for when an aborted TCP connection with an un-ended HTTP request is considered an error.</p><p>If the <code class="literal">errorOnAbortedRequests</code> property is <code class="literal">false</code>, this property is ignored.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="hostname"></a><code class="literal">hostname</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> OS hostname
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_HOSTNAME</code>
</li></ul></div><p>The OS hostname is automatically logged along with all errors and transactions.
If you want to overwrite this,
use this option.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="log-level"></a><code class="literal">logLevel</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> String
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">'info'</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_LOG_LEVEL</code>
</li></ul></div><p>Set the verbosity level for the agent.
Note that this does not have any influence on the types of errors that are sent to the APM Server.
This only controls how chatty the agent is in your logs.</p><p>Possible levels are: <code class="literal">trace</code>, <code class="literal">debug</code>, <code class="literal">info</code>, <code class="literal">warn</code>, <code class="literal">error</code>, and <code class="literal">fatal</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="logger"></a><code class="literal">logger</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> object
</li></ul></div><p>Set a custom logger, e.g. <a class="ulink" href="https://github.com/trentm/node-bunyan" target="_top">bunyan</a>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">require('elastic-apm-node').start({
  logger: require('bunyan')({ level: 'info' })
})</pre></div><p>If no custom logger is provided,
the agent will use its built-in logger which will log to STDOUT and STDERR depending on the log level.</p><p>The logger should expose the following functions: <code class="literal">trace</code>, <code class="literal">debug</code>,<code class="literal">info</code>, <code class="literal">warn</code>, <code class="literal">error</code>, and <code class="literal">fatal</code>.</p><p>Note that if a custom logger is provided, the <code class="literal">logLevel</code> option will be ignored.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="capture-exceptions"></a><code class="literal">captureExceptions</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_CAPTURE_EXCEPTIONS</code>
</li></ul></div><p>Whether or not the agent should monitor for uncaught exceptions and send them to the APM Server automatically.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="capture-trace-stack-traces"></a><code class="literal">captureTraceStackTraces</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_CAPTURE_TRACE_STACK_TRACES</code>
</li></ul></div><p>Set this option to <code class="literal">false</code> to disable capture of stack traces for measured traces during instrumentation.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="source-context-error"></a><code class="literal">sourceContextErrorAppFrames</code> + <code class="literal">sourceContextErrorLibraryFrames</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When an error is captured by the agent,
its stack trace is stored in Elasticsearch.</p><p>By default the agent will also collect a few lines of source code around the lines for each frame in the stack trace.
This can make it easier to determine the cause of an error as the source code related to the error is visible directly in Kibana.</p><p>The agent differentiates between so called in-app frames and library frames.
Library frames are frames belonging to Node core and code inside the applications <code class="literal">node_modules</code> folder.
In-app frames are everything else.</p><p>Use the following two config options to change how many lines of source code to include for the different types of stack frames:</p><p><a id="source-context-error-app-frames"></a><span class="strong strong"><strong><code class="literal">sourceContextErrorAppFrames</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">5</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SOURCE_CONTEXT_ERROR_APP_FRAMES</code>
</li></ul></div><p>The default value <code class="literal">5</code> means that 5 lines of source code will be collected for in-app error frames.
2 lines above the stack frame line + 2 below + the stack frame line it self.</p><p>Setting this config option to <code class="literal">0</code> means that no source code will be collected for in-app error frames.</p><p><a id="source-context-error-library-frames"></a><span class="strong strong"><strong><code class="literal">sourceContextErrorLibraryFrames</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">5</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SOURCE_CONTEXT_ERROR_LIBRARY_FRAMES</code>
</li></ul></div><p>The default value <code class="literal">5</code> means that 5 lines of source code will be collected for error library frames.
2 lines above the stack frame line + 2 below + the stack frame line it self.</p><p>Setting this config option to <code class="literal">0</code> means that no source code will be collected for error library frames.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="source-context-trace"></a><code class="literal">sourceContextTraceAppFrames</code> + <code class="literal">sourceContextTraceLibraryFrames</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When a trace is recorded by the agent,
a stack trace is recorded together with the trace,
pointing to the location where the trace was initiated.
This stack trace is stored in Elasticsearch along with the other trace data.</p><p>By default the agent will also collect a few lines of source code around the lines for each frame in the stack trace.
This can make it easier to determine why and how the trace was initiated as the source code related to the trace is visible directly in Kibana.</p><p>The agent differentiates between so called in-app frames and library frames.
Library frames are frames belonging to Node core and code inside the applications <code class="literal">node_modules</code> folder.
In-app frames are everything else.</p><p>Use the following two config options to change how many lines of source code to include for the different types of stack frames:</p><p><a id="source-context-trace-app-frames"></a><span class="strong strong"><strong><code class="literal">sourceContextTraceAppFrames</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">5</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SOURCE_CONTEXT_TRACE_APP_FRAMES</code>
</li></ul></div><p>The default value <code class="literal">5</code> means that 5 lines of source code will be collected for in-app trace frames.
2 lines above the stack frame line + 2 below + the stack frame line it self.</p><p>Setting this config option to <code class="literal">0</code> means that no source code will be collected for in-app trace frames.</p><p><a id="source-context-trace-library-frames"></a><span class="strong strong"><strong><code class="literal">sourceContextTraceLibraryFrames</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">0</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_SOURCE_CONTEXT_TRACE_LIBRARY_FRAMES</code>
</li></ul></div><p>The default value <code class="literal">0</code> means that no source code will be collected for trace library frames.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="stack-trace-limit"></a><code class="literal">stackTraceLimit</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">50</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_STACK_TRACE_LIMIT</code>
</li></ul></div><p>Setting it to <code class="literal">0</code> will disable stack trace collection.
Any finite integer value will be used as the maximum number of frames to collect.
Setting it to <code class="literal">Infinity</code> means that all frames will be collected.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="flush-interval"></a><code class="literal">flushInterval</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">10</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_FLUSH_INTERVAL</code>
</li></ul></div><p>The agent maintains an in-memory queue to which recorded transactions are added when they end.
Unless empty,
this queue is flushed and sent to the APM Server for processing approximately every 60 seconds.</p><p>Use this option to change that interval.
The value is expected to be in seconds.</p><p>Lowering this interval can reduce memory usage on Node.js applications with a high number of transactions.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The queue is flushed approximately 5 seconds after the first transaction has ended on a newly started Node process.</p><p>This ensures that you don’t have to wait for the entire <code class="literal">flushInterval</code> to pass for the first data to be sent to the APM Server.
From there on the <code class="literal">flushInterval</code> option is used.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>After each flush of the queue,
the next flush isn’t scheduled until a transaction have ended.</p><p>This is done to introduce variance and also ensures that empty queues are not scheduled for flushing.</p><p>On top of that,
the actual interval is ajusted by +/- 5% between each flush.</p><p>This all helps to ensure that multiple servers started at the same time will not establish connections to the APM Server simultaneously.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="max-queue-size"></a><code class="literal">maxQueueSize</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Number
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">-1</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_MAX_QUEUE_SIZE</code>
</li></ul></div><p>The agent maintains an in-memory queue to which recorded transactions are added when they end.
The queue is flushed with regular intervals controlled by the <a class="link" href="agent-api.html#flush-interval" title="flushInterval"><code class="literal">flushInterval</code></a> config option.</p><p>Use the <code class="literal">maxQueueSize</code> option to force a flush of the queue when it reaches a certain size (number of ended transactions) - even if the <code class="literal">flushInterval</code> time isn’t reached yet.</p><p>Set to <code class="literal">-1</code> to disable,
in which case only <code class="literal">flushInterval</code> counts.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="filter-http-headers"></a><code class="literal">filterHttpHeaders</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong strong"><strong>Type:</strong></span> Boolean
</li><li class="listitem">
<span class="strong strong"><strong>Default:</strong></span> <code class="literal">true</code>
</li><li class="listitem">
<span class="strong strong"><strong>Env:</strong></span> <code class="literal">ELASTIC_APM_FILTER_HTTP_HEADERS</code>
</li></ul></div><p>A boolean specifying if the agent should anonymize certain sensitive HTTP headers by default before they are sent to the APM Server.
When anonymized,
the header value will be set to <code class="literal">[REDACTED]</code></p><p>Currently the following HTTP headers are anonymized by default:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">Authorization</code> - The full value of this header is redacted
</li><li class="listitem">
<code class="literal">Cookie</code> - The cookies inside the <code class="literal">Cookie</code> header are analyzed and their values redacted if they appear sensitive (like a session cookie).
See the <a class="ulink" href="https://github.com/watson/is-secret" target="_top">is-secret</a> module for details about which patterns are considered sensitive.
</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-add-filter"></a><code class="literal">apm.addFilter()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.addFilter(callback)</pre></div><p>Use <code class="literal">addFilter()</code> to supply a filter function.</p><p>Each filter function will be called just before data is being sent to the APM Server.
This will allow you to manipulate the data being sent,
for instance to remove sensitive information like passwords etc.</p><p>Each filter function will be called in the order they were added,
and will receive a <code class="literal">payload</code> object as the only argument,
containing the data about to be sent to the APM Server.</p><p>For details on the format of the payload,
see the <a class="ulink" href="https://github.com/elastic/apm-server/tree/master/docs/spec" target="_top">intake API JSON Schema</a> for the APM Server.</p><p>The filter function is synchronous and should return the manipulated payload object.
If a filter function doesn’t return any value or returns a falsy value,
the remaining filter functions will not be called and the payload <span class="strong strong"><strong>will not</strong></span> be sent to the APM Server.</p><p>Example usage:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.addFilter(function (payload) {
  if (payload.context.request &amp;&amp; payload.context.request.headers) {
    // remove sensitive data
    delete payload.context.request.headers['x-secret-data']
  }

  // remember to return the modified payload
  return payload
})</pre></div><p>A set of built-in filters are added by default.
See <a class="link" href="agent-api.html#filter-http-headers" title="filterHttpHeaders"><code class="literal">filterHttpHeaders</code></a> for details.</p><p>Though you can also use filter functions to add new contextual information to the <code class="literal">user</code> and <code class="literal">custom</code> properties,
it’s recommended that you use <a class="link" href="agent-api.html#apm-set-user-context" title="apm.setUserContext()"><code class="literal">apm.setUserContext()</code></a> and <a class="link" href="agent-api.html#apm-set-custom-context" title="apm.setCustomContext()"><code class="literal">apm.setCustomContext()</code></a> for that purpose.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-set-user-context"></a><code class="literal">apm.setUserContext()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.setUserContext(context)</pre></div><p>Call this to enrich collected performance data and errors with information about the user/client.
This function can be called at any point during the request/response life cycle (i.e. while a transaction is active).</p><p>The given <code class="literal">context</code> argument must be an object and can contain the following properties (all optional):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">id</code> - The users ID
</li><li class="listitem">
<code class="literal">username</code> - The users username
</li><li class="listitem">
<code class="literal">email</code> - The users e-mail
</li></ul></div><p>The given <code class="literal">context</code> will be added to the active transaction.
If no active transaction can be found,
<code class="literal">false</code> is returned.
Otherwise <code class="literal">true</code>.</p><p>It’s possible to call this function multiple times within the scope of the same active transaction.
For each call, the properties of the <code class="literal">context</code> argument are shallow merged with the context previously given.</p><p>If an error is captured,
the context from the active transaction is used as context for the captured error,
and any custom context given as the 2nd argument to <a class="link" href="agent-api.html#apm-capture-error" title="apm.captureError()"><code class="literal">apm.captureError</code></a> takes precedence and is shallow merged on top.</p><p>The provided user context is stored under <code class="literal">context.user</code> in Elasticsearch on both errors and transactions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-set-custom-context"></a><code class="literal">apm.setCustomContext()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.setCustomContext(context)</pre></div><p>Call this to enrich collected errors and transactions with any information that you think will help you debug performance issues or errors.
This function can be called at any point while a transaction is active (e.g. during the request/response life cycle of an incoming HTTP request).</p><p>The provided custom context is stored under <code class="literal">context.custom</code> in Elasticsearch on both errors and transactions.</p><p>The given <code class="literal">context</code> argument must be an object and can contain any property that can be JSON encoded.</p><p>The given <code class="literal">context</code> will be added to the active transaction.
If no active transaction can be found,
<code class="literal">false</code> is returned.
Otherwise <code class="literal">true</code>.</p><p>It’s possible to call this function multiple times within the scope of the same active transaction.
For each call, the properties of the <code class="literal">context</code> argument are shallow merged with the context previously given.</p><p>If an error is captured,
the context from the active transaction is used as context for the captured error,
and any custom context given as the 2nd argument to <a class="link" href="agent-api.html#apm-capture-error" title="apm.captureError()"><code class="literal">apm.captureError</code></a> takes precedence and is shallow merged on top.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-set-tag"></a><code class="literal">apm.setTag()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.setTag(name, value)</pre></div><p>Set a tag on the current transaction.
You can set multiple tags on the same transaction.
If an error happens during the current transaction,
it will also get tagged with the same tags.</p><p>Tags are key/value pairs that are indexed by Elasticsearch and therefore searchable (as opposed to data set via <code class="literal">setCustomContext()</code>).</p><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">name</code> - Any string.
Must not contain periods (<code class="literal">.</code>) as those have special meaning in Elasticsearch
</li><li class="listitem">
<code class="literal">value</code> - Any string.
If a non-string data type is given,
it’s converted to a string before being sent to the APM Server
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-capture-error"></a><code class="literal">apm.captureError()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError(error[, options][, callback])</pre></div><p>Send an error to the APM Server:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError(new Error('boom!'))</pre></div><p>The <code class="literal">error</code> argument can be either an <code class="literal">Error</code> object,
a <a class="link" href="agent-api.html#message-strings" title="Message strings">message string</a>,
or a <a class="link" href="agent-api.html#parameterized-message-object" title="Parameterized message object">special parameterized message object</a>.</p><p>The optional <code class="literal">options</code> object can be used to log additional metadata with the error.
For details see the <a class="link" href="agent-api.html#metadata" title="Metadata">metadata section</a>.</p><p>The optional <code class="literal">callback</code> will be called after the error has been sent to the APM Server.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="message-strings"></a>Message strings<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Instead of an <code class="literal">Error</code> object,
you can log a plain text message:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError('Something happened!')</pre></div><p>This will also be sent as an error to the APM Server,
but will not be associated with an exception.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="parameterized-message-object"></a>Parameterized message object<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Instead of an <code class="literal">Error</code> object or a string,
you can supply a special parameterized message object:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError({
  message: 'Could not find user %s with id %d in the database',
  params: ['Peter', 42]
})</pre></div><p>This makes it possible to better group error messages that contain variable data like ID’s or names.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="metadata"></a>Metadata<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>To ease debugging it’s possible to send some extra data with each error you send to the APM Server.
The APM Server intake API supports a lot of different metadata fields,
most of which are automatically managed by the Elastic APM Node.js Agent.
But if you wish you can supply some extra details using <code class="literal">user</code> or <code class="literal">custom</code>.
For more details on the properties accepted by the error intake API see the <a class="ulink" href="https://www.elastic.co/guide/en/apm/server/current/error-api.html" target="_top">intake error API docs</a>.</p><p>To supply any of these extra fields,
use the optional options argument when calling <code class="literal">apm.captureError()</code>.</p><p>Here are some examples:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">// Sending some extra details about the user
apm.captureError(error, {
  user: {
    id: 'unique_id',
    username: 'foo',
    email: 'foo@example.com'
  }
})

// Sending some arbitrary details using the `custom` field
apm.captureError(error, {
  custom: {
    some_important_metric: 'foobar'
  }
})</pre></div><p>To supply per-request metadata to all errors captured in one central location,
use <a class="link" href="agent-api.html#apm-set-user-context" title="apm.setUserContext()"><code class="literal">apm.setUserContext()</code></a> and <a class="link" href="agent-api.html#apm-set-custom-context" title="apm.setCustomContext()"><code class="literal">apm.setCustomContext()</code></a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="http-requests"></a>HTTP requests<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Besides the options described in the <a class="link" href="agent-api.html#metadata" title="Metadata">metadata section</a>,
you can use the <code class="literal">options</code> argument to associate the error with an HTTP request:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError(err, {
  request: req // an instance of http.IncomingMessage
})</pre></div><p>This will log the URL that was requested,
the HTTP headers,
cookies and other useful details to help you debug the error.</p><p>In most cases this isn’t needed though,
as the agent is pretty smart at figuring out if your Node.js app is an HTTP server and if an error occurred during an incoming request.
In which case it will automate this processes for you.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="http-responses"></a>HTTP responses<a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Besides the options described in the <a class="link" href="agent-api.html#metadata" title="Metadata">metadata section</a>,
you can use the <code class="literal">options</code> argument to associate the error with an HTTP response:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.captureError(err, {
  response: res // an instance of http.ServerResponse
})</pre></div><p>This will log the response status code,
headers and other useful details to help you debug the error.</p><p>In most cases this isn’t needed though,
as the agent is pretty smart at figuring out if your Node.js app is an HTTP server and if an error occurred during an incoming request.
In which case it will automate this processes for you.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-middleware-connect"></a><code class="literal">apm.middleware.connect()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.middleware.connect()</pre></div><p>Returns a middleware function used to collect and send errors to the APM Server.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">var apm = require('elastic-apm-node').start()
var connect = require('connect')

var app = connect()

// your regular middleware:
app.use(...)
app.use(...)

// your main HTTP router
app.use(function (req, res, next) {
  throw new Error('Broke!')
})

// add Elastic APM in the bottom of the middleware stack
app.use(apm.middleware.connect())

app.listen(3000)</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">apm.middleware.connect</code> <span class="emphasis"><em>must</em></span> be added to the middleware stack <span class="emphasis"><em>before</em></span> any other error handling middleware functions or there’s a chance that the error will never get to the agent.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-start-transaction"></a><code class="literal">apm.startTransaction()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">var transaction = apm.startTransaction([name][, type])</pre></div><p>Start a new transaction.</p><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">name</code> - The name of the transaction (string).
You can always set this later via <a class="link" href="transaction-api.html#transaction-name" title="transaction.name"><code class="literal">transaction.name</code></a> or <a class="link" href="agent-api.html#apm-set-transaction-name" title="apm.setTransactionName()"><code class="literal">apm.setTransactionName()</code></a>.
Defaults to <code class="literal">unnamed</code>
</li><li class="listitem">
<code class="literal">type</code> - The type of transaction (string).
You can always set this later via <a class="link" href="transaction-api.html#transaction-type" title="transaction.type"><code class="literal">transaction.type</code></a>.
Defaults to <code class="literal">custom</code>
</li></ul></div><p>Use this function to create a custom transaction.
Note that the agent will do this for you automatically when ever your application receives an incoming HTTP request.
You only need to use this function to create custom transactions.</p><p>There’s a special <code class="literal">type</code> called <code class="literal">request</code> which is used by the agent for the transactions automatically created when an incoming HTTP request is detected.</p><p>See the <a class="link" href="transaction-api.html" title="Transaction API">Transaction API</a> docs for details on how to use custom transactions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-end-transaction"></a><code class="literal">apm.endTransaction()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.endTransaction()</pre></div><p>Ends the active transaction.
If no transaction is currently active,
nothing happens.</p><p>Note that the agent will do this for you automatically for all regular HTTP transactions.
You only need to use this function to end custom transactions created by <a class="link" href="agent-api.html#apm-start-transaction" title="apm.startTransaction()"><code class="literal">apm.startTransaction()</code></a> or if you wish the end a regular transaction prematurely.</p><p>Alternatively you can call <a class="link" href="transaction-api.html#transaction-end" title="transaction.end()"><code class="literal">end()</code></a> directly on an active transaction object.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-set-transaction-name"></a><code class="literal">apm.setTransactionName()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.setTransactionName(name)</pre></div><p>Set or overwrite the name of the current transaction.
The <code class="literal">name</code> argument must be a string.</p><p>If you use a supported router/framework the agent will automatically set the transaction name for you.</p><p>If you do not use Express, hapi, or koa-router or if the agent for some reason cannot detect the name of the HTTP route,
the transaction name will default to <code class="literal">METHOD unknown route</code> (e.g. <code class="literal">POST unknown route</code>).</p><p>Read more about naming routes manually in the <a class="link" href="custom-stack.html#custom-stack-route-naming" title="Route namingedit">Get started with a custom Node.js stack</a> article.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-build-trace"></a><code class="literal">apm.buildTrace()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">var trace = apm.buildTrace()</pre></div><p>Prepare and return a new custom trace associated with the current active transaction.</p><p>See <a class="link" href="trace-api.html" title="Trace API">Trace API</a> docs for details on how to use custom traces.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If there’s no active transaction available,
<code class="literal">null</code> will be returned.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-handle-uncaught-exceptions"></a><code class="literal">apm.handleUncaughtExceptions()</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.handleUncaughtExceptions([callback])</pre></div><p>By default the agent will terminate the Node.js process when an uncaught exception is detected.
Use this function if you need to run any custom code before the process is terminated.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.handleUncaughtExceptions(function (err) {
  // Do your own stuff... and then exit:
  process.exit(1)
})</pre></div><p>The callback is called <span class="strong strong"><strong>after</strong></span> the event has been sent to the APM Server with the following arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">err</code> - the captured exception
</li></ul></div><p>This function will also enable the uncaught exception handler if it was disabled using the <a class="link" href="agent-api.html#capture-exceptions" title="captureExceptions"><code class="literal">captureExceptions</code></a> configuration option.</p><p>If you don’t specify a callback,
the node process is terminated automatically when an uncaught exception has been captured and sent to the APM Server.</p><p><a class="ulink" href="https://nodejs.org/api/process.html#process_event_uncaughtexception" target="_top">It is recommended</a> that you don’t leave the process running after receiving an uncaught exception,
so if you are using the optional callback,
remember to terminate the node process.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="apm-flush"></a><code class="literal">apm.flush([callback])</code><a href="https://github.com/elastic/apm-agent-nodejs/edit/0.x/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">apm.flush(function (err) {
  // Flush complete
})</pre></div><p>Manually flush the in-memory transaction queue and send all the transactions to the APM Server.
The queue is otherwise flushed automatically,
controlled by the <a class="link" href="agent-api.html#flush-interval" title="flushInterval"><code class="literal">flushInterval</code></a> and/or <a class="link" href="agent-api.html#max-queue-size" title="maxQueueSize"><code class="literal">maxQueueSize</code></a> config options.</p><p>The callback is called <span class="strong strong"><strong>after</strong></span> the event has been sent to the APM Server with the following arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">err</code> - the captured exception
</li></ul></div></div></div><div class="navfooter"><span class="prev"><a href="api.html">
              « 
              API Reference</a>
           
        </span><span class="next">
           
          <a href="transaction-api.html"><code class="literal">Transaction</code> API
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack">Stack Features (formerly X-Pack)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/security">Security</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/alerting">Alerting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/canvas">Canvas</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/monitoring">Monitoring</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/elasticsearch-sql">Elasticsearch SQL</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">Elasticsearch-Hadoop</a></li>
                  
                
              
                
                  
                    <li><a href="/products/ece">Elastic Cloud Enterprise</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
              
                <h3><a href="/cloud">Elastic Cloud ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/cloud/elasticsearch-service">Elasticsearch Service</a></li>
                  
                
              
                
                  
                    <li><a href="/aws-elasticsearch-service">AWS Elasticsearch Service Comparison</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/app-search-service">Elastic App Search Service</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/site-search-service">Elastic Site Search Service</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
              
                <h3></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/about/our-source-code">Our Source Code</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams">Teams</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/board">Board of Directors</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/history-of-elasticsearch">Our Story</a></li>
                  
                
              
                
                  
                    <li><a href="/about/why-open-source">Why Open Source</a></li>
                  
                
              
                
                  
                    <li><a href="/about/distributed">Distributed by Intention</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Media</a></li>
                  
                
              
                
                  
                    <li><a href="https://ir.elastic.co">Investor Relations</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="Facebook"><a id="footer_facebook" href="https://www.facebook.com/elastic.co">Facebook</a></li>
          
          		 	<li class="Twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic">Twitter</a></li>
          
          		 	<li class="LinkedIn"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co">LinkedIn</a></li>
          
          		 	<li class="Xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co">Xing</a></li>
          
          		 	<li class="YouTube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch">YouTube</a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-statement">Privacy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-text">
					<p>© 2018. Elasticsearch B.V. All Rights Reserved
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
