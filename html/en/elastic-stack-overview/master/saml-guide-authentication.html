<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configure Elasticsearch for SAML authentication
        | Elastic Stack Overview [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [master]" /><link rel="up" href="saml-guide.html" title="Configuring SAML single-sign-on on the Elastic Stack" /><link rel="prev" href="saml-guide-idp.html" title="The identity provider" /><link rel="next" href="saml-sp-metadata.html" title="Generating SP metadata" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/master" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="master" />
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	 

    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="text/javascript">
  // -------------------- set language based on browser language --------------------
  var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

  if($.cookie("is_lang_detected") == undefined){
    if(locales[lang] != undefined && locales[lang] != currentlocale){
      locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
      $.cookie("is_lang_detected",true ,{ path: '/'}); 
      window.location = locale_lang_url;
    } 
  }
        
  // --------------------- end of set language based on browser language -----------------
  </script>

	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
<script src="/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>


<script type="text/javascript">
  var active;
  
  active = Math.random() < 1 //0.9 
  
  elasticApm.init({
    active: active,
    serviceName: "elastic-co-frontend",
    serverUrl: "https://elastic-co-apm-server.app.elstc.co"
  })

  var pageLoadName
  var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
  var parts = pathname.split('/');

  if (parts.length && parts[1] === 'blog') {
    if (parts.length === 2) {
      pageLoadName =  '/blog';
    }
    else if (parts[2] === 'category') {
      pageLoadName =  '/blog/category';
    }
    else if (parts[2] === 'archive') {
      pageLoadName =  '/blog/archive';
    }
    else {
      pageLoadName =  '/blog/detail';
    }
  }
  else if (parts.length && parts[1] === 'elasticon') {
    if (parts.length === 2) {
      pageLoadName =  '/elasticon';
    }
    else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/overview';
    }
    else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/video';
    }
  }
  else if (parts.length && parts[1] === 'guide') {
    pageLoadName =  '/guide';
  }
  else if (parts.length === 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos';
  }
  else if (parts.length > 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos/detail';
  }
  else if (parts.length > 2 && parts[1] === 'webinars') {
    pageLoadName =  '/webinars/detail';
  }
  else {
    pageLoadName =  window.location.pathname;
  }

  console.log('apm pageLoadName:', pageLoadName, parts)
  elasticApm.setTags({env:"production"});
  elasticApm.setInitialPageLoadName(pageLoadName);
</script>

<!-- Elastic APM -->


    <!-- Header Section -->
    
<header class="header-wrapper">
  



  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <div id="logo">
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/blta09706b1c5cc1e99/elastic-logo-mobile.svg" alt="elastic-logo-mobile">
              </a>
            </div>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>

            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                  
                  <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="#" data-value="/" id="locale-select">English</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/es/" data-value="/es/" id="locale-select">Español</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                  
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <div id="logo">
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt244a845f141977c3/elastic-logo.svg" alt="elastic-logo">
          </a>
        </div>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>

          <li class="hidden-xs lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
              
                
                  
                
              
              <li><a class="" href="#" data-value="/">English</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/es/" data-value="/es/">Español</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="elasticsearch-security.html">Securing the Elastic Stack</a></span> » <span class="breadcrumb-link"><a href="saml-guide.html">Configuring SAML single-sign-on on the Elastic Stack</a></span> » <span class="breadcrumb-node">Configure Elasticsearch for SAML authentication</span></div><div class="navheader"><span class="prev"><a href="saml-guide-idp.html">
              « 
              The identity provider</a>
           
        </span><span class="next">
           
          <a href="saml-sp-metadata.html">Generating SP metadata
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="saml-guide-authentication"></a>Configure Elasticsearch for SAML authentication<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>There are five configuration steps to enable SAML authentication in Elasticsearch:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<a class="link" href="saml-guide-authentication.html#saml-enable-http" title="Enable TLS for HTTP">Enable SSL/TLS for HTTP</a>
</li><li class="listitem">
<a class="link" href="saml-guide-authentication.html#saml-enable-token" title="Enable the token service">Enable the Token Service</a>
</li><li class="listitem">
<a class="link" href="saml-guide-authentication.html#saml-create-realm" title="Create a SAML realm">Create one or more SAML realms</a>
</li><li class="listitem">
<a class="link" href="saml-role-mapping.html" title="Configuring role mappings">Configure role mappings</a>
</li><li class="listitem">
Generate a SAML Metadata file for use by your Identity Provider <span class="emphasis"><em>(optional)</em></span>
</li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-enable-http"></a>Enable TLS for HTTP<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If your Elasticsearch cluster is operating in production mode, then you must
configure the HTTP interface to use SSL/TLS before you can enable SAML
authentication.</p><p>For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/configuring-tls.html#tls-http" target="_top">Encrypting HTTP Client Communications</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-enable-token"></a>Enable the token service<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Elasticsearch SAML implementation makes use of the Elasticsearch Token Service.  This service
is automatically enabled if you configure TLS on the HTTP interface, and can be
explicitly configured by including the following in your <code class="literal">elasticsearch.yml</code> file:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">xpack.security.authc.token.enabled: true</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-create-realm"></a>Create a SAML realm<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>SAML authentication is enabled by configuring a SAML realm within the
authentication chain for Elasticsearch.</p><p>This realm has a few mandatory settings, and a number of optional settings.
The available settings are described in detail in the
<a class="link" href="saml-realm.html#saml-settings" title="SAML realm settings">SAML realm documentation</a>, this guide will walk you through
the most common settings.</p><p>Create a realm by adding the following to your <code class="literal">elasticsearch.yml</code>
configuration file. Each configuration value is explained below.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.saml.saml1:
  order: 2
  idp.metadata.path: saml/idp-metadata.xml
  idp.entity_id: "https://sso.example.com/"
  sp.entity_id:  "https://kibana.example.com/"
  sp.acs: "https://kibana.example.com/api/security/v1/saml"
  sp.logout: "https://kibana.example.com/logout"
  attributes.principal: "urn:oid:0.9.2342.19200300.100.1.1"
  attributes.groups: "urn:oid:1.3.6.1.4.1.5923.1.5.1."</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>SAML is used when authenticating via Kibana, but it is not an
effective means of authenticating directly to the Elasticsearch REST API. For this reason
we recommend that you include at least one additional realm such as the
<a class="link" href="native-realm.html" title="Native user authentication">native realm</a> in your authentication chain for use by API
clients.</p></div></div><p>The configuration values used in the example above are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
xpack.security.authc.realms.saml.saml1
</span></dt><dd>
    This defines a new <code class="literal">saml</code> authentication realm named "saml1".
    See <a class="xref" href="realms.html" title="Realms">Realms</a> for more explanation of realms.
</dd><dt><span class="term">
order
</span></dt><dd>
    You should define a unique order on each realm in your authentication chain.
    It is recommended that the SAML realm be at the bottom of your authentication
    chain (that is, that it has the <span class="emphasis"><em>highest</em></span> order).
</dd><dt><span class="term">
idp.metadata.path
</span></dt><dd>
    This is the path to the metadata file that you saved for your Identity Provider.
    The path that you enter here is relative to your <code class="literal">config/</code> directory.
    Elasticsearch will automatically monitor this file for changes and will
    reload the configuration whenever it is updated.
</dd><dt><span class="term">
idp.entity_id
</span></dt><dd>
    This is the identifier (SAML EntityID) that your IdP uses.
    It should match the <code class="literal">entityID</code> attribute within the metadata file.
</dd><dt><span class="term">
sp.entity_id
</span></dt><dd>
    This is a unique identifier for your Kibana instance, expressed as a URI.
    You will use this value when you add Kibana as a service provider within your IdP.
    We recommend that you use the base URL for your Kibana instance as the entity ID.
</dd><dt><span class="term">
sp.acs
</span></dt><dd>
    The <span class="emphasis"><em>Assertion Consumer Service</em></span> (ACS) endpoint is the URL within Kibana that accepts
    authentication messages from the IdP.
    This ACS endpoint supports the SAML HTTP-POST binding only.
    It must be a URL that is accessible from the web browser of the user who is
    attempting to login to Kibana, it does not need to be directly accessible by Elasticsearch
    or the IdP.
    The correct value may vary depending on how you have installed Kibana and
    whether there are any proxies involved, but it will typically be
    <code class="literal">${kibana-url}/api/security/v1/saml</code> where <span class="emphasis"><em>${kibana-url}</em></span> is the base URL for
    your Kibana instance.
</dd><dt><span class="term">
sp.logout
</span></dt><dd>
    This is the URL within Kibana that accepts logout messages from the IdP.
    Like the <code class="literal">sp.acs</code> URL, it must be accessible from the web browser, but does
    not need to be directly accessible by Elasticsearch or the IdP. The correct value may
    vary depending on how you have installed Kibana and whether there are any
    proxies involved, but it will typically be <code class="literal">${kibana-url}/logout</code> where
    <span class="emphasis"><em>${kibana-url}</em></span> is the base URL for your Kibana instance.
</dd><dt><span class="term">
attribute.principal
</span></dt><dd>
See <a class="xref" href="saml-guide-authentication.html#saml-attribute-mapping" title="Attribute mapping">Attribute mapping</a>.
</dd><dt><span class="term">
attribute.groups
</span></dt><dd>
See <a class="xref" href="saml-guide-authentication.html#saml-attribute-mapping" title="Attribute mapping">Attribute mapping</a>.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-attribute-mapping"></a>Attribute mapping<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When a user connects to Kibana through your Identity Provider, the Identity
Provider will supply a SAML Assertion about the user. The assertion will contain
an <span class="emphasis"><em>Authentication Statement</em></span> indicating that the user has successfully
authenticated to the IdP and one or more <span class="emphasis"><em>Attribute Statements</em></span> that will
include <span class="emphasis"><em>Attributes</em></span> for the user.</p><p>These attributes may include such things as:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
the user’s username
</li><li class="listitem">
the user’s email address
</li><li class="listitem">
the user’s groups or roles
</li></ul></div><p>Attributes in SAML are named using a URI such as
<code class="literal">urn:oid:0.9.2342.19200300.100.1.1</code> or
<code class="literal">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn</code>, and have one or
more values associated with them.</p><p>These attribute identifiers vary between IdPs, and most IdPs offer ways to
customize the URIs and their associated value.</p><p>Elasticsearch uses these attributes to infer information about the user who has
logged in, and they can be used for role mapping (below).</p><p>In order for these attributes to be useful, Elasticsearch and the IdP need to have a
common value for the names of the attributes. This is done manually, by
configuring the IdP and the SAML realm to use the same URI name for
each logical user attribute.</p><p>The recommended steps for configuring these SAML attributes are as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Consult your IdP to see what user attributes it can provide.
  This varies greatly between providers, but you should be able to obtain a list
  from the documentation, or from your local admin.
</li><li class="listitem">
Read through the list of <a class="link" href="saml-guide-authentication.html#saml-user-properties" title="Elasticsearch user properties">user properties</a> that Elasticsearch
  supports, and decide which of them are useful to you, and can be provided by
  your IdP. At a <span class="emphasis"><em>minimum</em></span>, the <code class="literal">principal</code> attribute is required.
</li><li class="listitem">
Configure your IdP to "release" those attributes to your Kibana SAML service
  provider.  This process varies by provider - some will provide a user interface
  for this, while others may require that you edit configuration files.
  Usually the IdP (or your local administrator) will have suggestions about what
  URI to use for each attribute. You can simply accept those suggestions, as the
  Elasticsearch service is entirely configurable and does not require that any specific
  URIs are used.
</li><li class="listitem">
Configure the SAML realm in Elasticsearch to associate the Elasticsearch user properties (see
  <a class="link" href="saml-guide-authentication.html#saml-user-properties" title="Elasticsearch user properties">the listing</a> below), to the URIs that you configured
  in your IdP. In the example above, we have configured the <code class="literal">principal</code> and
  <code class="literal">groups</code> attributes.
</li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_special_attribute_names"></a>Special attribute names<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In general, Elasticsearch expects that the configured value for an attribute will be a
URI such as <code class="literal">urn:oid:0.9.2342.19200300.100.1.1</code>, however there are some
additional names that can be used:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">nameid</code>
</span></dt><dd>
    This uses the SAML <code class="literal">NamedID</code> value instead of a SAML attribute. SAML
    <code class="literal">NameID</code> elements are an optional, but frequently provided, field within a
    SAML Assertion that the IdP may use to identify the Subject of that
    Assertion. In some cases the <code class="literal">NameID</code> will relate to the user’s login
    identifier (username) wihin the IdP, but in many cases they will be
    internally generated identifiers that have no obvious meaning outside
    of the IdP.
</dd><dt><span class="term">
<code class="literal">nameid:persistent</code>
</span></dt><dd>
    This uses the SAML <code class="literal">NameID</code> value, but only if the NameID format is
    <code class="literal">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</code>.
    A SAML <code class="literal">NameID</code> element has an optional <code class="literal">Format</code> attribute that indicates
    the semantics of the provided name.  It is common for IdPs to be configured
    with "transient" NameIDs that present a new identifier for each session.
    Since it is rarely useful to use a transient NameID as part of an attribute
    mapping, the "nameid:persistent" attribute name can be used as a safety
    mechanism that will cause an error if you attempt to map from a <code class="literal">NameID</code>
    that does not have a persistent value.
</dd><dt><span class="term">
<span class="emphasis"><em>friendlyName</em></span>
</span></dt><dd>
    A SAML attribute may have a <span class="emphasis"><em>friendlyName</em></span> in addition to its URI based name.
    For example the attribute with a name of <code class="literal">urn:oid:0.9.2342.19200300.100.1.1</code>
    might also have a friendlyName of <code class="literal">uid</code>.
    You may use these friendly names within an attribute mapping, but it is
    recommended that you use the URI based names, as friendlyNames are neither
    standardized or mandatory.
</dd></dl></div><p>The example below configures a realm to use a persistent nameid for the principal,
and the attribute with the friendlyName "roles" for the user’s groups.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.saml.saml1:
  order: 2
  idp.metadata.path: saml/idp-metadata.xml
  idp.entity_id: "https://sso.example.com/"
  sp.entity_id:  "https://kibana.example.com/"
  sp.acs: "https://kibana.example.com/api/security/v1/saml"
  attributes.principal: "nameid:persistent"
  attributes.groups: "roles"</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="saml-user-properties"></a>Elasticsearch user properties<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Elasticsearch SAML realm can be configured to map SAML <code class="literal">attributes</code> to the
following properties on the authenticated user:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
principal
</span></dt><dd>
<span class="emphasis"><em>(Required)</em></span>
    This is the <span class="emphasis"><em>username</em></span> that will be applied to a user that authenticates
    against this realm.
    The <code class="literal">principal</code> appears in places such as the Elasticsearch audit logs.
</dd><dt><span class="term">
groups
</span></dt><dd>
<span class="emphasis"><em>(Recommended)</em></span>
    If you wish to use your IdP’s concept of groups or roles as the basis for a
    user’s Elasticsearch privileges, you should map them with this attribute.
    The <code class="literal">groups</code> are passed directly to your
    <a class="link" href="saml-role-mapping.html" title="Configuring role mappings">role mapping rules</a>
</dd><dt><span class="term">
name
</span></dt><dd>
<span class="emphasis"><em>(Optional)</em></span> The user’s full name.
</dd><dt><span class="term">
mail
</span></dt><dd>
<span class="emphasis"><em>(Optional)</em></span> The user’s email address.
</dd><dt><span class="term">
dn
</span></dt><dd>
<span class="emphasis"><em>(Optional)</em></span> The user’s X.500 <span class="emphasis"><em>Distinguished Name</em></span>.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_extracting_partial_values_from_saml_attributes"></a>Extracting partial values from SAML attributes<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>There are some occasions where the IdP’s attribute may contain more information
than you wish to use within Elasticsearch. A common example of this is one where the
IdP works exclusively with email addresses, but you would like the user’s
<code class="literal">principal</code> to use the <span class="emphasis"><em>local-name</em></span> part of the email address.
For example if their email address was <code class="literal">james.wong@staff.example.com</code>, then you
would like their principal to simply be <code class="literal">james.wong</code>.</p><p>This can be achieved using the <code class="literal">attribute_patterns</code> setting in the Elasticsearch
realm, as demonstrated in the realm configuration below:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.saml.saml1:
  order: 2
  idp.metadata.path: saml/idp-metadata.xml
  idp.entity_id: "https://sso.example.com/"
  sp.entity_id:  "https://kibana.example.com/"
  sp.acs: "https://kibana.example.com/api/security/v1/saml"
  attributes.principal: "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"
  attribute_patterns.principal: "^([^@]+)@staff\\.example\\.com$"</pre></div><p>In this case, the user’s <code class="literal">principal</code> is mapped from an email attribute, but a
regular expression is applied to the value before it is assigned to the user.
If the regular expression matches, then the result of the first group is used as
effective value. If the regular expression does not match then the attribute
mapping fails.</p><p>In this example, the email address must belong to the <code class="literal">staff.example.com</code> domain,
and then the local-part (anything before the <code class="literal">@</code>) is used as the principal.
Any users who try to login using a different email domain will fail because the
regular expression will not match against their email address, and thus their
principal attribute - which is mandatory - will not be populated.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Small mistakes in these regular expressions can have significant
security consequences. For example, if we accidentally left off the trailing
<code class="literal">$</code> from the example above, then we would match any email address where the
domain starts with <code class="literal">staff.example.com</code>, and this would accept an email
address such as <code class="literal">admin@staff.example.com.attacker.net</code>. It is important that
you make sure your regular expressions are as precise as possible so that
you do not inadvertently open an avenue for user impersonation attacks.</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="req-authn-context"></a>Requesting specific authentication methods<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is sometimes necessary for a SAML SP to be able to impose specific
restrictions regarding the authentication that will take place at an IdP,
in order to assess the level of confidence that it can place in
the corresponding authentication response. The restrictions might have to do
with the authentication method (password, client certificates, etc), the
user identification method during registration, and other details. Elasticsearch implements
<a class="ulink" href="https://docs.oasis-open.org/security/saml/v2.0/saml-authn-context-2.0-os.pdf" target="_top">SAML 2.0 Authentication Context</a>, which can be used for this purpose as defined in SAML 2.0 Core
Specification.</p><p>In short, the SAML SP defines a set of Authentication Context Class Reference
values, which describe the restrictions to be imposed on the IdP, and sends these
in the Authentication Request. The IdP attempts to grant these restrictions.
If it cannot grant them, the authentication attempt fails. If the user is
successfully authenticated, the Authentication Statement of the SAML Response
contains an indication of the restrictions that were satisfied.</p><p>You can define the Authentication Context Class Reference values by using the <code class="literal">req_authn_context_class_ref</code> option in the SAML realm configuration. See
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/security-settings.html#ref-saml-settings" target="_top">SAML realm settings</a>.</p><p>Elasticsearch supports only the <code class="literal">exact</code> comparison method for the Authentication Context.
When it receives the Authentication Response from the IdP, Elasticsearch examines the
value of the Authentication Context Class Reference that is part of the
Authentication Statement of the SAML Assertion. If it matches one of the
requested values, the authentication is considered successful. Otherwise, the
authentication attempt fails.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-logout"></a>SAML logout<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The SAML protocol supports the concept of Single Logout (SLO).
The level of support for SLO varies between Identity Providers.
You should consult the documentation for your IdP to determine what Logout
services it offers.</p><p>By default the Elastic Stack will support SAML SLO if the following are true:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Your IdP metadata specifies that the IdP offers a SLO service
</li><li class="listitem">
You configure <code class="literal">sp.logout</code>
</li><li class="listitem">
The setting <code class="literal">idp.use_single_logout</code> is not <code class="literal">false</code>
</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_idp_slo_service"></a>IdP SLO service<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>One of the values that Elasticsearch reads from the IdP’s SAML metadata is the
<code class="literal">&lt;SingleLogoutService&gt;</code>. In order for Single Logout to work with the Elastic
stack, Elasticsearch requires that this exist and support a binding of
<code class="literal">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect</code>.</p><p>The Elastic Stack will send both <code class="literal">&lt;LogoutRequest&gt;</code> and <code class="literal">&lt;LogoutResponse&gt;</code>
messages to this service as appropriate.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_the_sp_logout_setting"></a>The sp.logout setting<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Elasticsearch realm setting <code class="literal">sp.logout</code> specifies a URL in Kibana to which the IdP can
send both <code class="literal">&lt;LogoutRequest&gt;</code> and <code class="literal">&lt;LogoutResponse&gt;</code> messages. This service uses
the SAML HTTP-Redirect binding.</p><p>Elasticsearch will process <code class="literal">&lt;LogoutRequest&gt;</code> messages, and perform a global signout that
invalidates any existing Elasticsearch security tokens that are associated with the
provided SAML session.</p><p>If you do not configure a value for <code class="literal">sp.logout</code>, Elasticsearch will refuse all
<code class="literal">&lt;LogoutRequest&gt;</code> messages.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>It is common for IdPs to require that <code class="literal">LogoutRequest</code> messages be signed,
so you may need to configure <a class="link" href="saml-guide-authentication.html#saml-enc-sign" title="Encryption and signing">signing credentials</a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_the_idp_use_single_logout_setting"></a>The idp.use_single_logout setting<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If your IdP provides a <code class="literal">&lt;SingleLogoutService&gt;</code> but you do not wish to use it,
you can configure <code class="literal">idp.use_single_logout: false</code> in your SAML realm, and Elasticsearch
will ignore the SLO service that your IdP provides. In this case, when a user
logs out of Kibana it will invalidate their Elasticsearch session (security token), but
will not perform any logout at the IdP.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_using_kibana_without_single_logout"></a>Using Kibana without single logout<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If your IdP does not support Single Logout, or you choose not to use it, then
Kibana will perform a "local logout" only.</p><p>This means that Kibana will invalidate the session token it is using to
communicate with Elasticsearch, but will not be able to perform any sort of invalidation
of the Identity Provider session. In most cases this will mean that Kibana users
are still considered to be logged in to the IdP. Consequently, if the user
navigates to the Kibana landing page, they will be automatically reauthenticated,
and will commence a new Kibana session without needing to enter any credentials.</p><p>The possible solutions to this problem are:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Ask your IdP administrator or vendor to provide a Single Logout service
</li><li class="listitem">
If your Idp does provide a Single Logout Service, make sure it is included in
  the IdP metadata file, and do <span class="emphasis"><em>not</em></span> set <code class="literal">idp.use_single_logout</code> to <code class="literal">false</code>.
</li><li class="listitem">
Advise your users to close their browser after logging out of Kibana
</li><li class="listitem">
Enable the <code class="literal">force_authn</code> setting on your SAML realm. This setting causes the
  Elastic Stack to request fresh authentication from the IdP every time a user
  attempts to log into Kibana.
  This setting defaults to <code class="literal">false</code> because it can be a more cumbersome user
  experience, but it can also be an effective protection to stop users
  piggy-backing on existing IdP sessions.
</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="saml-enc-sign"></a>Encryption and signing<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Elastic Stack supports generating signed SAML messages (for authentication
and/or logout), verifying signed SAML messages from the IdP (for both
authentication and logout) and can process encrypted content.</p><p>You can configure Elasticsearch for signing, encryption or both, with the same
or separate keys used for each of those.</p><p>The Elastic Stack uses X.509 certificates with RSA private keys for SAML
cryptography. These keys can be generated using any standard SSL tool, including
the <code class="literal">elasticsearch-certutil</code> tool.</p><p>Your IdP may require that the Elastic Stack have a cryptographic key for signing
SAML messages, and that you provide the corresponding signing certificate within
the Service Provider configuration (either within the Elastic Stack SAML
metadata file or manually configured within the IdP administration interface).
While most IdPs do not expected authentication requests to be signed, it is
commonly the case that signatures are required for logout requests. Your IdP
will validate these signatures against the signing certificate that has been
configured for the Elastic Stack Service Provider.</p><p>Encryption certificates are rarely needed, but the Elastic Stack supports them
for cases where IdPs or local policies mandate their use.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_generating_certificates_and_keys"></a>Generating certificates and keys<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Elasticsearch supports certificates and keys in either PEM, PKCS#12 or JKS format.
Some Identity Providers are more restrictive in the formats they support, and
will require you to provide the certificates as a file in a particular format.
You should consult the documentation for your IdP to determine what formats they
support. Since PEM format is the most commonly supported format, the examples
below will generate certificates in that format.</p><p>Using the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/certutil.html" target="_top"><code class="literal">elasticsearch-certutil</code></a> tool, you can generate a
signing certificate with the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/elasticsearch-certutil cert -pem -days 1100 -name saml-sign -out saml-sign.zip</pre></div><p>This will</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
generate a certificate and key pair (the <code class="literal">cert</code> subcommand)
</li><li class="listitem">
create the files in PEM format (<code class="literal">-pem</code> option)
</li><li class="listitem">
generate a certificate that is valid for 3 years (<code class="literal">-days 1100</code>)
</li><li class="listitem">
name the certificate <code class="literal">saml-sign</code> (<code class="literal">-name</code> option)
</li><li class="listitem">
save the certificate and key in the <code class="literal">saml-sign.zip</code> file (<code class="literal">-out</code> option)
</li></ul></div><p>The generated zip archive will contain 3 files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">saml-sign.crt</code>, the public certificate to be used for signing
</li><li class="listitem">
<code class="literal">saml-sign.key</code>, the private key for the certificate
</li><li class="listitem">
<code class="literal">ca.crt</code>, a CA certificate that is not need, and can be ignored.
</li></ul></div><p>Encryption certificates can be generated with the same process.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuring_elasticsearch_for_signing"></a>Configuring Elasticsearch for signing<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>By default, Elasticsearch will sign <span class="emphasis"><em>all</em></span> outgoing SAML messages if a signing
key has been configured.</p><p>If you wish to use <span class="strong strong"><strong>PEM formatted</strong></span> keys and certificates for signing, then
you should configure the following settings on the SAML realm:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">signing.certificate</code>
</span></dt><dd>
The path to the PEM formatted certificate file. e.g. <code class="literal">saml/saml-sign.crt</code>
</dd><dt><span class="term">
<code class="literal">signing.key</code>
</span></dt><dd>
The path to the PEM formatted key file. e.g. <code class="literal">saml/saml-sign.key</code>
</dd><dt><span class="term">
<code class="literal">signing.secure_key_passphrase</code>
</span></dt><dd>
The passphrase for the key, if the file is encypted. This is a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">secure setting</a> that must be set with the
<code class="literal">elasticsearch-keystore</code> tool.
</dd></dl></div><p>If you wish to use <span class="strong strong"><strong>PKCS#12 formatted</strong></span> files or a <span class="strong strong"><strong>Java Keystore</strong></span> for
signing, then you should configure the following settings on the SAML realm:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">signing.keystore.path</code>
</span></dt><dd>
The path to the PKCS#12 or JKS keystore. e.g. <code class="literal">saml/saml-sign.p12</code>
</dd><dt><span class="term">
<code class="literal">signing.keystore.alias</code>
</span></dt><dd>
The alias of the key within the keystore. e.g. <code class="literal">signing-key</code>
</dd><dt><span class="term">
<code class="literal">signing.keystore.secure_password</code>
</span></dt><dd>
The passphrase for the keystore, if the file is encypted. This is a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">secure setting</a> that must be set with the
<code class="literal">elasticsearch-keystore</code> tool.
</dd></dl></div><p>If you wish to sign some, but not all outgoing <span class="strong strong"><strong>SAML messages</strong></span>, then you
should configure the following setting on the SAML realm:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">signing.saml_messages</code>
</span></dt><dd>
A list of message types to sign. A message type is identified by the
<span class="emphasis"><em>local name</em></span> of the XML element used for the message. Supported values
are: <code class="literal">AuthnRequest</code>, <code class="literal">LogoutRequest</code> and <code class="literal">LogoutResponse</code>.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuring_elasticsearch_for_encrypted_messages"></a>Configuring Elasticsearch for encrypted messages<a href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/authentication/saml-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Elasticsearch security features support a single key for message decryption. If a
key is configured, then Elasticsearch attempts to use it to decrypt
<code class="literal">EncryptedAssertion</code> and <code class="literal">EncryptedAttribute</code> elements in Authentication
responses, and <code class="literal">EncryptedID</code> elements in Logout requests.</p><p>Elasticsearch rejects any SAML message that contains an <code class="literal">EncryptedAssertion</code>
that cannot be decrypted.</p><p>If an <code class="literal">Assertion</code> contains both encrypted and plain-text attributes, then
failure to decrypt the encrypted attributes will not cause an automatic
rejection. Rather, Elasticsearch processes the available plain-text attributes
(and any <code class="literal">EncryptedAttributes</code> that could be decrypted).</p><p>If you wish to use <span class="strong strong"><strong>PEM formatted</strong></span> keys and certificates for SAML encryption,
then you should configure the following settings on the SAML realm:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">encryption.certificate</code>
</span></dt><dd>
The path to the PEM formatted certificate file. e.g. <code class="literal">saml/saml-crypt.crt</code>
</dd><dt><span class="term">
<code class="literal">encryption.key</code>
</span></dt><dd>
The path to the PEM formatted key file. e.g. <code class="literal">saml/saml-crypt.key</code>
</dd><dt><span class="term">
<code class="literal">encryption.secure_key_passphrase</code>
</span></dt><dd>
The passphrase for the key, if the file is encypted. This is a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">secure setting</a> that must be set with the
<code class="literal">elasticsearch-keystore</code> tool.
</dd></dl></div><p>If you wish to use <span class="strong strong"><strong>PKCS#12 formatted</strong></span> files or a <span class="strong strong"><strong>Java Keystore</strong></span> for SAML
encryption, then you should configure the following settings on the SAML realm:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">encryption.keystore.path</code>
</span></dt><dd>
The path to the PKCS#12 or JKS keystore. e.g. <code class="literal">saml/saml-crypt.p12</code>
</dd><dt><span class="term">
<code class="literal">encryption.keystore.alias</code>
</span></dt><dd>
The alias of the key within the keystore. e.g. <code class="literal">encryption-key</code>
</dd><dt><span class="term">
<code class="literal">encryption.keystore.secure_password</code>
</span></dt><dd>
The passphrase for the keystore, if the file is encypted. This is a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">secure setting</a> that must be set with the
<code class="literal">elasticsearch-keystore</code> tool.
</dd></dl></div></div></div></div><div class="navfooter"><span class="prev"><a href="saml-guide-idp.html">
              « 
              The identity provider</a>
           
        </span><span class="next">
           
          <a href="saml-sp-metadata.html">Generating SP metadata
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack">Stack Features (formerly X-Pack)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/security">Security</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/alerting">Alerting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/canvas">Canvas</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/monitoring">Monitoring</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/elasticsearch-sql">Elasticsearch SQL</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">Elasticsearch-Hadoop</a></li>
                  
                
              
                
                  
                    <li><a href="/products/ece">Elastic Cloud Enterprise</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
              
                <h3><a href="/cloud">Elastic Cloud ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/cloud/elasticsearch-service">Elasticsearch Service</a></li>
                  
                
              
                
                  
                    <li><a href="/aws-elasticsearch-service">AWS Elasticsearch Service Comparison</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/app-search-service">Elastic App Search Service</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/site-search-service">Elastic Site Search Service</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
              
                <h3></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/about/our-source-code">Our Source Code</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams">Teams</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/board">Board of Directors</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/history-of-elasticsearch">Our Story</a></li>
                  
                
              
                
                  
                    <li><a href="/about/why-open-source">Why Open Source</a></li>
                  
                
              
                
                  
                    <li><a href="/about/distributed">Distributed by Intention</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Media</a></li>
                  
                
              
                
                  
                    <li><a href="https://ir.elastic.co">Investor Relations</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="Facebook"><a id="footer_facebook" href="https://www.facebook.com/elastic.co">Facebook</a></li>
          
          		 	<li class="Twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic">Twitter</a></li>
          
          		 	<li class="LinkedIn"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co">LinkedIn</a></li>
          
          		 	<li class="Xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co">Xing</a></li>
          
          		 	<li class="YouTube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch">YouTube</a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-statement">Privacy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-text">
					<p>© 2018. Elasticsearch B.V. All Rights Reserved
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>