<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Actions
        | Elasticsearch Watcher [2.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Watcher [2.2]" /><link rel="up" href="reference.html" title="Reference" /><link rel="prev" href="condition.html" title="Condition" /><link rel="next" href="transform.html" title="Transform" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Docs/Watcher/Reference/2.2" />
  	
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- RTP tag -->
    <script type='text/javascript' async>
    (function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
     c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
     g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
     })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");

    rtp('send','view');
    rtp('get', 'campaign',true);
    </script>
    <!-- End of RTP tag -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >


<!-- end DC tags -->


	<meta name="description" content="" />





	<meta property="og:image" content="/static/img/cluster-small.png" />

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	   

    <!-- css -->
    <link href="https://static-www.elastic.co/static/css/main.css?q=200" rel="stylesheet">
    
    

    <script src="https://static-www.elastic.co/static/js/jquery.min.js?q=200"></script>
    <script src="https://static-www.elastic.co/static/js/bootstrap.min.js?q=200"></script>
    <script src="https://static-www.elastic.co/static/js/jquery.cookie.js?q=200"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // ---------------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
        locales = {
          '/en/': '/',
          '/de/': '/de/',
          '/fr/': '/fr/',
          '/ja/':'/jp/',
          '/ko/':'/kr/'
        }
        localepages = ['/','/de/','/fr/','/jp/','/kr/','/products','/de/products','/fr/products','/jp/products','/kr/products'],
        locationpath = window.location.pathname,
        localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}',
        currentlocale = JSON.parse(localeUrl);
    
      if(localepages.indexOf(locationpath) != -1){
        if($.cookie("c_lang")){
          if($.cookie("c_lang") != currentlocale.relative_url_prefix){
            var cookieurl = $.cookie("c_lang") + currentlocale.url.slice(1,currentlocale.url.length);
            window.location = cookieurl;
          }
        }
        else{
          var locale_lang = "/";
          if(locales[lang] != undefined){
            locale_lang = locales[lang];
          }
          $.cookie("c_lang",locale_lang ,{ expires: 365, path: '/'}); 
          window.location = localepages[localepages.indexOf(locationpath)];
        }
      }
      
      // --------------------- end of set language based on browser language -----------------
      </script>


	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/guide.css?q=200" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- begin olark code -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
    f[z]=function(){
    (a.s=a.s||[]).push(arguments)};var a=f[z]._={
    },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
    0:+new Date};a.P=function(u){
    a.p[u]=new Date-a.p[0]};function s(){
    a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
    hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
    return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
    b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
    b.contentWindow[g].open()}catch(w){
    c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
    var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
    b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
    /* custom configuration goes here (www.olark.com/documentation) */
    olark.identify('1356-750-10-5709');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1356-750-10-5709/contact" title="Contact us">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <!-- end olark code -->

    <script> 
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
      ga('create', 'UA-12395217-16', 'auto'); 
      ga('send', 'pageview'); 
    </script>

    <!-- Header Section -->
    
<header class="header-wrapper">
   

  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <h1>
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="https://static-www.elastic.co/assets/bltd5ac38b4549d53de/elastic-logo-mobile (1).svg?q=200" alt="elastic-logo-mobile">
              </a>
            </h1>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>
            <li id="searchbar"><a class="button icon" href="#"></a></li>
            <li class="lang global-language">
                
                  <a href="#">EN</a>
                
              <ul class="language-list">
                
                  
                    
                  
                <li><a href="/" data-value="/" id="locale-select">English</a></li>
                
                  
                    
                  
                <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                
                  
                    
                  
                <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                
                  
                    
                  
                <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                
                  
                    
                  
                <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <h1>
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="https://static-www.elastic.co/assets/blt6050efb80ceabd47/elastic-logo (2).svg?q=200" alt="elastic-logo">
          </a>
        </h1>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a id="nav_products" class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_cloud" class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_services" class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_customers" class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_learn" class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#"></a></li>
          <li class="hidden-xs lang global-language">
                
                  <a href="#">EN</a>
                
               <ul class="language-list">
              
                
                  
                
              <li><a class="" href="/" data-value="/">English</a></li>
              
                
                  
                
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
                
                  
                
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
                
                  
                
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
                
                  
                
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="https://static-www.elastic.co/static/css/horizon-swiper.min.css?q=200">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("https://static-www.elastic.co/assets/blt7b9c4fe6528dc4ef/m-search-icon.png?q=200") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("https://static-www.elastic.co/assets/blt44d8b7530a76d01c/m-guide-icon.png?q=200") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("https://static-www.elastic.co/assets/blt878040795c9d083b/m-contact-icon.png?q=200") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/horizon-swiper.min.js?q=200"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').toggleClass('show');
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    


  





  
  
  
  
    <div class="tertiary-nav">
      <div class="container">
        <div class="p-t-b-15 bdr-btm-e0e0e0 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Watcher
      [2.2]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Reference</a></span> » <span class="breadcrumb-node">Actions</span></div><div class="navheader"><span class="prev"><a href="condition.html">
              « 
              Condition</a>
           
        </span><span class="next">
           
          <a href="transform.html">Transform
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="actions"></a>Actions</h2></div></div></div><p>The actions associated with a watch are executed whenever the watch is executed, its condition
is met, and the watch is not throttled. The actions are executed one at a time and each action
executes independently from the others. Any failures encountered while executing an action are
recorded in the action result and in the watch history.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If no actions are defined for a watch, no actions are executed. However, a <code class="literal">watch_record</code>
                is still written to the <a class="link" href="watch-history.html" title="Monitoring Watch Execution">Watch History</a>.</p></div></div><p>Actions have access to the payload in the execution context. They can use it to support their
execution in any way they need. For example, the payload might serve as a model for a templated
email body.</p><h3><a id="actions-ack-throttle"></a>Acknowledgement and Throttling</h3><p>During the watch execution, once the condition is met, a decision is made per configured action
as to whether it should be throttled. The main purpose of action throttling is to prevent too
many executions of the same action for the same watch.</p><p>For example, suppose you have a watch that detects errors in an application’s log entries. The
watch is triggered every five minutes and searches for errors during the last hour. In this case,
if there are errors, there is a period of time where the watch is checked and its actions are
executed multiple times based on the same errors. As a result, the system administrator receives
multiple notifications about the same issue, which can be annoying.</p><p>To address this issue, Watcher supports time-based throttling. You can define a throttling
period as part of the action configuration to limit how often the action is executed. When you
set a throttling period, Watcher prevents repeated execution of the action if it has already
executed within the throttling period time frame (<code class="literal">now - throttling period</code>).</p><p>The following snippet shows a watch for the scenario described above - associating a throttle
period with the <code class="literal">email_administrator</code> action:</p><p><strong>Watch Definition Example. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/log_event_watch
{
  "metadata" : {
    "color" : "red"
  },
  "trigger" : {
    "schedule" : {
      "interval" : "5m"
    }
  },
  "input" : {
    "search" : {
      "request" : {
        "indices" : "log-events",
        "body" : {
          "size" : 0,
          "query" : { "match" : { "status" : "error" } }
        }
      }
    }
  },
  "condition" : {
    "script" : "return ctx.payload.hits.total &gt; 5"
  },
  "actions" : {
    "email_administrator" : {
      "throttle_period": "15m", <a id="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      "email" : { <a id="CO25-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "to" : "sys.admino@host.domain",
        "subject" : "Encountered {{ctx.payload.hits.total}} errors",
        "body" : "Too many error in the system, see attached data",
        "attach_data" : true,
        "priority" : "high"
      }
    }
  }
}</pre></div><p>
</p><div class="sense_widget" data-snippet=":AUTOSENSE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
There will be at least 15 minutes between subsequent <code class="literal">email_administrator</code> action executions.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
See <a class="link" href="actions.html#actions-email" title="Email Action">Email Action</a> for more information.
</p></td></tr></table></div><p>You can also define a throttle period at the watch level. The watch-level throttle period serves
as the default throttle period for all of the actions defined in the watch:</p><p><strong>Watch Definition Example. </strong>
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/log_event_watch
{
  "trigger" : {
    ...
  },
  "input" : {
    ...
  },
  "condition" : {
    ...
  },
  "throttle_period" : "15m", <a id="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "actions" : {
    "email_administrator" : {
      "email" : {
        "to" : "sys.admino@host.domain",
        "subject" : "Encountered {{ctx.payload.hits.total}} errors",
        "body" : "Too many error in the system, see attached data",
        "attach_data" : true,
        "priority" : "high"
      }
    },
    "notify_pager" : {
      "webhook" : {
        "method" : "POST",
        "host" : "pager.service.domain",
        "port" : 1234,
        "path" : "/{{watch_id}}",
        "body" : "Encountered {{ctx.payload.hits.total}} errors"
      }
    }
  }
}</pre></div><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
There will be at least 15 minutes between subsequent action executions (applies to both
        <code class="literal">email_administrator</code> and <code class="literal">notify_pager</code> actions)
</p></td></tr></table></div><p>If you do not define a throttle period at the action or watch level, the global default
throttle period is applied. Initially, this is set to 5 seconds. To change the global default,
configure the <code class="literal">watcher.execution.default_throttle_period</code> setting in <code class="literal">elasticsearch.yml</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">watcher.execution.default_throttle_period: 15m</pre></div><p>Watcher also supports acknowledgement-based throttling. You can acknowledge a watch using the
<a class="link" href="api-rest.html#api-rest-ack-watch" title="Ack Watch API">Ack Watch API</a> to prevent the watch actions from being executed again
while the watch condition remains <code class="literal">true</code>. This essentially tells Watcher "I received the
notification and I’m handling it, please do not notify me about this error again".
An acknowledged watch action remains in the <code class="literal">acked</code> state until the watch’s condition evaluates
to <code class="literal">false</code>. When that happens, the action’s state changes to <code class="literal">awaits_successful_execution</code>.</p><p>To acknowledge an action, you use the <code class="literal">ack</code> API:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _watcher/watch/&lt;id&gt;/_ack?actions=&lt;action_ids&gt;</pre></div><div class="sense_widget" data-snippet="snippets/actions/1.json"></div><p>Where <code class="literal">&lt;id&gt;</code> is the id of the watch and <code class="literal">&lt;action_ids&gt;</code> is a comma-separated list of the action
ids you want to acknowledge. To acknowledge all actions, omit the <code class="literal">actions</code> parameter.</p><p>The following diagram illustrates the throttling decisions made for each action of a watch
during its execution:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/action-throttling.jpg" align="middle" alt="images/action-throttling.jpg" /></div></div><p>Watcher supports six action types: <a class="link" href="actions.html#actions-email" title="Email Action">Email</a>,
<a class="link" href="actions.html#actions-webhook" title="Webhook Action">Webhook</a>, <a class="link" href="actions.html#actions-index" title="Index Action">Index</a>,
<a class="link" href="actions.html#actions-logging" title="Logging Action">Logging</a>, <a class="link" href="actions.html#actions-hipchat" title="HipChat Action">HipChat</a>
and <a class="link" href="actions.html#actions-slack" title="Slack Action">Slack</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-email"></a>Email Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">action</a> that sends email notifications. To use the <code class="literal">email</code> action, you must configure at least one email account. For instructions, see <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Accounts</a>.</p><p>See <a class="xref" href="actions.html#email-action-attributes" title="Table 11. Email Action Attributes">Table 11, “Email Action Attributes”</a> for the supported attributes. Any attributes that are missing from the email action definition are looked up in the configuration of the account from which the email is being sent. The required attributes must either be set in the email action definition or the account’s <code class="literal">email_defaults</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configuring-email-actions"></a>Configuring Email Actions</h4></div></div></div><p>You configure email actions in a watch’s <code class="literal">actions</code> array. Action-specific attributes are
specified using the <code class="literal">email</code> keyword.</p><p>The following snippet shows a basic email action definition:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "email_admin" : { <a id="CO27-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "transform" : { ... }, <a id="CO27-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "email": {
      "to": "'John Doe &lt;john.doe@example.com&gt;'", <a id="CO27-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
      "subject": "{{ctx.watch_id}} executed", <a id="CO27-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
      "body": "{{ctx.watch_id}} executed with {{ctx.payload.hits.total}} hits" <a id="CO27-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The id of the action.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An optional <a class="link" href="transform.html" title="Transform">transform</a> to transform the payload before processing the email.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
One or more addresses to send the email to. If not specified, the <code class="literal">to</code> address is read from the
    account’s <code class="literal">email_defaults</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The subject of the email (static text or a Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">template</a>).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The body of the email (static text or a Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">template</a>).
</p></td></tr></table></div><div class="table"><a id="email-action-attributes"></a><p class="title"><strong>Table 11. Email Action Attributes</strong></p><div class="table-contents"><table summary="Email Action Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name                  </th><th align="left" valign="top">Required   </th><th align="left" valign="top"> Default             </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">account</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>the default account</p></td><td align="left" valign="top"><p>The <a class="link" href="email-services.html#email-account" title="Configuring Email Accounts">account</a> to use to send the email.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">from</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The email <a class="link" href="actions.html#email-address">address</a> from which the email will be sent. The <code class="literal">from</code> field can contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a> as long as it resolves to a valid email address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">to</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The email <a class="link" href="actions.html#email-address">addresses</a> of the <code class="literal">to</code> recipients. The <code class="literal">to</code> field can contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a> as long as it resolves to a valid email address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">cc</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The email <a class="link" href="actions.html#email-address">addresses</a> of the <code class="literal">cc</code> recipients. The <code class="literal">cc</code> field can contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a> as long as it resolves to a valid email address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">bcc</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The email <a class="link" href="actions.html#email-address">addresses</a> of the <code class="literal">bcc</code> recipients. The <code class="literal">bcc</code> field can contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a> as long as it resolves to a valid email address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">reply_to</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The email <a class="link" href="actions.html#email-address">addresses</a> that will be set on the message’s <code class="literal">Reply-To</code> header. The <code class="literal">reply_to</code> field can contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a> as long as it resolves to a valid email address.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">subject</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The subject of the email. The subject can be static text or contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">body</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The body of the email. When this field holds a string, it will default to the text body of the email. Set as an object to specify either the text or the html body or both (using the fields below)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">body.text</code></p></td><td align="left" valign="top"><p>yes*</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The plain text body of the email. The body can be static text or contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">body.html</code></p></td><td align="left" valign="top"><p>yes*</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The html body of the email. The body can be static text or contain Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>. This body will be sanitized to remove dangerous content such as scripts. This behavior can be disabled by setting <code class="literal">watcher.actions.email.sanitize_html: false</code> in elasticsearch.yaml.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">priority</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The priority of this email. Valid values are: <code class="literal">lowest</code>, <code class="literal">low</code>, <code class="literal">normal</code>, <code class="literal">high</code> and <code class="literal">highest</code>. The priority can contain a Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">template</a> as long as it resolves to one of the valid values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">attach_data</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>Indicates whether the watch execution data should be attached to the email. You can specify a Boolean value or an object. If <code class="literal">attach_data</code> is set to  <code class="literal">true</code>, the data is attached as a  YAML file
called <code class="literal">data.yml</code>. If it’s set to <code class="literal">false</code>, no data is attached. To control the format of the attached data, specify an object that contains a <code class="literal">format</code> field`.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">attach_data.format</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>yaml</p></td><td align="left" valign="top"><p>When <code class="literal">attach_data</code> is specified as an object, this field controls the format of the attached data. The supported formats are <code class="literal">json</code> and <code class="literal">yaml</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
When setting the <code class="literal">body</code> object, at least one of its <code class="literal">text</code> or <code class="literal">html</code> fields must be defined.
</p><div class="variablelist"><a id="email-address"></a><dl class="variablelist"><dt><span class="term">
Email Address
</span></dt><dd>
    An email address can contain two possible parts—the address itself and an optional personal name as described in <a class="ulink" href="http://www.ietf.org/rfc/rfc822.txt" target="_top">RFC 822</a>. The address can be represented either as a string of the form <code class="literal">user@host.domain</code> or <code class="literal">Personal Name &lt;user@host.domain&gt;</code>. You can also specify an email address as an object that contains <code class="literal">name</code> and <code class="literal">address</code> fields.
</dd><dt><span class="term">
Address List
</span></dt><dd>
    A list of addresses can either be specified as a comma-delimited string or as an array:
   
    <code class="literal">'Personal Name &lt;user1@host.domain&gt;, user2@host.domain'</code> or
    <code class="literal">[ 'Personal Name &lt;user1@host.domain&gt;', 'user2@host.domain' ]</code>
</dd></dl></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-webhook"></a>Webhook Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">action</a> that connects to a web server and listens on a specific port.
The webhook action supports both HTTP and HTTPS connections. See <a class="xref" href="actions.html#webhook-action-attributes" title="Table 12. Webhook Action Attributes">Table 12, “Webhook Action Attributes”</a> for
the supported attributes.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configuring-webook-actions"></a>Configuring Webhook Actions</h4></div></div></div><p>You configure webhook actions in a watch’s <code class="literal">actions</code> array. Action-specific attributes are
specified using the <code class="literal">webhook</code> keyword.</p><p>The following snippet shows a simple webhook action definition:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "my_webhook" : { <a id="CO28-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "transform" : { ... }, <a id="CO28-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "throttle_period" : "5m", <a id="CO28-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    "webhook" : {
      "method" : "POST", <a id="CO28-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
      "host" : "mylisteningserver", <a id="CO28-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
      "port" : 9200, <a id="CO28-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
      "path": ":/{{ctx.watch_id}", <a id="CO28-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
      "body" : "{{ctx.watch_id}}:{{ctx.payload.hits.total}}" <a id="CO28-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The id of the action
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An optional <a class="link" href="transform.html" title="Transform">transform</a> to transform the payload before executing the <code class="literal">webhook</code> action
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An optional <a class="link" href="actions.html#actions-ack-throttle" title="Acknowledgement and Throttling">throttle period</a> for the action (5 minutes in this example)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The HTTP method to use when connecting to the host
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The host to connect to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The port to connect to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path (URI) to use in the HTTP request
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The body to send with the request
</p></td></tr></table></div><p>You can use basic authentication when sending a request to a secured webservice. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "my_webhook" : {
    "webhook" : {
      "auth" : {
        "basic" : {
          "username" : "&lt;username&gt;", <a id="CO29-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
          "password" : "&lt;password&gt;" <a id="CO29-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        }
      }
      "method" : "POST",
      "host" : "mylisteningserver",
      "port" : 9200,
      "path": ":/{{ctx.watch_id}",
      "body" : "{{ctx.watch_id}}:{{ctx.payload.hits.total}}"
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The username
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The corresponding password
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>By default, both the username and the password are stored in the <code class="literal">.watches</code> index in plain text. When
Shield is installed, Watcher can be <a class="link" href="shield-integration.html#shield-watch-data-encryption" title="Watch Data Encryption">configured</a> to encrypt the password before
storing it.</p></div></div><p>You can also use PKI-based authentication when submitting requests to a cluster secured with Shield.
When you use PKI-based authentication instead of HTTP basic auth, you don’t need to store any
authentication information in the watch itself. To use PKI-based authentication, you configure
the SSL keystore path and password for Watcher in <code class="literal">elasticsearch.yml</code>. If the
<code class="literal">watcher.http.ssl.keystore.path</code> and <code class="literal">watcher.http.ssl.keystore</code> password are not set, the Watcher
HTTP client falls back to the Shield settings, <code class="literal">shield.ssl.keystore.path</code> and <code class="literal">shield.ssl.keystore.password</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="webhook-query-parameters"></a>Query Parameters</h4></div></div></div><p>You can specify query parameters to send with the request with the <code class="literal">params</code> field. This field simply
holds an object where the keys serve as the parameter names and the values serve as the parameter values:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "my_webhook" : {
    "webhook" : {
      "method" : "POST",
      "host" : "mylisteningserver",
      "port" : 9200,
      "path": ":/alert",
      "params" : {
        "watch_id" : "{{ctx.watch_id}}" <a id="CO30-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO30-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The parameter values can contain templated strings.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="webhook-custom-request-headers"></a>Custom Request Headers</h4></div></div></div><p>You can specify request headers to send with the request with the <code class="literal">headers</code> field. This field simply
holds an object where the keys serve as the header names and the values serve as the header values:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "my_webhook" : {
    "webhook" : {
      "method" : "POST",
      "host" : "mylisteningserver",
      "port" : 9200,
      "path": ":/alert/{{ctx.watch_id}}",
      "headers" : {
        "Content-Type" : "application/yaml" <a id="CO31-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      },
      "body" : "count: {{ctx.payload.hits.total}}"
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The header values can contain templated strings.
</p></td></tr></table></div><div class="table"><a id="webhook-action-attributes"></a><p class="title"><strong>Table 12. Webhook Action Attributes</strong></p><div class="table-contents"><table summary="Webhook Action Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name                                  </th><th align="left" valign="top">Required   </th><th align="left" valign="top"> Default     </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">scheme</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>http</p></td><td align="left" valign="top"><p>The connection scheme. Valid values are: <code class="literal">http</code> or <code class="literal">https</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">host</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The host to connect to.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">port</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The port the HTTP service is listening on.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">path</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The URL path. The path can be static text or include Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>. URL query string parameters must be specified via the <code class="literal">request.params</code> attribute.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">method</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>get</p></td><td align="left" valign="top"><p>The HTTP method. Valid values are: <code class="literal">head</code>, <code class="literal">get</code>, <code class="literal">post</code>, <code class="literal">put</code> and <code class="literal">delete</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">headers</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The HTTP request headers. The header values can be static text or include Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">params</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The URL query string parameters. The parameter values can be static text or include Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">auth</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>Authentication related HTTP headers. Currently, only basic authentication is supported.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">body</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The HTTP request body. The body can be static text or include Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>. When not specified, an empty body is sent.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">proxy.host</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The proxy host to use when connecting to the host.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">proxy.port</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The proxy port to use when connecting to the host.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">connection_timeout</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>10s</p></td><td align="left" valign="top"><p>The timeout for setting up the http connection. If the connection could not be set up within this time, the action will timeout and fail. It is
                                                                            also possible to <a class="link" href="configuring-default-http-timeouts.html" title="Configuring the Default HTTP Timeouts">configure</a> the default connection timeout for all http connection timeouts.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">read_timeout</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>10s</p></td><td align="left" valign="top"><p>The timeout for reading data from http connection. If no response was received within this time, the action will timeout and fail. It is also possible to <a class="link" href="configuring-default-http-timeouts.html" title="Configuring the Default HTTP Timeouts">configure</a> the default read timeout for all http connection timeouts.</p></td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-index"></a>Index Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">Action</a> that enable you to index data in Elasticsearch.
See <a class="xref" href="actions.html#index-action-attributes" title="Table 13. Index Action Attributes">Table 13, “Index Action Attributes”</a> for the supported attributes.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuring_index_actions"></a>Configuring Index Actions</h4></div></div></div><p>The following snippet shows a simple <code class="literal">index</code> action definition:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "index_payload" : { <a id="CO32-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "transform": { ... },<a id="CO32-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "index" : {
      "index" : "my-index", <a id="CO32-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
      "doc_type" : "my-type" <a id="CO32-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The id of the action
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An optional <a class="link" href="transform.html" title="Transform">transform</a> to transform the payload and prepare the data that should be indexed
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The elasticsearch index to store the data to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The document type to store the data as
</p></td></tr></table></div><div class="table"><a id="index-action-attributes"></a><p class="title"><strong>Table 13. Index Action Attributes</strong></p><div class="table-contents"><table summary="Index Action Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name                      </th><th align="left" valign="top">Required    </th><th align="left" valign="top"> Default               </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">index</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The Elasticsearch index to
                                                                                                                                            index into.
                                                        are supported</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc_type</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The type of the document
                                                                                                                                            the data will be indexed as.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">execution_time_field</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>_timestamp</p></td><td align="left" valign="top"><p>The field that will store/index
                                                                                                                                          the watch execution time. When
                                                                                                                                          not set or when set to <code class="literal">_timestamp</code>,
                                                                                                                                          the execution time will serve as
                                                                                                                                              the document’s
                                                          <a class="ulink" href="http://www.elastic.co/guide/en/elasticsearch/reference/2.2/mapping-timestamp-field.html" target="_top">timestamp</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">timeout</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>60s</p></td><td align="left" valign="top"><p>The timeout for waiting for the index api call to return.
                                                          If no response is returned within this time, the index
                                                          action times out and fails. This setting overrides
                                                          the default internal index/bulk operations
                                                          <a class="link" href="configuring-default-internal-ops-timeouts.html#default-internal-ops-timeouts">timeouts</a>.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="anatomy-actions-index-multi-doc-support"></a>Multi-Document Support</h4></div></div></div><p>Like with all other actions, you can use a <a class="link" href="transform.html" title="Transform">transform</a> to replace
the current execution context payload with another and by that change the document that
will end up indexed.</p><p>The index action plays well with transforms with its support for the special <code class="literal">_doc</code>
payload field.</p><p>When resolving the document to be indexed, the index action first looks up for a
<code class="literal">_doc</code> field in the payload. When not found, the payload is indexed as a single
document.</p><p>When a <code class="literal">_doc</code> field exists, if the field holds an object, it is extracted and indexed
as a single document. If the field holds an array of objects, each object is treated as
a document and the index aciton indexes all of them in a bulk.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-logging"></a>Logging Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">action</a> that simply logs text to the standard Elasticsearch logs.
See <a class="xref" href="actions.html#logging-action-attributes" title="Table 14. Logging Action Attributes">Table 14, “Logging Action Attributes”</a> for the supported attributes.</p><p>This action is primarily used during development and debugging.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configuring-logging-actions"></a>Configuring Logging Actions</h4></div></div></div><p>You configure logging actions in a watch’s <code class="literal">actions</code> array. Action-specific attributes are
specified using the <code class="literal">logging</code> keyword.</p><p>The following snippet shows a simple logging action definition:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "log" : { <a id="CO33-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "transform" : { ... }, <a id="CO33-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "logging" : {
      "text" : "executed at {{ctx.execution_time}}" <a id="CO33-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The id of the action.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
An optional <a class="link" href="transform.html" title="Transform">transform</a> to transform the payload before executing the <code class="literal">logging</code> action.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The text to be logged.
</p></td></tr></table></div><div class="table"><a id="logging-action-attributes"></a><p class="title"><strong>Table 14. Logging Action Attributes</strong></p><div class="table-contents"><table summary="Logging Action Attributes" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name                      </th><th align="left" valign="top">Required   </th><th align="left" valign="top"> Default                  </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">text</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The text that should be logged. Can be static text or include Mustache <a class="link" href="scripts-templates.html#templates" title="Using Templates">templates</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">category</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>watcher.actions.logging</p></td><td align="left" valign="top"><p>The category under which the text will be logged.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">level</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>info</p></td><td align="left" valign="top"><p>The logging level. Valid values are: <code class="literal">error</code>, <code class="literal">warn</code>, <code class="literal">info</code>, <code class="literal">debug</code> and <code class="literal">trace</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-hipchat"></a>HipChat Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">action</a> that sends messages to <a class="ulink" href="https://www.hipchat.com" target="_top">HipChat</a>
rooms or users. To use the HipChat action, you need to configure at least one
HipChat account in Watcher. For information about configuring accounts, see <a class="link" href="configuring-hipchat.html" title="Configuring Watcher to Send Messages to HipChat">Configuring Watcher to Send Notifications to HipChat</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configuring-hipchat-actions"></a>Configuring HipChat Actions</h4></div></div></div><p>You configure HipChat actions in a watch’s <code class="literal">actions</code> array. Action-specific attributes are
specified using the <code class="literal">hipchat</code> keyword. You must specify the <code class="literal">message</code> attribute for all
<code class="literal">hipchat</code> actions. If you omit the <code class="literal">account</code> attribute, the message is sent
using the default HipChat account configured in <code class="literal">elasticsearch.yml</code>.</p><p>For example, the following action is configured to send messages using a HipChat account that
uses the <a class="link" href="configuring-hipchat.html#hipchat-api-integration" title="Using the HipChat Integration Profile">integration</a> profile. Because this type of account can
only send messages to a particular room, the only required attribute is the message itself.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "notify-hipchat" : {
    "transform" : { ... },
    "throttle_period" : "5m",
    "hipchat" : {
      "account" : "integration-account", <a id="CO34-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      "message" : {
        "body" : "Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)", <a id="CO34-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "format" : "text",
        "color" : "red",
        "notify" : true
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The name of a HipChat account configured in <code class="literal">elasticsearch.yml</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The message you want to send to HipChat.
</p></td></tr></table></div><p>To send messages with a HipChat account that uses the <a class="link" href="configuring-hipchat.html#hipchat-api-user" title="Using the HipChat User Profile">user</a> profile, you need
to specify what rooms and users you want to send the message to. For example, the following action
is configured to send messages to the <code class="literal">mission-control</code> and <code class="literal">devops</code> rooms
as well as the user <code class="literal">website-admin@example.com</code>. (To send to multiple users or rooms, specify an
array of strings.)</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "notify-hipchat" : {
    "transform" : { ... },
    "throttle_period" : "5m",
    "hipchat" : {
      "account" : "user-account",
      "message" : {
        "room" : [ "mission-control", "devops" ],
        "user" : "website-admin@example.com",
        "body" : "Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)",
        "format" : "text",
        "color" : "red",
        "notify" : true
      }
    }
  }
}</pre></div><p>To send messages with a HipChat account that uses the <a class="link" href="configuring-hipchat.html#hipchat-api-v1" title="Using the HipChat v1 Profile">v1</a> profile, you need
to specify what room or rooms you want to send the message to. For example, the following action
is configured to send messages to the <code class="literal">server-status</code> room. (To send to multiple
rooms, specify an array of strings.)</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "notify-hipchat" : {
    "transform" : { ... },
    "throttle_period" : "5m",
    "hipchat" : {
      "account" : "v1-account",
      "message" : {
        "from" : "Watcher",
        "room" : [ "server-status", "infra-team" ],
        "body" : "Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)",
        "format" : "text",
        "color" : "red",
        "notify" : true
      }
    }
  }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="hipchat-action-attributes"></a>HipChat Action Attributes</h4></div></div></div><p>The following table lists the attributes you can set for <code class="literal">hipchat</code> actions.</p><div class="informaltable"><a id="hipchat-api-integration-action-attributes"></a><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><tbody><tr><td align="left" valign="top"><p>Name</p></td><td align="left" valign="top"><p>Required</p></td><td align="left" valign="top"><p>Default</p></td><td align="left" valign="top"><p>Description</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">account</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>Default account</p></td><td align="left" valign="top"><p>The HipChat account to use to send the
                                                              message.</p></td></tr><tr><td align="left" valign="top"><p>`message.body   `</p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The message content. Can contain up to
                                                              1000 characters.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.format</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>html</p></td><td align="left" valign="top"><p>The format of the message: <code class="literal">text</code> or <code class="literal">html</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.color</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>yellow</p></td><td align="left" valign="top"><p>The background color of the notification in the
                                                              room: <code class="literal">gray</code>, <code class="literal">green</code>, <code class="literal">purple</code>, <code class="literal">red</code>, <code class="literal">yellow</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.notify</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>false</p></td><td align="left" valign="top"><p>Indicates whether people in the room should
                                                              be actively notified</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.from</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>the watch ID</p></td><td align="left" valign="top"><p>The name that appears as the notification sender.
                                                              Only valid for accounts that use the v1 profile.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.room</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The rooms that the notification should go to.
                                                              Accepts a string value or an array of string
                                                              values. Must be specified when using the
                                                              v1 profile. At least one room or user must
                                                              be specified when using the <code class="literal">user</code> profile.
                                                              Not valid for the <code class="literal">integration</code> profile.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">message.user</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The users that the notification should go to.
                                                              Accepts a string value or an array of string
                                                              values. At least one room or user must
                                                              be specified when using the <code class="literal">user</code> profile.
                                                              Not valid for the <code class="literal">integration</code> or <code class="literal">v1</code>
                                                              profiles.</p></td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="actions-slack"></a>Slack Action</h3></div></div></div><p>A watch <a class="link" href="actions.html" title="Actions">action</a> that sends messages to a <a class="ulink" href="https://slack.com/" target="_top">Slack</a> team’s channels or
users. To use the Slack action, you need to configure at least one
Slack account in Watcher. For information about configuring accounts, see <a class="link" href="configuring-slack.html" title="Configuring Watcher to Send Messages to Slack">Configuring Watcher to Send Notifications to Slack</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="configuring-slack-actions"></a>Configuring Slack Actions</h4></div></div></div><p>You configure Slack actions in a watch’s <code class="literal">actions</code> array. Action-specific attributes are
specified using the <code class="literal">slack</code> keyword.</p><p>The following snippet shows a simple slack action definition:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "notify-slack" : {
    "transform" : { ... },
    "throttle_period" : "5m",
    "slack" : {
      "message" : {
        "to" : [ "#admins", "@chief-admin" ], <a id="CO35-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "text" : "Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)" <a id="CO35-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The channels and users you want to send the message to.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The content of the message.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="formatting-slack-messages"></a>Using Attachments to Format Slack Messages</h4></div></div></div><p>In addition to sending simple text-based messages, you can use the Slack
<a class="ulink" href="https://api.slack.com/docs/attachments" target="_top">attachment</a> mechanism to send formatted messages.
Watcher leverages Slack attachments to enable you to dynamically populate templated messages
from the watch payload.</p><p>The following snippet shows a standard message attachment.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"actions" : {
  "notify-slack" : {
    "throttle_period" : "5m",
    "slack" : {
      "account" : "team1",
      "message" : {
        "from" : "watcher",
        "to" : [ "#admins", "@chief-admin" ],
        "text" : "System X Monitoring",
        "attachments" : [
          {
            "title" : "Errors Found",
            "text" : "Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)",
            "color" : "danger"
          }
        ]
      }
    }
  }
}</pre></div><p><a id="slack-dynamic-attachment"></a>To define an attachment template that is dynamically populated from the watch payload, you specify
 <code class="literal">dynamic_attachments</code> in the watch action. For example, a dynamic attachment could reference
 histogram buckets in the payload and build an attachment per bucket.</p><p>In the following example, the watch input executes a search with a date histogram aggregation
and the Slack action:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Transforms the payload to a list where each item in the list holds the month, the user count
 for that month, and the color that represents the sentiment associated with that count
 (good or danger).
</li><li class="listitem">
Defines an attachment template that references items in the list generated by the transform.
</li></ol></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">"input" : {
  "search" : {
    "request" : {
      "body" : {
        "aggs" : {
          "users_per_month" : {
            "date_histogram" : {
              "field" : "@timestamp",
              "interval" : "1m"
            }
          }
        }
      }
    }
  }
},
...
"actions" : {
  "notify-slack" : {
    "throttle_period" : "5m",
    "transform" : {
      "script" : "return [ items : ctx.payload.hits.aggs.users_per_month.buckets.collect { [ month : it.key_as_string, count : it.doc_count, color : it.doc_count &lt; 100 ? 'danger' : 'good' ] }]"
    },
    "slack" : {
      "account" : "team1",
      "message" : {
        "from" : "watcher",
        "to" : [ "#admins", "@chief-admin" ],
        "text" : "System X Monitoring",
        "dynamic_attachments" : {
          "list_path" : "ctx.payload.items" <a id="CO36-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
          "attachment_template" : {
            "title" : "{{month}}", <a id="CO36-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "text" : "Users Count: {{count}}",
            "color" : "{{color}}"
          }
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The list generated by the action’s transform.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The parameter placeholders refer to attributes in each item of the list generated by the transform.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="slack-action-attributes"></a>Slack Action Attributes</h4></div></div></div><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top"> Name                    </th><th align="left" valign="top">Required   </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">from</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>The sender name to display in the
                                        Slack message. Overrides the incoming
                                        webhook’s configured name.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">to</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>The channels and users you want to send
                                        the message to. Channel names must start
                                        with <code class="literal">#</code> and user names must start with <code class="literal">@</code>.
                                        Accepts a string value or an array of string
                                        values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">icon</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>The icon to display in the Slack messages.
                                        Overrides the incoming webhook’s configured
                                        icon. Accepts a public URL to an image.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">text</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>The message content.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">attachments</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>Slack message attachments. Message
                                        attachments enable you to create more
                                        richly-formatted messages. Specified as
                                        as array as defined in the
                                        <a class="ulink" href="https://api.slack.com/docs/attachments" target="_top">Slack
                                        attachments documentation</a>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">dynamic_attachments</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>Slack message attachments that can be
                                        populated dynamically based on the current
                                        watch payload. For more information, see
                                        <a class="link" href="actions.html#slack-dynamic-attachment">Using Attachments to                                         Format Slack Messages</a>.</p></td></tr></tbody></table></div></div></div></div><div class="navfooter"><span class="prev"><a href="condition.html">
              « 
              Condition</a>
           
        </span><span class="next">
           
          <a href="transform.html">Transform
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<h3>Top Videos</h3>
						<ul>
							<li><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Elasticsearch Demo</a></li>
							<li><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Kibana 101</a></li>
							<li><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Primer</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form">
          <form id="mktoForm_1398" class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack">X-Pack</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud">Elastic Cloud</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/security">Security (formerly Shield)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/alerting">Alerting (via Watcher)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/monitoring">Monitoring (formerly Marvel)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">ES-Hadoop</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              <ul>
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Press</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Language</h3>
              
              <ul>
              
                
                  <li><a href="/" data-value="/">English</a></li>
                
              
                
                  <li><a href="/fr/" data-value="/fr/">Français</a></li>
                
              
                
                  <li><a href="/de/" data-value="/de/">Deutsch</a></li>
                
              
                
                  <li><a href="/jp/" data-value="/jp/">日本語</a></li>
                
              
                
                  <li><a href="/kr/" data-value="/kr/">한국어</a></li>
                
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-12">
        <p class="text-center font-size-10 m-0">FOLLOW US</p>
        <ul>
          
          <li class="facebook"><a id="footer_facebook" href="http://www.facebook.com/elastic.co"></a></li>
          
          <li class="twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic"></a></li>
          
          <li class="linkedin"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co"></a></li>
          
          <li class="xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co"></a></li>
          
          <li class="youtube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch"></a></li>
          
        </ul>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-policy">Privacy</a></li>
				<li><a href="/legal/privacy-and-cookie-policy">Cookie Policy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer.svg" class="img-responsive"></a>
				</div>
				<div class="footer-text">
					<p>© 2017. All Rights Reserved - Elasticsearch
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
    
		.facebook{background:url("https://static-www.elastic.co/assets/bltf546ff2e0a8f2de5/facebook.svg?q=200") no-repeat;}
    
    
      .facebook:hover {background:url("https://static-www.elastic.co/assets/bltc24cf11c714ecfc4/facebook-hover.svg?q=200")}		
    
	
    
		.twitter{background:url("https://static-www.elastic.co/assets/bltdd9556d6b24e2b85/twitter.svg?q=200") no-repeat;}
    
    
      .twitter:hover {background:url("https://static-www.elastic.co/assets/blt90b0372cc07a54d3/twitter-hover.svg?q=200")}		
    
	
    
		.linkedin{background:url("https://static-www.elastic.co/assets/bltc4a77e0f52ce07f1/linkedin.svg?q=200") no-repeat;}
    
    
      .linkedin:hover {background:url("https://static-www.elastic.co/assets/blt01ce654380e4ea6c/linkedin-hover.svg?q=200")}		
    
	
    
		.xing{background:url("https://static-www.elastic.co/assets/bltc6347078dcc9ec76/xing.svg?q=200") no-repeat;}
    
    
      .xing:hover {background:url("https://static-www.elastic.co/assets/bltededebe5f7521a39/xing-hover.svg?q=200")}		
    
	
    
		.youtube{background:url("https://static-www.elastic.co/assets/blt4982061ce1aebc7f/youtube.svg?q=200") no-repeat;}
    
    
      .youtube:hover {background:url("https://static-www.elastic.co/assets/bltddeb6c6404ae81a5/youtube-hover.svg?q=200")}		
    
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
  MktoForms2.whenReady(function (form) {
  //    // Put your code that uses the form object here
  //   $('#Email').attr("placeholder","Email Address");
  //   $('#FirstName').attr("placeholder","First Name");
  //   $('#LastName').attr("placeholder","Last Name");
  //   $('#Form_Message').attr("placeholder","Tell us in your words");
  // // ========================End Mktoform placeholder==================
  });

  MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
    form.onSuccess(function(form){
      $('#mktoForm_1398').css('display','none');
      $('.subscribe-wrapper .subscribe-form-container').hide();
      $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
      dataLayer.push({'event': 'mktoFormSubmit'});
        return false;
      });
  });
</script>
      </section>
    </div>
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}';
</script>
<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js?q=200"></script>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/slick.min.js?q=200"></script>
<script src="https://static-www.elastic.co/static/js/nav-v5.js?q=200"></script>
<script src="https://static-www.elastic.co/static/js/script.js?q=200"></script> 
     
     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>