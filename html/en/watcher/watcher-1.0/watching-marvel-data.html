
<!DOCTYPE HTML>
<html lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Watching Marvel Data</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Watcher [watcher-1.0]" /><link rel="up" href="example-watches.html" title="Example Watches" /><link rel="prev" href="example-watches.html" title="Example Watches" /><link rel="next" href="watching-time-series-data.html" title="Watching Time Series Data" /><meta name="DC.type" content="Docs/Watcher/Reference/watcher-1.0" />
  
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	<!-- RTP tag --> 
	<script type='text/javascript' async>
	(function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
	 c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
	 g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
	 })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");
	 
	rtp('send','view');
	rtp('get', 'campaign',true);
	</script>
	<!-- End of RTP tag -->
	
 	<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png?change=123">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png?change=123">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png?change=123">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png?change=123">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png?change=123">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png?change=123">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png?change=123">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png?change=123">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png?change=123">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png?change=123">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?change=123">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png?change=123">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?change=123">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<script type="text/javascript">visitor_count = ""</script>
<script type="text/javascript">mod_value = ""</script>


	<meta name="description" content="" />

	<link rel="canonical" href="" />

	<meta property="og:image" content="https://www.elastic.co/static/img/elastic-logo-200.png" />

	<!-- <link rel="shortcut icon" href="/favicon.ico?change=550" type="image/x-icon">
	<link rel="icon" href="/favicon.ico?change=550" type="image/x-icon"> -->
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<!-- <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png?change=550"> -->

	<!-- For iPhone with high-resolution Retina display: -->

	<!-- <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png?change=550"> -->

	<!-- For first- and second-generation iPad: -->

	<!-- <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png?change=550"> -->
	<!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> -->
	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/style.css?clr=140" />	
	<script src="https://static-www.elastic.co/static/js/skel.min.js"></script>
	
		<script type="text/javascript">form_name = "" ; cdn_url="https://static-www.elastic.co"</script>
		
	<script src="https://static-www.elastic.co/static/js/init.js?clr=151"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.min.js"></script>
	<script src="https://static-www.elastic.co/static/js/jquery.cookie.js"></script>
	<!--<script type="text/javascript">
	    (function() {
	        var path = '//easy.myfonts.net/v2/js?sid=10336(font-family=Avenir+35+Light)&sid=10338(font-family=Avenir+55+Roman)&sid=10340(font-family=Avenir+85+Heavy)&sid=10344(font-family=Avenir+65+Medium)&key=nAD6PCOPrX',
	            protocol = ('https:' == document.location.protocol ? 'https:' : 'http:'),
	            trial = document.createElement('script');
	        trial.type = 'text/javascript';
	        trial.async = true;
	        trial.src = protocol + path;
	        var head = document.getElementsByTagName("head")[0];
	        head.appendChild(trial);
	    })();
	</script>-->

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			


<div class="container w100">
	<div class="row">
		<div class="12u">
			

<section class="first-container">
	<div class="row">
		<div class="8u 6u(small) 6u(xsmall)">
			<div id="elastic">
				<h1>
					<a href="/">
						<div id="elastic-logo">
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 400 130" preserveAspectRatio="xMinYMin meet" enable-background="new 0 0 400 130" xml:space="preserve">
    <g>
    	<g>
    		<path fill="#FFFFFF" d="M122.5,67.8c0-10.3-6.4-19.2-15.9-22.7c0.4-2.2,0.6-4.3,0.6-6.6c0-19.1-15.5-34.6-34.6-34.6
    			c-11.1,0-21.5,5.3-28,14.4c-3.2-2.5-7.1-3.8-11.2-3.8c-10.1,0-18.4,8.2-18.4,18.4c0,2.2,0.4,4.4,1.1,6.4C6.5,42.6,0,51.8,0,62
    			c0,10.3,6.4,19.3,16,22.8c-0.4,2.1-0.6,4.3-0.6,6.6c0,19,15.5,34.5,34.5,34.5c11.2,0,21.5-5.4,28-14.4c3.2,2.5,7.2,3.9,11.3,3.9
    			c10.1,0,18.4-8.2,18.4-18.4c0-2.2-0.4-4.4-1.1-6.4C115.9,87.2,122.5,78,122.5,67.8z"/>
    		<g>
    			<path fill="#F4BD19" d="M47.9,56.3l27.3,12.5l27.6-24.2c0.4-2,0.6-4,0.6-6.1c0-17-13.8-30.8-30.8-30.8c-10.2,0-19.7,5-25.4,13.4
    				l-4.6,23.8L47.9,56.3z"/>
    		</g>
    		<g>
    			<path fill="#3CBEB1" d="M19.6,85.2c-0.4,2-0.6,4.1-0.6,6.2c0,17,13.9,30.9,30.9,30.9c10.3,0,19.8-5.1,25.6-13.5L80,85l-6.1-11.6
    				L46.5,60.9L19.6,85.2z"/>
    		</g>
    		<g>
    			<path fill="#E9478C" d="M19.4,37.9l18.7,4.4L42.3,21c-2.6-2-5.7-3-9-3c-8.1,0-14.8,6.6-14.8,14.8C18.5,34.5,18.8,36.3,19.4,37.9z
    				"/>
    		</g>
    		<g>
    			<path fill="#2C458F" d="M17.8,42.4C9.4,45.1,3.6,53.2,3.6,62c0,8.6,5.3,16.3,13.3,19.3l26.3-23.8l-4.8-10.3L17.8,42.4z"/>
    		</g>
    		<g>
    			<path fill="#95C63D" d="M80.3,108.7c2.6,2,5.7,3.1,8.9,3.1c8.1,0,14.8-6.6,14.8-14.8c0-1.8-0.3-3.5-0.9-5.1l-18.7-4.4L80.3,108.7
    				z"/>
    		</g>
    		<g>
    			<path fill="#176655" d="M84.1,82.6l20.6,4.8c8.4-2.8,14.2-10.8,14.2-19.6c0-8.6-5.3-16.2-13.3-19.3l-27,23.6L84.1,82.6z"/>
    		</g>
    	</g>
    	<path d="M162.8,76.3c0,0.1,0,0.6,0.1,1.4c0.1,0.8,0.3,1.8,0.6,3c0.3,1.1,0.8,2.4,1.4,3.7c0.6,1.3,1.4,2.5,2.5,3.6
    		c1,1.1,2.3,2,3.8,2.7c1.5,0.7,3.4,1.1,5.6,1.1c1.8,0,3.3-0.1,4.6-0.4c1.3-0.3,2.4-0.7,3.4-1.3c1-0.6,1.9-1.3,2.7-2.2
    		c0.8-0.9,1.6-1.9,2.4-3.1c0.5-0.7,1-1.2,1.6-1.5c0.6-0.3,1.2-0.4,1.8-0.4c1,0,2,0.4,2.8,1.1c0.9,0.7,1.3,1.7,1.3,2.8
    		c0,0.7-0.4,1.7-1.1,3.1c-0.7,1.4-1.9,2.8-3.6,4.1c-1.6,1.4-3.7,2.6-6.3,3.6c-2.6,1-5.7,1.5-9.5,1.5c-3.8,0-7.2-0.7-10.2-2.1
    		c-3-1.4-5.5-3.2-7.5-5.6c-2-2.3-3.6-5-4.7-8.1c-1.1-3.1-1.6-6.3-1.6-9.7c0-3.5,0.5-6.8,1.6-9.9c1.1-3.1,2.7-5.8,4.7-8.1
    		c2-2.3,4.5-4.1,7.4-5.5c2.9-1.3,6.1-2,9.6-2c3.3,0,6.3,0.5,9.2,1.5c2.8,1,5.3,2.4,7.4,4.3c2.1,1.9,3.7,4.1,5,6.8
    		c1.2,2.7,1.8,5.8,1.8,9.2c0,2.1-0.5,3.7-1.6,4.8c-1,1.1-2.2,1.6-3.6,1.6H162.8z M170.9,56.4c-1.5,0.6-2.7,1.4-3.7,2.4
    		c-1,0.9-1.8,2-2.4,3.1c-0.6,1.1-1,2.2-1.3,3.2c-0.3,1-0.5,1.8-0.5,2.5c-0.1,0.7-0.1,1.1-0.1,1.2h27.9c0-1.8-0.3-3.5-0.9-5.1
    		c-0.6-1.6-1.5-3-2.6-4.3c-1.2-1.2-2.7-2.2-4.5-3c-1.8-0.7-4-1.1-6.5-1.1C174.2,55.5,172.4,55.8,170.9,56.4z"/>
    	<path d="M214.3,94.6c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V35.1
    		c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,1.9,1.3,3.2V94.6z"/>
    	<path d="M229.8,63.5c-0.6,0.3-1.2,0.5-1.9,0.5c-1.2,0-2.2-0.4-3.2-1.1c-1-0.7-1.5-1.8-1.5-3.1c0-0.5,0.1-1.1,0.4-1.9
    		c0.5-1.2,1.2-2.4,2.1-3.6c0.9-1.2,2-2.2,3.5-3.1s3.3-1.7,5.4-2.2c2.2-0.5,4.8-0.8,7.9-0.8c5.9,0,10.5,1.2,14,3.5
    		c3.5,2.3,5.2,5.8,5.2,10.3v32.8c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2v-2
    		c-1.2,2-4.7,4.5-7.5,5.3c-2.8,0.8-5.7,1.2-8.8,1.2c-2,0-3.9-0.3-5.9-0.8c-2-0.5-3.8-1.4-5.3-2.5c-1.6-1.1-2.9-2.6-3.8-4.3
    		c-1-1.7-1.5-3.8-1.5-6.2c0-2.8,0.5-5.7,1.6-7.5c1.1-1.9,2.6-3.4,4.4-4.6c1.8-1.2,3.9-2.1,6.3-2.8c2.4-0.6,4.9-1.1,7.5-1.4
    		c3-0.3,5.4-0.7,7.2-1.2c1.7-0.4,3-0.9,3.9-1.5c0.9-0.6,1.4-1.2,1.6-2c0.2-0.7,0.3-1.6,0.3-2.5c0-1.1-0.3-2-0.9-2.8
    		c-0.6-0.8-1.4-1.5-2.4-2c-1-0.5-2.1-0.9-3.3-1.2s-2.4-0.4-3.5-0.4c-2.1,0-3.7,0.2-5,0.5c-1.3,0.3-2.3,0.8-3.1,1.4
    		c-0.8,0.6-1.5,1.3-1.9,2.1c-0.5,0.8-0.9,1.6-1.3,2.5C230.9,62.6,230.4,63.1,229.8,63.5z M250.6,74.4c-1.1,0.3-2.4,0.6-3.8,0.8
    		c-1.5,0.2-3,0.4-4.6,0.6c-1.6,0.2-3.1,0.5-4.6,0.9c-1.5,0.3-2.8,0.8-4,1.5c-1.2,0.7-2.2,1.5-2.9,2.5c-0.7,1-1.1,3-1.1,4.6
    		c0,1.3,0.3,2.3,0.8,3.1c0.5,0.8,1.2,1.5,2.1,2c0.9,0.5,1.8,0.8,2.9,1c1.1,0.2,2.2,0.3,3.3,0.3c1.7,0,3.3-0.2,5-0.6
    		c1.7-0.4,3.2-1,4.5-1.9s2.4-2,3.3-3.5c0.8-1.4,1.2-3.8,1.2-5.9v-6.1L250.6,74.4z"/>
    	<path d="M307.6,90.9c-1.1,2-2.7,3.6-4.6,4.8s-4.1,2.1-6.6,2.7c-2.5,0.5-5.2,0.8-7.9,0.8c-3.9,0-7.2-0.6-9.9-1.8
    		c-2.7-1.2-4.9-2.6-6.5-4.1c-1.7-1.6-2.9-3.1-3.7-4.7c-0.7-1.6-1.1-2.7-1.1-3.5c0-1.3,0.5-2.4,1.4-3.2c0.9-0.8,2-1.2,3.1-1.2
    		c0.7,0,1.3,0.2,2,0.6c0.6,0.4,1.1,1,1.5,1.9c1,2.5,2.5,4.5,4.7,6.2c2.2,1.7,5.2,2.5,9.3,2.5c1.8,0,3.4-0.2,4.7-0.6
    		c1.3-0.4,2.4-1,3.2-1.7c0.8-0.7,1.4-1.5,1.9-2.4c0.4-0.9,0.6-1.8,0.6-2.8c0-2-0.8-3.4-2.3-4.4c-1.5-1-3.5-1.7-5.8-2.3
    		c-2.3-0.6-4.8-1.1-7.5-1.6c-2.7-0.5-5.2-1.2-7.5-2.2c-2.3-0.9-4.2-2.3-5.8-4c-1.6-1.8-2.3-4.2-2.3-7.3c0-4.5,1.6-8,4.9-10.5
    		c3.3-2.5,7.8-3.8,13.7-3.8c3.3,0,6,0.3,8.3,1c2.2,0.7,4.1,1.6,5.5,2.7c0.6,0.5,1.2,1,1.8,1.7c0.6,0.7,1.2,1.4,1.8,2.2
    		c0.6,0.8,1,1.5,1.4,2.3c0.4,0.7,0.6,1.4,0.6,2c0,1.3-0.5,2.4-1.6,3.1c-1,0.8-2.2,1.2-3.4,1.2c-0.7,0-1.5-0.1-2.1-0.6
    		c-0.6-0.6-1-1.3-1.3-1.8c-0.5-1.1-1.1-2-1.7-2.8c-0.5-0.8-1.2-1.5-2-2c-0.8-0.5-1.8-0.9-3-1.2c-1.2-0.3-2.7-0.4-4.4-0.4
    		c-3.5,0-6,0.6-7.6,1.7c-1.6,1.1-2.4,2.5-2.4,4.2c0,1.3,0.5,2.3,1.4,3.1c0.9,0.8,2.1,1.4,3.7,2c1.5,0.5,3.3,1,5.2,1.4
    		c2,0.4,3.9,0.8,5.9,1.3c2,0.5,4,1.1,5.9,1.7c1.9,0.7,3.7,1.6,5.2,2.7c1.5,1.1,2.7,2.5,3.7,4.1c0.9,1.6,1.4,3.6,1.4,6
    		C309.4,86.4,308.8,88.9,307.6,90.9z"/>
    	<path d="M327.4,48.8h4.7c1.1,0,2,0.4,2.8,1.2c0.8,0.8,1.2,1.7,1.2,2.8c0,1.1-0.4,2.1-1.2,2.8s-1.7,1.1-2.8,1.1h-4.7v37.9
    		c0,1.3-0.4,2.3-1.3,3.2c-0.9,0.9-2,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V56.7h-4.6c-1.1,0-2-0.4-2.8-1.1
    		c-0.8-0.7-1.2-1.7-1.2-2.8c0-1.1,0.4-2,1.2-2.8c0.8-0.8,1.7-1.2,2.8-1.2h4.6V39c0-1.3,0.4-2.3,1.3-3.2s1.9-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3s1.3,1.9,1.3,3.2V48.8z"/>
    	<path d="M341.5,32.1c1-1,2.2-1.5,3.7-1.5c1.4,0,2.6,0.5,3.6,1.5c1,1,1.5,2.2,1.5,3.6c0,1.4-0.5,2.6-1.5,3.6c-1,1-2.2,1.5-3.6,1.5
    		c-1.4,0-2.7-0.5-3.7-1.5c-1-1-1.5-2.2-1.5-3.6C340,34.2,340.5,33,341.5,32.1z M349.6,94.6c0,1.3-0.4,2.3-1.3,3.2
    		c-0.9,0.9-1.9,1.3-3.2,1.3c-1.3,0-2.3-0.4-3.2-1.3c-0.9-0.9-1.3-2-1.3-3.2V53.3c0-1.3,0.4-2.3,1.3-3.2c0.9-0.9,2-1.3,3.2-1.3
    		c1.3,0,2.3,0.4,3.2,1.3c0.9,0.9,1.3,2,1.3,3.2V94.6z"/>
    	<path d="M369.1,97.3c-2.9-1.2-5.4-3-7.5-5.2c-2.1-2.2-3.8-4.9-5-8.1c-1.2-3.1-1.8-6.6-1.8-10.4c0-3.8,0.6-7.3,1.8-10.5
    		c1.2-3.1,2.9-5.8,5-8.1c2.1-2.2,4.6-4,7.5-5.2c2.9-1.2,6-1.9,9.4-1.9c3.4,0,6.4,0.5,9,1.5c2.5,1,4.6,2.2,6.2,3.6
    		c1.6,1.4,3.2,2.9,4,4.4c0.5,0.9,0.9,1.5,0.9,2.6c0,1.3-0.5,2.3-1.4,3.1c-0.9,0.7-2,1.1-3.1,1.1c-0.8,0-1.6-0.2-2.2-0.6
    		c-0.7-0.4-1.2-1.3-1.8-2.1c-1-1.4-0.5-0.6-1.1-1.5c-0.7-0.9-1.5-1.6-2.5-2.3c-1-0.7-2.2-1.2-3.5-1.6c-1.4-0.4-2.8-0.6-4.4-0.6
    		c-1.8,0-3.5,0.3-5.3,1c-1.8,0.7-3.3,1.7-4.7,3.1c-1.4,1.4-2.5,3.3-3.4,5.6s-1.3,5.1-1.3,8.4c0,3.3,0.4,6.1,1.3,8.4s2,4.2,3.4,5.6
    		c1.4,1.4,3,2.5,4.7,3.1c1.8,0.7,3.5,1,5.3,1c1.6,0,3.1-0.2,4.4-0.6c1.3-0.4,2.5-0.9,3.5-1.6c1-0.7,1.8-1.5,2.5-2.3
    		c0.7-0.9,1.1-1.8,1.4-2.7c0.3-1,0.8-1.7,1.5-2.1c0.7-0.4,1.4-0.6,2.2-0.6c1.1,0,2.2,0.4,3.1,1.1c0.9,0.7,1.4,1.7,1.4,3
    		c0,0.6-0.3,1.7-0.9,3.1c-0.6,1.5-1.6,2.9-3.1,4.4c-1.5,1.5-3.5,2.8-6.2,4c-2.6,1.1-6,1.7-10,1.7C375.1,99.2,372,98.5,369.1,97.3z"
    		/>
    </g>
</svg>
						</div>
					</a>
				</h1>
			</div>
			<!-- Searchbar Input box -->
			<form method="get" action="/search" name="searchForm" class="header-search-form" id="searchMobileFrm">
			   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
			</form>
			<div class="mobile-auto-complete"></div> 
		</div>
		<div class="4u 6u(small) 6u(xsmall)">
			<!-- Mobile Menu -->
			<div class="mobile-menu-wrapper">
				<ul class="m-shortcuts">
					
					<li><a href="#" class="m-search" id="header-search"></a></li>
					
					<li><a href="/guide" class="m-docs" id="mobile-docs"></a></li>
					
					<li><a href="/contact" class="m-contact" id="mobile-contact"></a></li>
					
				</ul>											
				<nav class="nav-menu">
					<div class="menu-button">
						<span></span>
					</div>
					<div class="nav-menu-list-wrap">
						<div class="nav-menu-list">
							
								<h3><a href="/products" id="nav_products" >Products</a></h3>

								
								<ul>
									
									<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>
									
									<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>
									
									<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>
									
									<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>
									
									<li><a href="/products/beats" id="nav_beats" >beats</a></li>
									
									<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>
									
									<li><a href="/products/shield" id="nav_shield" >shield</a></li>
									
									<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>
									
									<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>
									
									<li><a href="/downloads" id="nav_downloads" >downloads</a></li>
									
								</ul>
								
							
								<h3><a href="/subscriptions" id="nav_subscriptions" >Subscriptions</a></h3>

								
							
								<h3><a href="/learn" id="nav_learn" >Learn</a></h3>

								
								<ul>
									
									<li><a href="/guide" id="nav_guide" >docs</a></li>
									
									<li><a href="/videos" id="nav_videos" >videos</a></li>
									
									<li><a href="/training" id="nav_training" >training</a></li>
									
									<li><a href="/services" id="nav_services" >services</a></li>
									
									<li><a href="/blog" id="nav_learn_blog" >blog</a></li>
									
									<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>
									
								</ul>
								
							
								<h3><a href="/community" id="nav_community" >Community</a></h3>

								
								<ul>
									
									<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>
									
									<li><a href="https://discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>
									
									<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>
									
								</ul>
								
							
								<h3><a href="/use-cases" id="nav_usecases" >Use Cases</a></h3>

								
							
								<h3><a href="/blog" id="nav_blog" >Blog</a></h3>

								
							
								<h3><a href="/about" id="nav_about" >About</a></h3>

								
								<ul>
									
									<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>
									
									<li><a href="/about/board" id="nav_board" >board of directors</a></li>
									
									<li><a href="/about/careers" id="nav_careers" >careers</a></li>
									
									<li><a href="/about/partners" id="nav_partners" >partners</a></li>
									
									<li><a href="/about/press" id="nav_press" >press</a></li>
									
								</ul>
								
							
						</div>
					</div>
				</nav>
			</div>
			<!-- Shortcuts -->
			<nav id="shortcuts">
				<ul class="links">
					
						<li class="shortcut-1 grayscale">
							<a href="/downloads" id="header_downloads" >
								<span class="img"></span>
								<span class="txt">downloads</span>	
							</a>
						</li>
					
						<li class="shortcut-2 grayscale">
							<a href="/guide" id="header_guide" >
								<span class="img"></span>
								<span class="txt">docs</span>	
							</a>
						</li>
					
						<li class="shortcut-3 grayscale">
							<a href="/subscriptions" id="header_subscriptions" >
								<span class="img"></span>
								<span class="txt">support</span>	
							</a>
						</li>
					
						<li class="shortcut-4 grayscale">
							<a href="https://discuss.elastic.co" id="header_discuss" target="_blank">
								<span class="img"></span>
								<span class="txt">discuss</span>	
							</a>
						</li>
					
						<li class="shortcut-5 grayscale">
							<a href="/contact" id="header_contact" >
								<span class="img"></span>
								<span class="txt">contact</span>	
							</a>
						</li>
					
				</ul>
			</nav>
		</div>
	</div>
</section>


<section class="desktop-main-nav">
	<div class="row">
		<div class="8u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						
							
						
						<a href="/products" id="nav_products"   >Products</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/found" id="nav_hosted-elasticsearch" >elasticsearch as a service</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/beats" id="nav_beats" >beats</a></li>								
							
								<li><a href="/products/watcher" id="nav_watcher" >watcher</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/subscriptions" id="nav_subscriptions"   >Subscriptions</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/learn" id="nav_learn"   >Learn</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="/training" id="nav_training" >training</a></li>								
							
								<li><a href="/services" id="nav_services" >services</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/community" id="nav_community"   >Community</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
							
								<li><a href="https://discuss.elastic.co" id="nav_discuss" target="_blank">discuss</a></li>								
							
								<li><a href="/community/codeofconduct" id="nav_codeofconduct" >code of conduct</a></li>								
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/use-cases" id="nav_usecases"   >Use Cases</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/blog" id="nav_blog"   >Blog</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						
							
						
						<a href="/about" id="nav_about"   >About</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="4u">
			<div class="languages-wrapper">
				<div class="global-language">
					<img src="https://static-www.elastic.co/static/img/icon-globe.png"/>
					<ul class="all-languages">
						
							<li><a href="/">English</a></li>
						
							<li><a href="/fr/">French</a></li>
						
							<li><a href="/de/">German</a></li>
						
							<li><a href="/jp/">Japanese</a></li>
						
							<li><a href="/kr/">Korean</a></li>
						
					</ul>
				</div>
				<div id="searchbar">
					<form method="get" action="/search" name="searchForm" id="searchfrm">
						<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
						<button class="button icon" onclick="searchForm.submit()">GO</button>
					</form>
				</div>
				<div class="nav-auto-complete"></div>
			</div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		#shortcuts ul.links li.shortcut-1 span.img{
			background-image: url("/assets/blt406dbf0c61aa5579/shortcuts.png");
    		background-repeat: no-repeat;
			display:inline-block;}
	
		#shortcuts ul.links li.shortcut-2 span.img{
			background-image: url("/assets/blt406dbf0c61aa5579/shortcuts.png");
    		background-repeat: no-repeat;
			display:inline-block;}
	
		#shortcuts ul.links li.shortcut-3 span.img{
			background-image: url("/assets/blt406dbf0c61aa5579/shortcuts.png");
    		background-repeat: no-repeat;
			display:inline-block;}
	
		#shortcuts ul.links li.shortcut-4 span.img{
			background-image: url("/assets/blt406dbf0c61aa5579/shortcuts.png");
    		background-repeat: no-repeat;
			display:inline-block;}
	
		#shortcuts ul.links li.shortcut-5 span.img{
			background-image: url("/assets/blt406dbf0c61aa5579/shortcuts.png");
    		background-repeat: no-repeat;
			display:inline-block;}
	
	
	
		.m-shortcuts li a.m-search {
			background: url("/assets/blt174b13be89ff803c/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-docs {
			background: url("/assets/blt5ba03f594a7d610a/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
	
		.m-shortcuts li a.m-contact {
			background: url("/assets/blt38c3e853c4b1174d/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
			background-size: contain;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1><a href="/learn" title="Learn">Learn</a> |</h1>
            <h2><a href="/guide" title="Docs">Docs</a></h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Watcher
      [watcher-1.0]
    </a></span> » <span class="breadcrumb-link"><a href="example-watches.html">Example Watches</a></span> » <span class="breadcrumb-node">Watching Marvel Data</span></div><div class="navheader"><span class="prev"><a href="example-watches.html">
              « 
              Example Watches</a>
           
        </span><span class="next">
           
          <a href="watching-time-series-data.html">Watching Time Series Data
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="watching-marvel-data"></a>Watching Marvel Data</h2></div></div></div><p>If you use Marvel to monitor your Elasticsearch deployment, you can set up
watches to take action when something out of the ordinary occurs. For example,
you could set up watches to alert on:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-cluster-health" title="Watching Cluster Health">Cluster health changes</a>
</li><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-memory-usage" title="Watching Memory Usage">High memory usage</a>
</li><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-cpu-usage" title="Watching CPU Usage">High cpu usage</a>
</li><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-open-file-descriptors" title="Watching Open File Descriptors">High file descriptor usage</a>
</li><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-fielddata" title="Watching Field Data Utilization">High fielddata cache usage</a>
</li><li class="listitem">
<a class="link" href="watching-marvel-data.html#watching-nodes" title="Watching for Nodes Joining or Leaving a Cluster">Nodes joining or leaving the cluster</a>
</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>These watches query the index where your cluster’s Marvel data is stored.
If you don’t have Marvel installed, the queries won’t return any results, the conditions
evaluate to false, and no actions are performed.</p></div></div><h4><a id="watching-cluster-health"></a>Watching Cluster Health</h4><p>This watch checks the cluster health once a minute and takes action if the cluster state has
been red for the last 60 seconds:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input gets the most recent cluster status from the <code class="literal">.marvel-*</code> indices.
</li><li class="listitem">
The watch condition checks the cluster status to see if it’s been red for the last 60 seconds.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/cluster_red_alert
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": ".marvel-*",
        "types": "cluster_stats",
        "body": {
          "query": {
            "filtered": {
              "filter": {
                "bool": {
                  "must": [
                    {
                      "range": {
                        "@timestamp": {
                          "gte": "now-2m",
                          "lte": "now"
                        }
                      }
                    }
                  ],
                  "should": [
                    {
                      "term": {
                        "status.raw": "red"
                      }
                    },
                    {
                      "term": {
                        "status.raw": "green"
                      }
                    },
                    {
                      "term": {
                        "status.raw": "yellow"
                      }
                    }
                  ]
                }
              }
            }
          },
          "fields": ["@timestamp","status"],
          "sort": [
            {
              "@timestamp": {
                "order": "desc"
              }
            }
          ],
          "size": 1,
          "aggs": {
            "minutes": {
              "date_histogram": {
                "field": "@timestamp",
                "interval": "5s"
              },
              "aggs": {
                "status": {
                  "terms": {
                    "field": "status.raw",
                    "size": 3
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "throttle_period": "30m", <a id="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "condition": {
    "script": {
      "inline": "if (ctx.payload.hits.total &lt; 1) return false; def rows = ctx.payload.hits.hits; if (rows[0].fields.status[0] != 'red') return false; if (ctx.payload.aggregations.minutes.buckets.size() &lt; 12) return false; def last60Seconds = ctx.payload.aggregations.minutes.buckets[-12..-1]; return last60Seconds.every { it.status.buckets.every { s -&gt; s.key == 'red' } }"
    }
  },
  "actions": {
    "send_email": { <a id="CO13-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "email": {
        "to": "&lt;username&gt;@&lt;domainname&gt;", <a id="CO13-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "subject": "Watcher Notification - Cluster has been RED for the last 60 seconds",
        "body": "Your cluster has been red for the last 60 seconds."
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/1.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once every 30 minutes.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in <code class="literal">elasticsearch.yml</code>.
    See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in
      Elasticsearch. While this is convenient when you’re experimenting with Watcher, in a
      production environment we recommend disabling dynamic scripting and using file scripts.</p></div></div><h4><a id="watching-memory-usage"></a>Watching Memory Usage</h4><p>This watch runs every minute and takes action if a node in the cluster has averaged 75% or greater
heap usage for the past 60 seconds.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input gets the average <code class="literal">jvm.mem.heap_used_percent</code> for each node from the <code class="literal">.marvel-*</code> indices.
</li><li class="listitem">
The watch condition checks to see if any node’s average heap usage is 75% or greater.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/mem_watch
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [
          ".marvel-*"
        ],
        "search_type": "count",
        "body": {
          "query": {
            "filtered": {
              "filter": {
                "range": {
                  "@timestamp": {
                    "gte": "now-2m",
                    "lte": "now"
                  }
                }
              }
            }
          },
          "aggs": {
            "minutes": {
              "date_histogram": {
                "field": "@timestamp",
                "interval": "minute"
              },
              "aggs": {
                "nodes": {
                  "terms": {
                    "field": "node.name.raw",
                    "size": 10,
                    "order": {
                      "memory": "desc"
                    }
                  },
                  "aggs": {
                    "memory": {
                      "avg": {
                        "field": "jvm.mem.heap_used_percent"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "throttle_period": "30m", <a id="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "condition": {
    "script":  "if (ctx.payload.aggregations.minutes.buckets.size() == 0) return false; def latest = ctx.payload.aggregations.minutes.buckets[-1]; def node = latest.nodes.buckets[0]; return node &amp;&amp; node.memory &amp;&amp; node.memory.value &gt;= 75;"
  },
  "actions": {
    "send_email": {
      "transform": {
        "script": "def latest = ctx.payload.aggregations.minutes.buckets[-1]; return latest.nodes.buckets.findAll { return it.memory &amp;&amp; it.memory.value &gt;= 75 };"
      },
      "email": { <a id="CO14-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "to": "&lt;username&gt;@&lt;domainname&gt;", <a id="CO14-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "subject": "Watcher Notification - HIGH MEMORY USAGE",
        "body": "Nodes with HIGH MEMORY Usage (above 75%):\n\n{{#ctx.payload._value}}\"{{key}}\" - Memory Usage is at {{memory.value}}%\n{{/ctx.payload._value}}"
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/2.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once every 30 minutes.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in <code class="literal">elasticsearch.yml</code>.
    See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in Elasticsearch.
      While this is convenient when you’re experimenting with Watcher, in a production
      environment we recommend disabling dynamic scripting and using file scripts.</p></div></div><h4><a id="watching-cpu-usage"></a>Watching CPU Usage</h4><p>This watch runs every minute and takes action if a node in the cluster has averaged 75% or greater CPU
usage for the past 60 seconds.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input gets the average CPU usage for each node from the <code class="literal">.marvel-*</code> indices.
</li><li class="listitem">
The watch condition checks to see if any node’s average CPU usage is 75% or greater.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/cpu_usage
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [
          ".marvel-*"
        ],
        "search_type": "count",
        "body": {
          "query": {
            "filtered": {
              "filter": {
                "range": {
                  "@timestamp": {
                    "gte": "now-2m",
                    "lte": "now"
                  }
                }
              }
            }
          },
          "aggs": {
            "minutes": {
              "date_histogram": {
                "field": "@timestamp",
                "interval": "minute"
              },
              "aggs": {
                "nodes": {
                  "terms": {
                    "field": "node.name.raw",
                    "size": 10,
                    "order": {
                      "cpu": "desc"
                    }
                  },
                  "aggs": {
                    "cpu": {
                      "avg": {
                        "field": "os.cpu.user"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "throttle_period": "30m", <a id="CO15-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "condition": {
    "script":  "if (ctx.payload.aggregations.minutes.buckets.size() == 0) return false; def latest = ctx.payload.aggregations.minutes.buckets[-1]; def node = latest.nodes.buckets[0]; return node &amp;&amp; node.cpu &amp;&amp; node.cpu.value &gt;= 75;"
  },
  "actions": {
    "send_email": { <a id="CO15-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "transform": {
        "script": "def latest = ctx.payload.aggregations.minutes.buckets[-1]; return latest.nodes.buckets.findAll { return it.cpu &amp;&amp; it.cpu.value &gt;= 75 };"
      },
      "email": {
        "to": "user@example.com", <a id="CO15-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "subject": "Watcher Notification - HIGH CPU USAGE",
        "body": "Nodes with HIGH CPU Usage (above 75%):\n\n{{#ctx.payload._value}}\"{{key}}\" - CPU Usage is at {{cpu.value}}%\n{{/ctx.payload._value}}"
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/3.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once every 30 minutes.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in <code class="literal">elasticsearch.yml</code>.
    See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in Elasticsearch.
      While this is convenient when you’re experimenting with Watcher, in a production
      environment we recommend disabling dynamic scripting and using file scripts.</p></div></div><h4><a id="watching-open-file-descriptors"></a>Watching Open File Descriptors</h4><p>This watch runs once a minute and takes action if there are nodes that
are using 80% or more of the available file descriptors.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input gets the average number of open file descriptors on each node from the <code class="literal">.marvel-*</code>
  indices. The input search returns the top ten nodes with the highest average number of open file
  descriptors.
</li><li class="listitem">
The watch condition checks the cluster status to see if any node’s average number of open file
  descriptors is 80% or greater.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/open_file_descriptors
{
  "metadata": {
    "system_fd": 65535,
    "threshold": 0.8
  },
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [
          ".marvel-*"
        ],
        "types": "node_stats",
        "search_type": "count",
        "body": {
          "query": {
            "filtered": {
              "filter": {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m",
                    "lte": "now"
                  }
                }
              }
            }
          },
          "aggs": {
            "minutes": {
              "date_histogram": {
                "field": "@timestamp",
                "interval": "5s"
              },
              "aggs": {
                "nodes": {
                  "terms": {
                    "field": "node.name.raw",
                    "size": 10,
                    "order": {
                      "fd": "desc"
                    }
                  },
                  "aggs": {
                    "fd": {
                      "avg": {
                        "field": "process.open_file_descriptors"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "throttle_period": "30m", <a id="CO16-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "condition": {
    "script": "if (ctx.payload.aggregations.minutes.buckets.size() == 0) return false; def latest = ctx.payload.aggregations.minutes.buckets[-1]; def node = latest.nodes.buckets[0]; return node &amp;&amp; node.fd &amp;&amp; node.fd.value &gt;= (ctx.metadata.system_fd * ctx.metadata.threshold);"
  },
  "actions": {
    "send_email": { <a id="CO16-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "transform": {
        "script": "def latest = ctx.payload.aggregations.minutes.buckets[-1]; return latest.nodes.buckets.findAll({ return it.fd &amp;&amp; it.fd.value &gt;= (ctx.metadata.system_fd * ctx.metadata.threshold) }).collect({ it.fd.percent = Math.round((it.fd.value/ctx.metadata.system_fd)*100); it });"
      },
      "email": {
        "to": "&lt;username&gt;@&lt;domainname&gt;", <a id="CO16-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "subject": "Watcher Notification - NODES WITH 80% FILE DESCRIPTORS USED",
        "body": "Nodes with 80% FILE DESCRIPTORS USED (above 80%):\n\n{{#ctx.payload._value}}\"{{key}}\" - File Descriptors is at {{fd.value}} ({{fd.percent}}%)\n{{/ctx.payload._value}}"
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/4.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once a minute.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in
    <code class="literal">elasticsearch.yml</code>. See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more
    information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in
      Elasticsearch. While this is convenient when you’re experimenting with Watcher, in a
      production environment we recommend disabling dynamic scripting and using file scripts.</p></div></div><h4><a id="watching-fielddata"></a>Watching Field Data Utilization</h4><p>This watch runs once a minute and takes action if there are nodes that
are using 80% or more of their field data cache.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input gets the average field data memory usage on each node from the <code class="literal">.marvel-*</code> indices.
  The input search returns the top ten nodes with the highest average field data usage.
</li><li class="listitem">
The watch condition checks the cluster status to see if any node’s average field data usage is 80%
  or more of the field data cache size.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/fielddata_utilization
{
  "metadata": {
    "fielddata_cache_size": 100000, <a id="CO17-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "threshold": 0.8
  },
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [
          ".marvel-*"
        ],
        "types": "node_stats",
        "search_type": "count",
        "body": {
          "query": {
            "filtered": {
              "filter": {
                "range": {
                  "@timestamp": {
                    "gte": "now-1m",
                    "lte": "now"
                  }
                }
              }
            }
          },
          "aggs": {
            "minutes": {
              "date_histogram": {
                "field": "@timestamp",
                "interval": "5s"
              },
              "aggs": {
                "nodes": {
                  "terms": {
                    "field": "node.name.raw",
                    "size": 10,
                    "order": {
                      "fielddata": "desc"
                    }
                  },
                  "aggs": {
                    "fielddata": {
                      "avg": {
                        "field": "indices.fielddata.memory_size_in_bytes"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "throttle_period": "30m", <a id="CO17-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
  "condition": {
    "script": "if (ctx.payload.aggregations.minutes.buckets.size() == 0) return false; def latest = ctx.payload.aggregations.minutes.buckets[-1]; def node = latest.nodes.buckets[0]; return node &amp;&amp; node.fielddata &amp;&amp; node.fielddata.value &gt;= (ctx.metadata.fielddata_cache_size * ctx.metadata.threshold);"
  },
  "actions": {
    "send_email": { <a id="CO17-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
      "transform": {
        "script": "def latest = ctx.payload.aggregations.minutes.buckets[-1]; return latest.nodes.buckets.findAll({ return it.fielddata &amp;&amp; it.fielddata.value &gt;= (ctx.metadata.fielddata_cache_size * ctx.metadata.threshold) }).collect({ it.fielddata.percent = Math.round((it.fielddata.value/ctx.metadata.fielddata_cache_size)*100); it });"
      },
      "email": {
        "to": "&lt;username&gt;@&lt;domainname&gt;", <a id="CO17-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        "subject": "Watcher Notification - NODES WITH 80% FIELDDATA UTILIZATION",
        "body": "Nodes with 80% FIELDDATA UTILIZATION (above 80%):\n\n{{#ctx.payload._value}}\"{{key}}\" - Fielddata utilization is at {{fielddata.value}} bytes ({{fielddata.percent}}%)\n{{/ctx.payload._value}}"
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/5.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The size of the field data cache. Set to the actual cache size configured for your nodes.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once a minute.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in
    <code class="literal">elasticsearch.yml</code>. See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more
    information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in
      Elasticsearch. While this is convenient when you’re experimenting with Watcher, in a
      production environment we recommend disabling dynamic scripting and using file scripts.</p></div></div><h4><a id="watching-nodes"></a>Watching for Nodes Joining or Leaving a Cluster</h4><p>This watch checks every minute to see if a node has joined or left the cluster:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The watch schedule is set to execute the watch every minute.
</li><li class="listitem">
The watch input searches for <code class="literal">node_left</code> and <code class="literal">node_joined</code> events in the past 60 seconds.
</li><li class="listitem">
The watch condition checks to see if there are any search results in the payload. If so,
  the watch actions are performed.
</li><li class="listitem">
The watch action is to send an email. (You could also call a <code class="literal">webhook</code> or store the event.)
</li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-json">PUT _watcher/watch/node_event
{
  "trigger": {
    "schedule": {
      "interval": "60s"
    }
  },
  "input": {
    "search": {
      "request": {
        "indices": [
          ".marvel-*"
        ],
        "search_type": "query_then_fetch",
        "body": {
          "query": {
            "filtered": {
              "query": {
                "bool": {
                  "should": [
                    {
                      "match": {
                        "event": "node_left"
                      }
                    },
                    {
                      "match": {
                        "event": "node_joined"
                      }
                    }
                  ]
                }
              },
              "filter": {
                "range": {
                  "@timestamp": {
                    "from": "{{ctx.trigger.scheduled_time}}||-60s",
                    "to": "{{ctx.trigger.triggered_time}}"
                  }
                }
              }
            }
          },
          "fields": [
            "event",
            "message",
            "cluster_name"
          ],
          "sort": [
            {
              "@timestamp": {
                "order": "desc"
              }
            }
          ]
        }
      }
    }
  },
  "throttle_period": "60s", <a id="CO18-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  "condition": {
    "script": {
      "inline": "ctx.payload.hits.size() &gt; 0 "
    }
  },
  "actions": {
    "send_email": { <a id="CO18-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "email": {
        "to": "&lt;username&gt;@&lt;domainname&gt;", <a id="CO18-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "subject": "{{ctx.payload.hits.hits.0.fields.event}} the cluster",
        "body": "{{ctx.payload.hits.hits.0.fields.message}} the cluster {{ctx.payload.hits.hits.0.fields.cluster_name}} "
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/watching-marvel-data/6.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The throttle period prevents notifications from being sent more than once a minute.
    You can change the throttle period to receive notifications more or less frequently.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
To send email notifications, you must configure at least one email account in
    <code class="literal">elasticsearch.yml</code>. See <a class="link" href="email-services.html" title="Configuring Watcher to Send Email">Configuring Email Services</a> for more
    information.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specify the email address you want to notify.
</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This example uses an inline script, which requires you to enable dynamic scripting in
      Elasticsearch. While this is convenient when you’re experimenting with Watcher, in a
      production environment we recommend disabling dynamic scripting and using file scripts.</p></div></div></div><div class="navfooter"><span class="prev"><a href="example-watches.html">
              « 
              Example Watches</a>
           
        </span><span class="next">
           
          <a href="watching-time-series-data.html">Watching Time Series Data
               »
            </a></span></div>
<!-- end body -->

            </section>

            <div id="rtpcontainer"
        >
	<h3>Top Videos</h3>
	<ul class="lists">
		<li><a href="https://www.elastic.co/webinars/get-started-with-elasticsearch/?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li>
		<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
		<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
	</ul>
</div>


	  	

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
	<!-- subscribe-newsletter -->
	<div id="subscribe-newsletter">
		<div class="container">
			<div class="row">
				<div class="12u">
					<div class="subscribe-wrapper" id="rtp-newsletter">
						<header>
							<h3>Subscribe to Our Newsletter</h3>
						</header>
						<div class="subscribe-form">
							<form id="mktoForm_1398" class="container"></form>
							<div class="form_thanks hide">
								
									<p>Thanks for subscribing! We'll keep you updated with new releases.</p>
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

  	<!-- Footer -->
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="https://www.linkedin.com/company/elastic-co" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
						<li class="youtube grayscale"><a href="https://www.youtube.com/user/elasticsearch" target="_blank" id="footer_youtube"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/bltda40eebd7c7cae9a/facebook.svg") no-repeat;}		
	
		.twitter{background:url("/assets/bltfd3b1511512f4632/twitter.svg") no-repeat;}		
	
		.linkedin{background:url("/assets/blt6b4f6f8d6b96f814/linkedin.svg") no-repeat;}		
	
		.xing{background:url("/assets/blta76b2ae2b2f10a98/xing.svg") no-repeat;}		
	
		.youtube{background:url("/assets/blt5761648c9581fb53/youtube.svg") no-repeat;}		
	
</style>

<script>
MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
	form.onSuccess(function(form){
		$('#mktoForm_1398').css('display','none');
		$('#subscribe-newsletter header').hide();
		$('#mktoForm_1398').siblings('.form_thanks').removeClass('hide')
		dataLayer.push({'event': 'mktoFormSubmit'});
	    return false;
  	});
});
</script>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js"></script>
<script src="https://static-www.elastic.co/static/js/script.js?clr=150"></script>

   	
   	
   	
   	<script type="application/ld+json">
	
		
	
	{
	  	"@context": "http://schema.org",
	  	"@type": "Organization",
	  	"name" : "Elastic",
	  	"url": "https://www.elastic.co/",
	  	"logo": "https://www.elastic.co/static/img/elastic-logo-200.pngg",
		"sameAs" : [ "https://www.facebook.com/elastic.co",
			"https://twitter.com/elastic",
			"https://plus.google.com/105178019064686397293",
			"https://www.youtube.com/user/elasticsearch",
			"https://www.linkedin.com/company/elasticsearch"
		],
	  	"potentialAction": {
	    	"@type": "SearchAction",
	    	"target": "https://www.elastic.co/search?q={query_string}",
	    	"query-input": "required name=query_string"
	  	}
	}
</script>	

            <script type="text/javascript" src="docs.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>

            </body>
        

