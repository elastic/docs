<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Disable swapping
        | Elasticsearch Reference [5.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.x]" /><link rel="up" href="system-config.html" title="Important System Configuration" /><link rel="prev" href="heap-size.html" title="Set JVM heap size via jvm.options" /><link rel="next" href="file-descriptors.html" title="File Descriptors" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.x" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.x]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="system-config.html">Important System Configuration</a></span> » <span class="breadcrumb-node">Disable swapping</span></div><div xmlns="" class="navheader"><span class="prev"><a href="heap-size.html">
              « 
              Set JVM heap size via jvm.options</a>
           
        </span><span class="next">
           
          <a href="file-descriptors.html">File Descriptors
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setup-configuration-memory"></a>Disable swapping<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.x/docs/reference/setup/sysconfig/swap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Most operating systems try to use as much memory as possible for file system
caches and eagerly swap out unused application memory. This can result in
parts of the JVM heap being swapped out to disk.</p><p>Swapping is very bad for performance and for node stability and should be
avoided at all costs. It can cause garbage collections to last for <span class="strong"><strong>minutes</strong></span>
instead of milliseconds and can cause nodes to respond slowly or even to
disconnect from the cluster.</p><p>There are three approaches to disabling swapping:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mlockall"></a>Enable <code class="literal">bootstrap.memory_lock</code><a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.x/docs/reference/setup/sysconfig/swap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The first option is to use
<a class="ulink" href="http://opengroup.org/onlinepubs/007908799/xsh/mlockall.html" target="_top">mlockall</a> on Linux/Unix systems, or <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366895%28v=vs.85%29.aspx" target="_top">VirtualLock</a> on Windows, to
try to lock the process address space into RAM, preventing any Elasticsearch
memory from being swapped out.  This can be done, by adding this line
to the <code class="literal">config/elasticsearch.yml</code> file:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">bootstrap.memory_lock: true</pre></div><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml"><code class="literal">mlockall</code> might cause the JVM or shell session to exit if it tries
to allocate more memory than is available!</p></div></div><p>After starting Elasticsearch, you can see whether this setting was applied
successfully by checking the value of <code class="literal">mlockall</code> in the output from this
request:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET _nodes?filter_path=**.mlockall</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>If you see that <code class="literal">mlockall</code> is <code class="literal">false</code>, then it means that the <code class="literal">mlockall</code>
request has failed.  You will also see a line with more information in the
logs with the words <code class="literal">Unable to lock JVM Memory</code>.</p><p>The most probable reason, on Linux/Unix systems, is that the user running
Elasticsearch doesn’t have permission to lock memory.  This can be granted as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">.zip</code> and <code class="literal">.tar.gz</code>
</span></dt><dd>
  Set <a class="link" href="setting-system-settings.html#ulimit" title="ulimit"><code class="literal">ulimit -l unlimited</code></a> as root before starting Elasticsearch,
  or set <code class="literal">memlock</code> to <code class="literal">unlimited</code> in
  <a class="link" href="setting-system-settings.html#limits.conf" title="/etc/security/limits.conf"><code class="literal">/etc/security/limits.conf</code></a>.
</dd><dt><span class="term">
RPM and Debian
</span></dt><dd>
  Set <code class="literal">MAX_LOCKED_MEMORY</code> to <code class="literal">unlimited</code> in the
  <a class="link" href="setting-system-settings.html#sysconfig" title="Sysconfig file">system configuration file</a> (or see below for systems using <code class="literal">systemd</code>).
</dd><dt><span class="term">
Systems using <code class="literal">systemd</code>
</span></dt><dd>
  Set <code class="literal">LimitMEMLOCK</code> to <code class="literal">infinity</code> in the <a class="link" href="setting-system-settings.html#systemd" title="Systemd configuration">systemd configuration</a>.
</dd></dl></div><p>Another possible reason why <code class="literal">mlockall</code> can fail is that the temporary directory
(usually <code class="literal">/tmp</code>) is mounted with the <code class="literal">noexec</code> option. This can be solved by
specifying a new temp directory using the <code class="literal">ES_JAVA_OPTS</code> environment variable:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">export ES_JAVA_OPTS="$ES_JAVA_OPTS -Djava.io.tmpdir=/path/to/temp/dir"
./bin/elasticsearch</pre></div><p>or setting this JVM flag in the jvm.options configuration file.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="disable-swap-files"></a>Disable all swap files<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.x/docs/reference/setup/sysconfig/swap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The second option is to completely disable swap. Usually Elasticsearch
is the only service running on a box, and its memory usage is controlled
by the JVM options.  There should be no need to have swap enabled.</p><p>On Linux systems, you can disable swap temporarily
by running: <code class="literal">sudo swapoff -a</code>. To disable it permanently, you will need
to edit the <code class="literal">/etc/fstab</code> file and comment out any lines that contain the
word <code class="literal">swap</code>.</p><p>On Windows, the equivalent can be achieved by disabling the paging file entirely
via <code class="literal">System Properties → Advanced → Performance → Advanced → Virtual memory</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="swappiness"></a>Configure <code class="literal">swappiness</code><a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.x/docs/reference/setup/sysconfig/swap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Another option available on Linux systems is to ensure that the sysctl value
<code class="literal">vm.swappiness</code> is set to <code class="literal">1</code>. This reduces the kernel’s tendency to swap and
should not lead to swapping under normal circumstances, while still allowing
the whole system to swap in emergency conditions.</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="heap-size.html">
              « 
              Set JVM heap size via jvm.options</a>
           
        </span><span class="next">
           
          <a href="file-descriptors.html">File Descriptors
               »
            </a></span></div></body></html>