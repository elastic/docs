<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Significant Terms Aggregation
        | Elasticsearch Reference [1.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [1.4]" /><link rel="up" href="search-aggregations.html" title="Aggregations" /><link rel="prev" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation" /><link rel="next" href="search-aggregations-bucket-range-aggregation.html" title="Range Aggregation" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Docs/Elasticsearch/Reference/1.4" />
  	
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- RTP tag -->
    <script type='text/javascript' async>
    (function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
     c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
     g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
     })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");

    rtp('send','view');
    rtp('get', 'campaign',true);
    </script>
    <!-- End of RTP tag -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >


<!-- end DC tags -->


	<meta name="description" content="" />





	<meta property="og:image" content="/static/img/cluster-small.png" />

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	   

    <!-- css -->
    <link href="https://static-www.elastic.co/static/css/main.css?q=802" rel="stylesheet">
    
    

    <script src="https://static-www.elastic.co/static/js/jquery.min.js?q=802"></script>
    <script src="https://static-www.elastic.co/static/js/bootstrap.min.js?q=802"></script>
    <script src="https://static-www.elastic.co/static/js/jquery.cookie.js?q=802"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // ---------------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
        locales = {
          '/en/': '/',
          '/de/': '/de/',
          '/fr/': '/fr/',
          '/ja/':'/jp/',
          '/ko/':'/kr/'
        }
        localepages = ['/','/de/','/fr/','/jp/','/kr/','/products','/de/products','/fr/products','/jp/products','/kr/products'],
        locationpath = window.location.pathname,
        localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}',
        currentlocale = JSON.parse(localeUrl);
    
      if(localepages.indexOf(locationpath) != -1){
        if($.cookie("c_lang")){
          if($.cookie("c_lang") != currentlocale.relative_url_prefix){
            var cookieurl = $.cookie("c_lang") + currentlocale.url.slice(1,currentlocale.url.length);
            window.location = cookieurl;
          }
        }
        else{
          var locale_lang = "/";
          if(locales[lang] != undefined){
            locale_lang = locales[lang];
          }
          $.cookie("c_lang",locale_lang ,{ expires: 365, path: '/'}); 
          window.location = localepages[localepages.indexOf(locationpath)];
        }
      }
      
      // --------------------- end of set language based on browser language -----------------
      </script>


	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/guide.css?q=802" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- begin olark code -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
    f[z]=function(){
    (a.s=a.s||[]).push(arguments)};var a=f[z]._={
    },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
    0:+new Date};a.P=function(u){
    a.p[u]=new Date-a.p[0]};function s(){
    a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
    hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
    return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
    b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
    b.contentWindow[g].open()}catch(w){
    c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
    var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
    b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
    /* custom configuration goes here (www.olark.com/documentation) */
    olark.identify('1356-750-10-5709');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1356-750-10-5709/contact" title="Contact us">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <!-- end olark code -->

    <script> 
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
      ga('create', 'UA-12395217-16', 'auto'); 
      ga('send', 'pageview'); 
    </script>

    <!-- Header Section -->
    
<header class="header-wrapper">
   

  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
            <a href="/learn" class="nav-title hidden-sm hidden-md hidden-lg m-l-8">Learn</a>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <h1>
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="https://static-www.elastic.co/assets/bltd5ac38b4549d53de/elastic-logo-mobile (1).svg?q=802" alt="elastic-logo-mobile">
              </a>
            </h1>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>
            <li id="searchbar"><a class="button icon" href="#"></a></li>
            <li class="lang global-language">
                
                  <a href="#">EN</a>
                
              <ul class="language-list">
                
                  
                    
                  
                <li><a href="/" data-value="/" id="locale-select">English</a></li>
                
                  
                    
                  
                <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                
                  
                    
                  
                <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                
                  
                    
                  
                <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                
                  
                    
                  
                <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <h1>
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="https://static-www.elastic.co/assets/blt6050efb80ceabd47/elastic-logo (2).svg?q=802" alt="elastic-logo">
          </a>
        </h1>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a id="nav_products" class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_cloud" class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_services" class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_customers" class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_learn" class="active" href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#"></a></li>
          <li class="hidden-xs lang global-language">
                
                  <a href="#">EN</a>
                
               <ul class="language-list">
              
                
                  
                
              <li><a class="" href="/" data-value="/">English</a></li>
              
                
                  
                
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
                
                  
                
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
                
                  
                
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
                
                  
                
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="https://static-www.elastic.co/static/css/horizon-swiper.min.css?q=802">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("https://static-www.elastic.co/assets/blt7b9c4fe6528dc4ef/m-search-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("https://static-www.elastic.co/assets/blt44d8b7530a76d01c/m-guide-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("https://static-www.elastic.co/assets/blt878040795c9d083b/m-contact-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/horizon-swiper.min.js?q=802"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-arrow').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').toggleClass('show');
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-arrow')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    


  





  
  
  
  
    <div class="tertiary-nav">
      <div class="container">
        <div class="p-t-b-15 bdr-btm-e0e0e0 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  

</style>
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.4]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs </a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Significant Terms Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-terms-aggregation.html">
              « 
              Terms Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-significantterms-aggregation"></a>Significant Terms Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>An aggregation that returns interesting or unusual occurrences of terms in a set.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h3>Experimental!</h3><p>This feature is marked as experimental, and may be subject to change in the
future.  If you use this feature, please let us know your experience with it!</p></div></div><div class="itemizedlist"><p class="title"><strong>Example use cases:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
Suggesting "H5N1" when users search for "bird flu" in text
</li><li class="listitem">
Identifying the merchant that is the "common point of compromise" from the transaction history of credit card owners reporting loss
</li><li class="listitem">
Suggesting keywords relating to stock symbol $ATI for an automated news classifier
</li><li class="listitem">
Spotting the fraudulent doctor who is diagnosing more than his fair share of whiplash injuries
</li><li class="listitem">
Spotting the tire manufacturer who has a disproportionate number of blow-outs
</li></ul></div><p>In all these cases the terms being selected are not simply the most popular terms in a set.
They are the terms that have undergone a significant change in popularity measured between a <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> set.
If the term "H5N1" only exists in 5 documents in a 10 million document index and yet is found in 4 of the 100 documents that make up a user’s search results
that is significant and probably very relevant to their search. 5/10,000,000 vs 4/100 is a big swing in frequency.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_single_set_analysis"></a>Single-set analysis<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the simplest case, the <span class="emphasis"><em>foreground</em></span> set of interest is the search results matched by a query and the <span class="emphasis"><em>background</em></span>
set used for statistical comparisons is the index or indices from which the results were gathered.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "terms" : {"force" : [ "British Transport Police" ]}
    },
    "aggregations" : {
        "significantCrimeTypes" : {
            "significant_terms" : { "field" : "crime_type" }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    ...

    "aggregations" : {
        "significantCrimeTypes" : {
            "doc_count": 47347,
            "buckets" : [
                {
                    "key": "Bicycle theft",
                    "doc_count": 3640,
                    "score": 0.371235374214817,
                    "bg_count": 66799
                }
                ...
            ]
        }
    }
}</pre></div><p>When querying an index of all crimes from all police forces, what these results show is that the British Transport Police force
stand out as a force dealing with a disproportionately large number of bicycle thefts. Ordinarily, bicycle thefts represent only 1% of crimes (66799/5064554)
but for the British Transport Police, who handle crime on railways and stations, 7% of crimes (3640/47347) is
a bike theft. This is a significant seven-fold increase in frequency and so this anomaly was highlighted as the top crime type.</p><p>The problem with using a query to spot anomalies is it only gives us one subset to use for comparisons.
To discover all the other police forces' anomalies we would have to repeat the query for each of the different forces.</p><p>This can be a tedious way to look for unusual patterns in an index</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_set_analysis"></a>Multi-set analysis<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A simpler way to perform analysis across multiple categories is to use a parent-level aggregation to segment the data ready for analysis.</p><p>Example using a parent aggregation for segmentation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggregations": {
        "forces": {
            "terms": {"field": "force"},
            "aggregations": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
 ...

 "aggregations": {
    "forces": {
        "buckets": [
            {
                "key": "Metropolitan Police Service",
                "doc_count": 894038,
                "significantCrimeTypes": {
                    "doc_count": 894038,
                    "buckets": [
                        {
                            "key": "Robbery",
                            "doc_count": 27617,
                            "score": 0.0599,
                            "bg_count": 53182
                        },
                        ...
                    ]
                }
            },
            {
                "key": "British Transport Police",
                "doc_count": 47347,
                "significantCrimeTypes": {
                    "doc_count": 47347,
                    "buckets": [
                        {
                            "key": "Bicycle theft",
                            "doc_count": 3640,
                            "score": 0.371,
                            "bg_count": 66799
                        },
                        ...
                    ]
                }
            }
        ]
    }
}</pre></div><p>Now we have anomaly detection for each of the police forces using a single request.</p><p>We can use other forms of top-level aggregations to segment our data, for example segmenting by geographic
area to identify unusual hot-spots of a particular crime type:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggs": {
        "hotspots": {
            "geohash_grid" : {
                "field":"location",
                "precision":5,
            },
            "aggs": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre></div><p>This example uses the <code class="literal">geohash_grid</code> aggregation to create result buckets that represent geographic areas, and inside each
bucket we can identify anomalous levels of a crime type in these tightly-focused areas e.g.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Airports exhibit unusual numbers of weapon confiscations
</li><li class="listitem">
Universities show uplifts of bicycle thefts
</li></ul></div><p>At a higher geohash_grid zoom-level with larger coverage areas we would start to see where an entire police-force may be
tackling an unusual volume of a particular crime type.</p><p>Obviously a time-based top-level segmentation would help identify current trends for each point in time
where a simple <code class="literal">terms</code> aggregation would typically show the very popular "constants" that persist across all time slots.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>How are the scores calculated?</strong></p></div></div></div><p>The numbers returned for scores are primarily intended for ranking different suggestions sensibly rather than something easily understood by end users. The scores are derived from the doc frequencies in <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> sets. In brief, a term is considered significant if there is a noticeable difference in the frequency in which a term appears in the subset and in the background. The way the terms are ranked can be configured, see "Parameters" section.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_use_on_free_text_fields"></a>Use on free-text fields<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The significant_terms aggregation can be used effectively on tokenized free-text fields to suggest:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
keywords for refining end-user searches
</li><li class="listitem">
keywords for use in percolator queries
</li></ul></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Picking a free-text field as the subject of a significant terms analysis can be expensive! It will attempt
to load every unique word into RAM. It is recommended to only use this on smaller indices.</p></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Use the <span class="emphasis"><em>"like this but not this"</em></span> pattern</strong></p></div></div></div><p>You can spot mis-categorized content by first searching a structured field e.g. <code class="literal">category:adultMovie</code> and use significant_terms on the
free-text "movie_description" field. Take the suggested words (I’ll leave them to your imagination) and then search for all movies NOT marked as category:adultMovie but containing these keywords.
You now have a ranked list of badly-categorized movies that you should reclassify or at least remove from the "familyFriendly" category.</p><p>The significance score from each term can also provide a useful <code class="literal">boost</code> setting to sort matches.
Using the <code class="literal">minimum_should_match</code> setting of the <code class="literal">terms</code> query with the keywords will help control the balance of precision/recall in the result set i.e
a high setting would have a small number of relevant results packed full of keywords and a setting of "1" would produce a more exhaustive results set with all documents containing <span class="emphasis"><em>any</em></span> keyword.</p></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p><strong>Show significant_terms in context. </strong>Free-text significant_terms are much more easily understood when viewed in context. Take the results of <code class="literal">significant_terms</code> suggestions from a
free-text field and use them in a <code class="literal">terms</code> query on the same field with a <code class="literal">highlight</code> clause to present users with example snippets of documents. When the terms
are presented unstemmed, highlighted, with the right case, in the right order and with some context, their significance/meaning is more readily apparent.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_custom_background_sets"></a>Custom background sets<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Ordinarily, the foreground set of documents is "diffed" against a background set of all the documents in your index.
However, sometimes it may prove useful to use a narrower background set as the basis for comparisons.
For example, a query on documents relating to "Madrid" in an index with content from all over the world might reveal that "Spanish"
was a significant term. This may be true but if you want some more focused terms you could use a <code class="literal">background_filter</code>
on the term <span class="emphasis"><em>spain</em></span> to establish a narrower set of documents as context. With this as a background "Spanish" would now
be seen as commonplace and therefore not as significant as words like "capital" that relate more strongly with Madrid.
Note that using a background filter will slow things down - each term’s background frequency must now be derived on-the-fly from filtering posting lists rather than reading the index’s pre-computed count for a term.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_limitations"></a>Limitations<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_significant_terms_must_be_indexed_values"></a>Significant terms must be indexed values<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Unlike the terms aggregation it is currently not possible to use script-generated terms for counting purposes.
Because of the way the significant_terms aggregation must consider both <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> frequencies
it would be prohibitively expensive to use a script on the entire index to obtain background frequencies for comparisons.
Also DocValues are not supported as sources of term data for similar reasons.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_no_analysis_of_floating_point_fields"></a>No analysis of floating point fields<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Floating point fields are currently not supported as the subject of significant_terms analysis.
While integer or long fields can be used to represent concepts like bank account numbers or category numbers which
can be interesting to track, floating point fields are usually used to represent quantities of something.
As such, individual floating point terms are not useful for this form of frequency analysis.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_as_a_parent_aggregation"></a>Use as a parent aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If there is the equivalent of a <code class="literal">match_all</code> query or no query criteria providing a subset of the index the significant_terms aggregation should not be used as the
top-most aggregation - in this scenario the <span class="emphasis"><em>foreground</em></span> set is exactly the same as the <span class="emphasis"><em>background</em></span> set and
so there is no difference in document frequencies to observe and from which to make sensible suggestions.</p><p>Another consideration is that  the significant_terms aggregation produces many candidate results at shard level
that are only later pruned on the reducing node once all statistics from all shards are merged. As a result,
it can be inefficient and costly in terms of RAM to embed large child aggregations under a significant_terms
aggregation that later discards many candidate terms. It is advisable in these cases to perform two searches - the first to provide a rationalized list of
significant_terms and then add this shortlist of terms to a second query to go back and fetch the required child aggregations.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_approximate_counts"></a>Approximate counts<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The counts of how many documents contain a term provided in results are based on summing the samples returned from each shard and
as such may be:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
low if certain shards did not provide figures for a given term in their top sample
</li><li class="listitem">
high when considering the background frequency as it may count occurrences found in deleted documents
</li></ul></div><p>Like most design decisions, this is the basis of a trade-off in which we have chosen to provide fast performance at the cost of some (typically small) inaccuracies.
However, the <code class="literal">size</code> and <code class="literal">shard size</code> settings covered in the next section provide tools to help control the accuracy levels.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parameters_6"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_jlh_score"></a>JLH score<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The scores are derived from the doc frequencies in <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> sets. The <span class="emphasis"><em>absolute</em></span> change in popularity (foregroundPercent - backgroundPercent) would favor common terms whereas the <span class="emphasis"><em>relative</em></span> change in popularity (foregroundPercent/ backgroundPercent) would favor rare terms. Rare vs common is essentially a precision vs recall balance and so the absolute and relative changes are multiplied to provide a sweet spot between precision and recall.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_mutual_information"></a>mutual information<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Mutual information as described in "Information Retrieval", Manning et al., Chapter 13.5.1 can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">         "mutual_information": {
              "include_negatives": true
         }</pre></div><p>Mutual information does not differentiate between terms that are descriptive for the subset or for documents outside the subset. The significant terms therefore can contain terms that appear more or less frequent in the subset than outside the subset. To filter out the terms that appear less often in the subset than in documents outside the subset, <code class="literal">include_negatives</code> can be set to <code class="literal">false</code>.</p><p>Per default, the assumption is that the documents in the bucket are also contained in the background. If instead you defined a custom background filter that represents a different set of documents that you want to compare to, set</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"background_is_superset": false</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_chi_square"></a>Chi square<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.4.0.Beta1.</p></div></div><p>Chi square as described in "Information Retrieval", Manning et al., Chapter 13.5.2 can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">         "chi_square": {
         }</pre></div><p>Chi square behaves like mutual information and can be configured with the same parameters <code class="literal">include_negatives</code> and <code class="literal">background_is_superset</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_google_normalized_distance"></a>google normalized distance<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 1.4.0.Beta1.</p></div></div><p>Google normalized distance  as described in "The Google Similarity Distance", Cilibrasi and Vitanyi, 2007 (<a class="ulink" href="http://arxiv.org/pdf/cs/0412098v3.pdf" target="_top">http://arxiv.org/pdf/cs/0412098v3.pdf</a>) can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">         "gnd": {
         }</pre></div><p><code class="literal">gnd</code> also accepts the <code class="literal">background_is_superset</code> parameter.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_which_one_is_best"></a>Which one is best?<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Roughly, <code class="literal">mutual_information</code> prefers high frequent terms even if they occur also frequently in the background. For example, in an analysis of natural language text this might lead to selection of stop words. <code class="literal">mutual_information</code> is unlikely to select very rare terms like misspellings. <code class="literal">gnd</code> prefers terms with a high co-occurence and avoids selection of stopwords. It might be better suited for synonym detection. However, <code class="literal">gnd</code> has a tendency to select very rare terms that are, for example, a result of misspelling. <code class="literal">chi_square</code> and <code class="literal">jlh</code> are somewhat in-between.</p><p>It is hard to say which one of the different heuristics will be the best choice as it depends on what the significant terms are used for (see for example [Yang and Pedersen, "A Comparative Study on Feature Selection in Text Categorization", 1997](<a class="ulink" href="http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf" target="_top">http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf</a>) for a study on using significant terms for feature selection for text classification).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_size_amp_shard_size"></a>Size &amp; Shard Size<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">size</code> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
If the number of unique terms is greater than <code class="literal">size</code>, the returned list can be slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</p><p>If set to <code class="literal">0</code>, the <code class="literal">size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p><p>To ensure better accuracy a multiple of the final <code class="literal">size</code> is used as the number of terms to request from each shard
using a heuristic based on the number of shards. To take manual control of this setting the <code class="literal">shard_size</code> parameter
can be  used to control the volumes of candidate terms produced by each shard.</p><p>Low-frequency terms can turn out to be the most interesting ones once all results are combined so the
significant_terms aggregation can produce higher-quality results when the <code class="literal">shard_size</code> parameter is set to
values significantly higher than the <code class="literal">size</code> setting. This ensures that a bigger volume of promising candidate terms are given
a consolidated review by the reducing node before the final selection. Obviously large candidate term lists
will cause extra network traffic and RAM usage so this is  quality/cost trade off that needs to be balanced.  If <code class="literal">shard_size</code> is set to -1 (the default) then <code class="literal">shard_size</code> will be automatically estimated based on the number of shards and the <code class="literal">size</code> parameter.</p><p>If set to <code class="literal">0</code>, the <code class="literal">shard_size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p><code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code> (as it doesn’t make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <code class="literal">size</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_minimum_document_count_2"></a>Minimum document count<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is possible to only return terms that match more than a configured number of hits using the <code class="literal">min_doc_count</code> option:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "min_doc_count": 10
            }
        }
    }
}</pre></div><p>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <code class="literal">3</code>.</p><p>Terms that score highly will be collected on a shard level and merged with the terms collected from other shards in a second step. However, the shard does not have the information about the global term frequencies available. The decision if a term is added to a candidate list depends only on the score computed on the shard using local shard frequencies, not the global frequencies of the word. The <code class="literal">min_doc_count</code> criterion is only applied after merging local terms statistics of all shards. In a way the decision to add the term as a candidate is made without being very <span class="emphasis"><em>certain</em></span> about if the term will actually reach the required <code class="literal">min_doc_count</code>. This might cause many (globally) high frequent terms to be missing in the final result if low frequent but high scoring terms populated the candidate lists. To avoid this, the <code class="literal">shard_size</code> parameter can be increased to allow more candidate terms on the shards. However, this increases memory consumption and network traffic.</p><p><code class="literal">shard_min_doc_count</code> parameter</p><p>The parameter <code class="literal">shard_min_doc_count</code> regulates the <span class="emphasis"><em>certainty</em></span> a shard has if the term should actually be added to the candidate list or not with respect to the <code class="literal">min_doc_count</code>. Terms will only be considered if their local shard frequency within the set is higher than the <code class="literal">shard_min_doc_count</code>. If your dictionary contains many low frequent words and you are not interested in these (for example misspellings), then you can set the <code class="literal">shard_min_doc_count</code> parameter to filter out candidate terms on a shard level that will with a reasonable certainty not reach the required <code class="literal">min_doc_count</code> even after merging the local frequencies. <code class="literal">shard_min_doc_count</code> is set to <code class="literal">1</code> per default and has no effect unless you explicitly set it.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Setting <code class="literal">min_doc_count</code> to <code class="literal">1</code> is generally not advised as it tends to return terms that
         are typos or other bizarre curiosities. Finding more than one instance of a term helps
         reinforce that, while still rare, the term was not the result of a one-off accident. The
         default value of 3 is used to provide a minimum weight-of-evidence.
         Setting <code class="literal">shard_min_doc_count</code> too high will cause significant candidate terms to be filtered out on a shard level. This value should be set much lower than <code class="literal">min_doc_count/#shards</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_custom_background_context"></a>Custom background context<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The default source of statistical information for background term frequencies is the entire index and this
scope can be narrowed through the use of a <code class="literal">background_filter</code> to focus in on significant terms within a narrower
context:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "query" : {
        "match" : "madrid"
    },
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "background_filter": {
                        "term" : { "text" : "spain"}
                }
            }
        }
    }
}</pre></div><p>The above filter would help focus in on terms that were peculiar to the city of Madrid rather than revealing
terms like "Spanish" that are unusual in the full index’s worldwide context but commonplace in the subset of documents containing the
word "Spain".</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Use of background filters will slow the query as each term’s postings must be filtered to determine a frequency</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_filtering_values_2"></a>Filtering Values<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is possible (although rarely required) to filter the values for which buckets will be created. This can be done using the <code class="literal">include</code> and
<code class="literal">exclude</code> parameters which are based on regular expressions. This functionality mirrors the features
offered by the <code class="literal">terms</code> aggregation.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tags",
                "include" : ".*sport.*",
                "exclude" : "water_.*"
            }
        }
    }
}</pre></div><p>In the above example, buckets will be created for all the tags that has the word <code class="literal">sport</code> in them, except those starting
with <code class="literal">water_</code> (so the tag <code class="literal">water_sports</code> will no be aggregated). The <code class="literal">include</code> regular expression will determine what
values are "allowed" to be aggregated, while the <code class="literal">exclude</code> determines the values that should not be aggregated. When
both are defined, the <code class="literal">exclude</code> has precedence, meaning, the <code class="literal">include</code> is evaluated first and only then the <code class="literal">exclude</code>.</p><p>The regular expression are based on the Java™ <a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_top">Pattern</a>,
and as such, they it is also possible to pass in flags that will determine how the compiled regular expression will work:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "include" : {
                     "pattern" : ".*sport.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE" <a id="CO31-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                 },
                 "exclude" : {
                     "pattern" : "water_.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE"
                 }
             }
         }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the flags are concatenated using the <code class="literal">|</code> character as a separator
</p></td></tr></table></div><p>The possible flags that can be used are:
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CANON_EQ" target="_top"><code class="literal">CANON_EQ</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CASE_INSENSITIVE" target="_top"><code class="literal">CASE_INSENSITIVE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#COMMENTS" target="_top"><code class="literal">COMMENTS</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#DOTALL" target="_top"><code class="literal">DOTALL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#LITERAL" target="_top"><code class="literal">LITERAL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#MULTILINE" target="_top"><code class="literal">MULTILINE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CASE" target="_top"><code class="literal">UNICODE_CASE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CHARACTER_CLASS" target="_top"><code class="literal">UNICODE_CHARACTER_CLASS</code></a> and
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNIX_LINES" target="_top"><code class="literal">UNIX_LINES</code></a></p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_execution_hint"></a>Execution hint<a href="https://github.com/elastic/elasticsearch/edit/1.4/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>There are different mechanisms by which terms aggregations can be executed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
by using field values directly in order to aggregate data per-bucket (<code class="literal">map</code>)
</li><li class="listitem">
by using ordinals of the field and preemptively allocating one bucket per ordinal value (<code class="literal">global_ordinals</code>)
</li><li class="listitem">
by using ordinals of the field and dynamically allocating one bucket per ordinal value (<code class="literal">global_ordinals_hash</code>)
</li></ul></div><p>Elasticsearch tries to have sensible defaults so this is something that generally doesn’t need to be configured.</p><p><code class="literal">map</code> should only be considered when very few documents match a query. Otherwise the ordinals-based execution modes
are significantly faster. By default, <code class="literal">map</code> is only used when running an aggregation on scripts, since they don’t have
ordinals.</p><p><code class="literal">global_ordinals</code> is the second fastest option, but the fact that it preemptively allocates buckets can be memory-intensive,
especially if you have one or more sub aggregations. It is used by default on top-level terms aggregations.</p><p><code class="literal">global_ordinals_hash</code> on the contrary to <code class="literal">global_ordinals</code> and <code class="literal">global_ordinals_low_cardinality</code> allocates buckets dynamically
so memory usage is linear to the number of values of the documents that are part of the aggregation scope. It is used by default
in inner aggregations.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "tags" : {
             "significant_terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <a id="CO32-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
             }
         }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
the possible values are <code class="literal">map</code>, <code class="literal">global_ordinals</code> and <code class="literal">global_ordinals_hash</code>
</p></td></tr></table></div><p>Please note that Elasticsearch will ignore this execution hint if it is not applicable.</p></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-terms-aggregation.html">
              « 
              Terms Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<h3>Top Videos</h3>
						<ul>
							<li><a href="https://www.elastic.co/webinars/elasticsearch-2-0-overview?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li>
							<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
							<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form">
          <form id="mktoForm_1398" class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack">X-Pack</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud">Elastic Cloud</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/security">Security (formerly Shield)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/alerting">Alerting (via Watcher)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/monitoring">Monitoring (formerly Marvel)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">ES-Hadoop</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              <ul>
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Press</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Language</h3>
              
              <ul>
              
                
                  <li><a href="/" data-value="/">English</a></li>
                
              
                
                  <li><a href="/fr/" data-value="/fr/">Français</a></li>
                
              
                
                  <li><a href="/de/" data-value="/de/">Deutsch</a></li>
                
              
                
                  <li><a href="/jp/" data-value="/jp/">日本語</a></li>
                
              
                
                  <li><a href="/kr/" data-value="/kr/">한국어</a></li>
                
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-12">
        <p class="text-center font-size-10 m-0">FOLLOW US</p>
        <ul>
          
          <li class="facebook"><a id="footer_facebook" href="http://www.facebook.com/elastic.co"></a></li>
          
          <li class="twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic"></a></li>
          
          <li class="linkedin"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co"></a></li>
          
          <li class="xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co"></a></li>
          
          <li class="youtube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch"></a></li>
          
        </ul>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-policy">Privacy</a></li>
				<li><a href="/legal/privacy-and-cookie-policy">Cookie Policy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer.svg" class="img-responsive"></a>
				</div>
				<div class="footer-text">
					<p>© 2016. All Rights Reserved - Elasticsearch
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
    
		.facebook{background:url("https://static-www.elastic.co/assets/bltf546ff2e0a8f2de5/facebook.svg?q=802") no-repeat;}
    
    
      .facebook:hover {background:url("https://static-www.elastic.co/assets/bltc24cf11c714ecfc4/facebook-hover.svg?q=802")}		
    
	
    
		.twitter{background:url("https://static-www.elastic.co/assets/bltdd9556d6b24e2b85/twitter.svg?q=802") no-repeat;}
    
    
      .twitter:hover {background:url("https://static-www.elastic.co/assets/blt90b0372cc07a54d3/twitter-hover.svg?q=802")}		
    
	
    
		.linkedin{background:url("https://static-www.elastic.co/assets/bltc4a77e0f52ce07f1/linkedin.svg?q=802") no-repeat;}
    
    
      .linkedin:hover {background:url("https://static-www.elastic.co/assets/blt01ce654380e4ea6c/linkedin-hover.svg?q=802")}		
    
	
    
		.xing{background:url("https://static-www.elastic.co/assets/bltc6347078dcc9ec76/xing.svg?q=802") no-repeat;}
    
    
      .xing:hover {background:url("https://static-www.elastic.co/assets/bltededebe5f7521a39/xing-hover.svg?q=802")}		
    
	
    
		.youtube{background:url("https://static-www.elastic.co/assets/blt4982061ce1aebc7f/youtube.svg?q=802") no-repeat;}
    
    
      .youtube:hover {background:url("https://static-www.elastic.co/assets/bltddeb6c6404ae81a5/youtube-hover.svg?q=802")}		
    
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
  MktoForms2.whenReady(function (form) {
  //    // Put your code that uses the form object here
  //   $('#Email').attr("placeholder","Email Address");
  //   $('#FirstName').attr("placeholder","First Name");
  //   $('#LastName').attr("placeholder","Last Name");
  //   $('#Form_Message').attr("placeholder","Tell us in your words");
  // // ========================End Mktoform placeholder==================
  });

  MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
    form.onSuccess(function(form){
      $('#mktoForm_1398').css('display','none');
      $('.subscribe-wrapper .subscribe-form-container').hide();
      $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
      dataLayer.push({'event': 'mktoFormSubmit'});
        return false;
      });
  });
</script>
      </section>
    </div>
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}';
</script>
<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js?q=802"></script>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/slick.min.js?q=802"></script>
<script src="https://static-www.elastic.co/static/js/nav-v5.js?q=802"></script>
<script src="https://static-www.elastic.co/static/js/script.js?q=802"></script> 
     
     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>