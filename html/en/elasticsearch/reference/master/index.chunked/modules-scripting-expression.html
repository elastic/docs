<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Lucene Expressions Language
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="modules-scripting.html" title="Scripting" /><link rel="prev" href="modules-scripting-painless-debugging.html" title="Painless Debugging" /><link rel="next" href="modules-scripting-native.html" title="Native (Java) Scripts" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/master" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="modules.html">Modules</a></span> » <span class="breadcrumb-link"><a href="modules-scripting.html">Scripting</a></span> » <span class="breadcrumb-node">Lucene Expressions Language</span></div><div xmlns="" class="navheader"><span class="prev"><a href="modules-scripting-painless-debugging.html">
              « 
              Painless Debugging</a>
           
        </span><span class="next">
           
          <a href="modules-scripting-native.html">Native (Java) Scripts
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-scripting-expression"></a>Lucene Expressions Language<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Lucene’s expressions compile a <code class="literal">javascript</code> expression to bytecode. They are
designed for high-performance custom ranking and sorting functions and are
enabled for <code class="literal">inline</code> and <code class="literal">stored</code> scripting by default.</p><h3><a id="_performance"></a>Performance<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Expressions were designed to have competitive performance with custom Lucene code.
This performance is due to having low per-document overhead as opposed to other
scripting engines: expressions do more "up-front".</p><p>This allows for very fast execution, even faster than if you had written a <code class="literal">native</code> script.</p><h3><a id="_syntax_14"></a>Syntax<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Expressions support a subset of javascript syntax: a single expression.</p><p>See the <a class="ulink" href="http://lucene.apache.org/core/6_0_0/expressions/index.html?org/apache/lucene/expressions/js/package-summary.html" target="_top">expressions module documentation</a>
for details on what operators and functions are available.</p><p>Variables in <code class="literal">expression</code> scripts are available to access:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
document fields, e.g. <code class="literal">doc['myfield'].value</code>
</li><li class="listitem">
variables and methods that the field supports, e.g. <code class="literal">doc['myfield'].empty</code>
</li><li class="listitem">
Parameters passed into the script, e.g. <code class="literal">mymodifier</code>
</li><li class="listitem">
The current document’s score, <code class="literal">_score</code> (only available when used in a <code class="literal">script_score</code>)
</li></ul></div><p>You can use Expressions scripts for <code class="literal">script_score</code>, <code class="literal">script_fields</code>, sort scripts, and numeric aggregation
scripts, simply set the <code class="literal">lang</code> parameter to <code class="literal">expression</code>.</p><h3><a id="_numeric_field_api"></a>Numeric field API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Expression </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].value</code></p></td><td align="left" valign="top"><p>The value of the field, as a <code class="literal">double</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].empty</code></p></td><td align="left" valign="top"><p>A boolean indicating if the field has no
values within the doc.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].length</code></p></td><td align="left" valign="top"><p>The number of values in this document.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].min()</code></p></td><td align="left" valign="top"><p>The minimum value of the field in this document.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].max()</code></p></td><td align="left" valign="top"><p>The maximum value of the field in this document.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].median()</code></p></td><td align="left" valign="top"><p>The median value of the field in this document.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].avg()</code></p></td><td align="left" valign="top"><p>The average of the values in this document.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].sum()</code></p></td><td align="left" valign="top"><p>The sum of the values in this document.</p></td></tr></tbody></table></div><p>When a document is missing the field completely, by default the value will be treated as <code class="literal">0</code>.
You can treat it as another value instead, e.g. <code class="literal">doc['myfield'].empty ? 100 : doc['myfield'].value</code></p><p>When a document has multiple values for the field, by default the minimum value is returned.
You can choose a different value instead, e.g. <code class="literal">doc['myfield'].sum()</code>.</p><p>When a document is missing the field completely, by default the value will be treated as <code class="literal">0</code>.</p><p>Boolean fields are exposed as numerics, with <code class="literal">true</code> mapped to <code class="literal">1</code> and <code class="literal">false</code> mapped to <code class="literal">0</code>.
For example: <code class="literal">doc['on_sale'].value ? doc['price'].value * 0.5 : doc['price'].value</code></p><h3><a id="_date_field_api"></a>Date field API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Date fields are treated as the number of milliseconds since January 1, 1970 and
support the Numeric Fields API above, plus access to some date-specific fields:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Expression </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.centuryOfEra</code></p></td><td align="left" valign="top"><p>Century (1-2920000)</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.dayOfMonth</code></p></td><td align="left" valign="top"><p>Day (1-31), e.g. <code class="literal">1</code> for the first of the month.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.dayOfWeek</code></p></td><td align="left" valign="top"><p>Day of the week (1-7), e.g. <code class="literal">1</code> for Monday.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.dayOfYear</code></p></td><td align="left" valign="top"><p>Day of the year, e.g. <code class="literal">1</code> for January 1.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.era</code></p></td><td align="left" valign="top"><p>Era: <code class="literal">0</code> for BC, <code class="literal">1</code> for AD.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.hourOfDay</code></p></td><td align="left" valign="top"><p>Hour (0-23).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.millisOfDay</code></p></td><td align="left" valign="top"><p>Milliseconds within the day (0-86399999).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.millisOfSecond</code></p></td><td align="left" valign="top"><p>Milliseconds within the second (0-999).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.minuteOfDay</code></p></td><td align="left" valign="top"><p>Minute within the day (0-1439).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.minuteOfHour</code></p></td><td align="left" valign="top"><p>Minute within the hour (0-59).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.monthOfYear</code></p></td><td align="left" valign="top"><p>Month within the year (1-12), e.g. <code class="literal">1</code> for January.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.secondOfDay</code></p></td><td align="left" valign="top"><p>Second within the day (0-86399).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.secondOfMinute</code></p></td><td align="left" valign="top"><p>Second within the minute (0-59).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.year</code></p></td><td align="left" valign="top"><p>Year (-292000000 - 292000000).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.yearOfCentury</code></p></td><td align="left" valign="top"><p>Year within the century (1-100).</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].date.yearOfEra</code></p></td><td align="left" valign="top"><p>Year within the era (1-292000000).</p></td></tr></tbody></table></div><p>The following example shows the difference in years between the <code class="literal">date</code> fields date0 and date1:</p><p><code class="literal">doc['date1'].date.year - doc['date0'].date.year</code></p><h3><a id="_literal_geo_point_literal_field_api"></a><code class="literal">geo_point</code> field API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Expression </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].empty</code></p></td><td align="left" valign="top"><p>A boolean indicating if the field has no
values within the doc.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lat</code></p></td><td align="left" valign="top"><p>The latitude of the geo point.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">doc['field_name'].lon</code></p></td><td align="left" valign="top"><p>The longitude of the geo point.</p></td></tr></tbody></table></div><p>The following example computes distance in kilometers from Washington, DC:</p><p><code class="literal">haversin(38.9072, 77.0369, doc['field_name'].lat, doc['field_name'].lon)</code></p><p>In this example the coordinates could have been passed as parameters to the script,
e.g. based on geolocation of the user.</p><h3><a id="_limitations_7"></a>Limitations<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/modules/scripting/expression.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>There are a few limitations relative to other script languages:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Only numeric, boolean, date, and geo_point fields may be accessed
</li><li class="listitem">
Stored fields are not available
</li></ul></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="modules-scripting-painless-debugging.html">
              « 
              Painless Debugging</a>
           
        </span><span class="next">
           
          <a href="modules-scripting-native.html">Native (Java) Scripts
               »
            </a></span></div></body></html>