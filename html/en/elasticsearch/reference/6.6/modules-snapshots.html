<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Snapshot And Restore
        | Elasticsearch Reference [6.6]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [6.6]" /><link rel="up" href="modules.html" title="Modules" /><link rel="prev" href="modules-scripting-engine.html" title="Advanced scripts using script engines" /><link rel="next" href="modules-threadpool.html" title="Thread Pool" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.6" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="6.6" />
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
<meta name="yandex-verification" content="d8a47e95d0972434" />
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	 

    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="text/javascript">
  // -------------------- set language based on browser language --------------------
  var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

  if($.cookie("is_lang_detected") == undefined){
    if(locales[lang] != undefined && locales[lang] != currentlocale){
      locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
      $.cookie("is_lang_detected",true ,{ path: '/'}); 
      window.location = locale_lang_url;
    } 
  }
        
  // --------------------- end of set language based on browser language -----------------
  </script>

  

	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
<script src="/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>


<script type="text/javascript">
  var active;
  
  active = Math.random() < 1 //0.9 
  
  elasticApm.init({
    active: active,
    serviceName: "elastic-co-frontend",
    serverUrl: "https://elastic-co-apm-server.app.elstc.co"
  })

  var pageLoadName
  var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
  var parts = pathname.split('/');

  if (parts.length && parts[1] === 'blog') {
    if (parts.length === 2) {
      pageLoadName =  '/blog';
    }
    else if (parts[2] === 'category') {
      pageLoadName =  '/blog/category';
    }
    else if (parts[2] === 'archive') {
      pageLoadName =  '/blog/archive';
    }
    else {
      pageLoadName =  '/blog/detail';
    }
  }
  else if (parts.length && parts[1] === 'elasticon') {
    if (parts.length === 2) {
      pageLoadName =  '/elasticon';
    }
    else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/overview';
    }
    else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/video';
    }
  }
  else if (parts.length && parts[1] === 'guide') {
    pageLoadName =  '/guide';
  }
  else if (parts.length === 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos';
  }
  else if (parts.length > 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos/detail';
  }
  else if (parts.length > 2 && parts[1] === 'webinars') {
    pageLoadName =  '/webinars/detail';
  }
  else {
    pageLoadName =  window.location.pathname;
  }

  console.log('apm pageLoadName:', pageLoadName, parts)
  elasticApm.setTags({env:"production"});
  elasticApm.setInitialPageLoadName(pageLoadName);
</script>

<!-- Elastic APM -->


    <!-- Header Section -->
    
<header class="header-wrapper">
  



  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <div id="logo">
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/blta09706b1c5cc1e99/elastic-logo-mobile.svg" alt="elastic-logo-mobile">
              </a>
            </div>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>

            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                  
                  <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="#" data-value="/" id="locale-select">English</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/es/" data-value="/es/" id="locale-select">Español</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                  
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <div id="logo">
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt244a845f141977c3/elastic-logo.svg" alt="elastic-logo">
          </a>
        </div>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>

          <li class="hidden-xs lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
              
                
                  
                
              
              <li><a class="" href="#" data-value="/">English</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/es/" data-value="/es/">Español</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [6.6]
    </a></span> » <span class="breadcrumb-link"><a href="modules.html">Modules</a></span> » <span class="breadcrumb-node">Snapshot And Restore</span></div><div class="navheader"><span class="prev"><a href="modules-scripting-engine.html">
              « 
              Advanced scripts using script engines</a>
           
        </span><span class="next">
           
          <a href="modules-threadpool.html">Thread Pool
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="modules-snapshots"></a>Snapshot And Restore<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A snapshot is a backup taken from a running Elasticsearch cluster. You can take
a snapshot of individual indices or of the entire cluster and store it in a
repository on a shared filesystem, and there are plugins that support remote
repositories on S3, HDFS, Azure, Google Cloud Storage and more.</p><p>Snapshots are taken incrementally. This means that when creating a snapshot of
an index Elasticsearch will avoid copying any data that is already stored in
the repository as part of an earlier snapshot of the same index. Therefore it
can be efficient to take snapshots of your cluster quite frequently.</p><p>Snapshots can be restored into a running cluster via the restore API. When
restoring an index it is possible to alter the name of the restored index as
well as some of its settings, allowing a great deal of flexibility in how the
snapshot and restore functionality can be used.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>It is not possible to back up an Elasticsearch cluster simply by
taking a copy of the data directories of all of its nodes. Elasticsearch may be
making changes to the contents of its data directories while it is running, and
this means that copying its data directories cannot be expected to capture a
consistent picture of their contents. Attempts to restore a cluster from such a
backup may fail, reporting corruption and/or missing files, or may appear to
have succeeded having silently lost some of its data. The only reliable way to
back up a cluster is by using the snapshot and restore functionality.</p></div></div><h3><a id="_version_compatibility"></a>Version compatibility<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A snapshot contains a copy of the on-disk data structures that make up an
index. This means that snapshots can only be restored to versions of
Elasticsearch that can read the indices:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
A snapshot of an index created in 5.x can be restored to 6.x.
</li><li class="listitem">
A snapshot of an index created in 2.x can be restored to 5.x.
</li><li class="listitem">
A snapshot of an index created in 1.x can be restored to 2.x.
</li></ul></div><p>Conversely, snapshots of indices created in 1.x <span class="strong strong"><strong>cannot</strong></span> be restored to 5.x
or 6.x, and snapshots of indices created in 2.x <span class="strong strong"><strong>cannot</strong></span> be restored to 6.x.</p><p>Each snapshot can contain indices created in various versions of Elasticsearch,
and when restoring a snapshot it must be possible to restore all of the indices
into the target cluster. If any indices in a snapshot were created in an
incompatible version, you will not be able restore the snapshot.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>When backing up your data prior to an upgrade, keep in mind that you
won’t be able to restore snapshots after you upgrade if they contain indices
created in a version that’s incompatible with the upgrade version.</p></div></div><p>If you end up in a situation where you need to restore a snapshot of an index
that is incompatible with the version of the cluster you are currently running,
you can restore it on the latest compatible version and use
<a class="link" href="docs-reindex.html#reindex-from-remote" title="Reindex from Remoteedit">reindex-from-remote</a> to rebuild the index on the current
version. Reindexing from remote is only possible if the original index has
source enabled. Retrieving and reindexing the data can take significantly
longer than simply restoring a snapshot. If you have a large amount of data, we
recommend testing the reindex from remote process with a subset of your data to
understand the time requirements before proceeding.</p><h3><a id="_repositories"></a>Repositories<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You must register a snapshot repository before you can perform snapshot and
restore operations. We recommend creating a new snapshot repository for each
major version. The valid repository settings depend on the repository type.</p><p>If you register same snapshot repository with multiple clusters, only
one cluster should have write access to the repository. All other clusters
connected to that repository should set the repository to <code class="literal">readonly</code> mode.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The snapshot format can change across major versions, so if you have
clusters on different versions trying to write the same repository, snapshots
written by one version may not be visible to the other and the repository could
be corrupted. While setting the repository to <code class="literal">readonly</code> on all but one of the
clusters should work with multiple clusters differing by one major version, it
is not a supported configuration.</p></div></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_backup
{
  "type": "fs",
  "settings": {
    "location": "my_backup_location"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/1.json"></div><p>To retrieve information about a registered repository, use a GET request:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_snapshot/my_backup</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/2.json"></div><p>which returns:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "my_backup": {
    "type": "fs",
    "settings": {
      "location": "my_backup_location"
    }
  }
}</pre></div><p>To retrieve information about multiple repositories, specify a comma-delimited
list of repositories. You can also use the * wildcard when
specifying repository names. For example, the following request retrieves
information about all of the snapshot repositories that start with <code class="literal">repo</code> or
contain <code class="literal">backup</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_snapshot/repo*,*backup*</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/3.json"></div><p>To retrieve information about all registered snapshot repositories, omit the
repository name or specify <code class="literal">_all</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_snapshot</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/4.json"></div><p>or</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /_snapshot/_all</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/5.json"></div><h5><a id="_shared_file_system_repository"></a>Shared File System Repository<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The shared file system repository (<code class="literal">"type": "fs"</code>) uses the shared file system to store snapshots. In order to register
the shared file system repository it is necessary to mount the same shared filesystem to the same location on all
master and data nodes. This location (or one of its parent directories) must be registered in the <code class="literal">path.repo</code>
setting on all master and data nodes.</p><p>Assuming that the shared filesystem is mounted to <code class="literal">/mount/backups/my_fs_backup_location</code>, the following setting should
be added to <code class="literal">elasticsearch.yml</code> file:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">path.repo: ["/mount/backups", "/mount/longterm_backups"]</pre></div><p>The <code class="literal">path.repo</code> setting supports Microsoft Windows UNC paths as long as at least server name and share are specified as
a prefix and back slashes are properly escaped:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">path.repo: ["\\\\MY_SERVER\\Snapshots"]</pre></div><p>After all nodes are restarted, the following command can be used to register the shared file system repository with
the name <code class="literal">my_fs_backup</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_fs_backup
{
    "type": "fs",
    "settings": {
        "location": "/mount/backups/my_fs_backup_location",
        "compress": true
    }
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/6.json"></div><p>If the repository location is specified as a relative path this path will be resolved against the first path specified
in <code class="literal">path.repo</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_fs_backup
{
    "type": "fs",
    "settings": {
        "location": "my_fs_backup_location",
        "compress": true
    }
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/7.json"></div><p>The following settings are supported:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">location</code>
</p>
</td><td valign="top">
<p>
Location of the snapshots. Mandatory.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">compress</code>
</p>
</td><td valign="top">
<p>
Turns on compression of the snapshot files. Compression is applied only to metadata files (index mapping and settings). Data files are not compressed. Defaults to <code class="literal">true</code>.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">chunk_size</code>
</p>
</td><td valign="top">
<p>
Big files can be broken down into chunks during snapshotting if needed. The chunk size can be specified in bytes or by
 using size value notation, i.e. 1g, 10m, 5k. Defaults to <code class="literal">null</code> (unlimited chunk size).
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_restore_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
Throttles per node restore rate. Defaults to <code class="literal">40mb</code> per second.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_snapshot_bytes_per_sec</code>
</p>
</td><td valign="top">
<p>
Throttles per node snapshot rate. Defaults to <code class="literal">40mb</code> per second.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">readonly</code>
</p>
</td><td valign="top">
<p>
Makes repository read-only.  Defaults to <code class="literal">false</code>.
</p>
</td></tr></tbody></table></div><h5><a id="_read_only_url_repository"></a>Read-only URL Repository<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The URL repository (<code class="literal">"type": "url"</code>) can be used as an alternative read-only way to access data created by the shared file
system repository. The URL specified in the <code class="literal">url</code> parameter should point to the root of the shared filesystem repository.
The following settings are supported:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">url</code>
</p>
</td><td valign="top">
<p>
Location of the snapshots. Mandatory.
</p>
</td></tr></tbody></table></div><p>URL Repository supports the following protocols: "http", "https", "ftp", "file" and "jar". URL repositories with <code class="literal">http:</code>,
<code class="literal">https:</code>, and <code class="literal">ftp:</code> URLs has to be whitelisted by specifying allowed URLs in the <code class="literal">repositories.url.allowed_urls</code> setting.
This setting supports wildcards in the place of host, path, query, and fragment. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">repositories.url.allowed_urls: ["http://www.example.org/root/*", "https://*.mydomain.com/*?*#*"]</pre></div><p>URL repositories with <code class="literal">file:</code> URLs can only point to locations registered in the <code class="literal">path.repo</code> setting similar to
shared file system repository.</p><h5><a id="_source_only_repository"></a>Source Only Repository<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A source repository enables you to create minimal, source-only snapshots that take up to 50% less space on disk.
Source only snapshots contain stored fields and index metadata. They do not include index or doc values structures
and are not searchable when restored. After restoring a source-only snapshot, you must <a class="link" href="docs-reindex.html" title="Reindex API">reindex</a>
the data into a new index.</p><p>Source repositories delegate to another snapshot repository for storage.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Source only snapshots are only supported if the <code class="literal">_source</code> field is enabled and no source-filtering is applied.
When you restore a source only snapshot:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The restored index is read-only and can only serve <code class="literal">match_all</code> search or scroll requests to enable reindexing.
</li><li class="listitem">
Queries other than <code class="literal">match_all</code> and <code class="literal">_get</code> requests are not supported.
</li><li class="listitem">
The mapping of the restored index is empty, but the original mapping is available from the types top
   level <code class="literal">meta</code> element.
</li></ul></div></div></div><p>When you create a source repository, you must specify the type and name of the delegate repository
where the snapshots will be stored:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT _snapshot/my_src_only_repository
{
  "type": "source",
  "settings": {
    "delegate_type": "fs",
    "location": "my_backup_location"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/8.json"></div><h5><a id="_repository_plugins"></a>Repository plugins<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Other repository backends are available in these official plugins:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/plugins/6.6/repository-s3.html" target="_top">repository-s3</a> for S3 repository support
</li><li class="listitem">
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/plugins/6.6/repository-hdfs.html" target="_top">repository-hdfs</a> for HDFS repository support in Hadoop environments
</li><li class="listitem">
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/plugins/6.6/repository-azure.html" target="_top">repository-azure</a> for Azure storage repositories
</li><li class="listitem">
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/plugins/6.6/repository-gcs.html" target="_top">repository-gcs</a> for Google Cloud Storage repositories
</li></ul></div><h5><a id="_repository_verification"></a>Repository Verification<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>When a repository is registered, it’s immediately verified on all master and data nodes to make sure that it is functional
on all nodes currently present in the cluster. The <code class="literal">verify</code> parameter can be used to explicitly disable the repository
verification when registering or updating a repository:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_unverified_backup?verify=false
{
  "type": "fs",
  "settings": {
    "location": "my_unverified_backup_location"
  }
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/9.json"></div><p>The verification process can also be executed manually by running the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST /_snapshot/my_unverified_backup/_verify</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/10.json"></div><p>It returns a list of nodes where repository was successfully verified or an error message if verification process failed.</p><h3><a id="_snapshot"></a>Snapshot<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A repository can contain multiple snapshots of the same cluster. Snapshots are identified by unique names within the
cluster. A snapshot with the name <code class="literal">snapshot_1</code> in the repository <code class="literal">my_backup</code> can be created by executing the following
command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/11.json"></div><p>The <code class="literal">wait_for_completion</code> parameter specifies whether or not the request should return immediately after snapshot
initialization (default) or wait for snapshot completion. During snapshot initialization, information about all
previous snapshots is loaded into the memory, which means that in large repositories it may take several seconds (or
even minutes) for this command to return even if the <code class="literal">wait_for_completion</code> parameter is set to <code class="literal">false</code>.</p><p>By default a snapshot of all open and started indices in the cluster is created. This behavior can be changed by
specifying the list of indices in the body of the snapshot request.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": false
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/12.json"></div><p>The list of indices that should be included into the snapshot can be specified using the <code class="literal">indices</code> parameter that
supports <a class="link" href="multi-index.html" title="Multiple Indices">multi index syntax</a>. The snapshot request also supports the
<code class="literal">ignore_unavailable</code> option. Setting it to <code class="literal">true</code> will cause indices that do not exist to be ignored during snapshot
creation. By default, when <code class="literal">ignore_unavailable</code> option is not set and an index is missing the snapshot request will fail.
By setting <code class="literal">include_global_state</code> to false it’s possible to prevent the cluster global state to be stored as part of
the snapshot. By default, the entire snapshot will fail if one or more indices participating in the snapshot don’t have
all primary shards available. This behaviour can be changed by setting <code class="literal">partial</code> to <code class="literal">true</code>.</p><p>Snapshot names can be automatically derived using <a class="link" href="date-math-index-names.html" title="Date math support in index names">date math expressions</a>, similarly as when creating
new indices. Note that special characters need to be URI encoded.</p><p>For example, creating a snapshot with the current day in the name, like <code class="literal">snapshot-2018.05.11</code>, can be achieved with
the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js"># PUT /_snapshot/my_backup/&lt;snapshot-{now/d}&gt;
PUT /_snapshot/my_backup/%3Csnapshot-%7Bnow%2Fd%7D%3E</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/13.json"></div><p>The index snapshot process is incremental. In the process of making the index snapshot Elasticsearch analyses
the list of the index files that are already stored in the repository and copies only files that were created or
changed since the last snapshot. That allows multiple snapshots to be preserved in the repository in a compact form.
Snapshotting process is executed in non-blocking fashion. All indexing and searching operation can continue to be
executed against the index that is being snapshotted. However, a snapshot represents the point-in-time view of the index
at the moment when snapshot was created, so no records that were added to the index after the snapshot process was started
will be present in the snapshot. The snapshot process starts immediately for the primary shards that has been started
and are not relocating at the moment. Before version 1.2.0, the snapshot operation fails if the cluster has any relocating or
initializing primaries of indices participating in the snapshot. Starting with version 1.2.0, Elasticsearch waits for
relocation or initialization of shards to complete before snapshotting them.</p><p>Besides creating a copy of each index the snapshot process can also store global cluster metadata, which includes persistent
cluster settings and templates. The transient settings and registered snapshot repositories are not stored as part of
the snapshot.</p><p>Only one snapshot process can be executed in the cluster at any time. While snapshot of a particular shard is being
created this shard cannot be moved to another node, which can interfere with rebalancing process and allocation
filtering. Elasticsearch will only be able to move a shard to another node (according to the current allocation
filtering settings and rebalancing algorithm) once the snapshot is finished.</p><p>Once a snapshot is created information about this snapshot can be obtained using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_1</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/14.json"></div><p>This command returns basic information about the snapshot including start and end time, version of
Elasticsearch that created the snapshot, the list of included indices, the current state of the
snapshot and the list of failures that occurred during the snapshot. The snapshot <code class="literal">state</code> can be</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">IN_PROGRESS</code>
</p>
</td><td valign="top">
<p>
  The snapshot is currently running.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">SUCCESS</code>
</p>
</td><td valign="top">
<p>
  The snapshot finished and all shards were stored successfully.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">FAILED</code>
</p>
</td><td valign="top">
<p>
  The snapshot finished with an error and failed to store any data.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">PARTIAL</code>
</p>
</td><td valign="top">
<p>
  The global cluster state was stored, but data of at least one shard wasn’t stored successfully.
  The <code class="literal">failure</code> section in this case should contain more detailed information about shards
  that were not processed correctly.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">INCOMPATIBLE</code>
</p>
</td><td valign="top">
<p>
  The snapshot was created with an old version of Elasticsearch and therefore is incompatible with
  the current version of the cluster.
</p>
</td></tr></tbody></table></div><p>Similar as for repositories, information about multiple snapshots can be queried in one go, supporting wildcards as well:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_*,some_other_snapshot</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/15.json"></div><p>All snapshots currently stored in the repository can be listed using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/_all</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/16.json"></div><p>The command fails if some of the snapshots are unavailable. The boolean parameter <code class="literal">ignore_unavailable</code> can be used to
return all snapshots that are currently available.</p><p>Getting all snapshots in the repository can be costly on cloud-based repositories,
both from a cost and performance perspective.  If the only information required is
the snapshot names/uuids in the repository and the indices in each snapshot, then
the optional boolean parameter <code class="literal">verbose</code> can be set to <code class="literal">false</code> to execute a more
performant and cost-effective retrieval of the snapshots in the repository.  Note
that setting <code class="literal">verbose</code> to <code class="literal">false</code> will omit all other information about the snapshot
such as status information, the number of snapshotted shards, etc.  The default
value of the <code class="literal">verbose</code> parameter is <code class="literal">true</code>.</p><p>A currently running snapshot can be retrieved using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/_current</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/17.json"></div><p>A snapshot can be deleted from the repository using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">DELETE /_snapshot/my_backup/snapshot_2</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/18.json"></div><p>When a snapshot is deleted from a repository, Elasticsearch deletes all files that are associated with the deleted
snapshot and not used by any other snapshots. If the deleted snapshot operation is executed while the snapshot is being
created the snapshotting process will be aborted and all files created as part of the snapshotting process will be
cleaned. Therefore, the delete snapshot operation can be used to cancel long running snapshot operations that were
started by mistake.</p><p>A repository can be unregistered using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">DELETE /_snapshot/my_backup</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/19.json"></div><p>When a repository is unregistered, Elasticsearch only removes the reference to the location where the repository is storing
the snapshots. The snapshots themselves are left untouched and in place.</p><h3><a id="_restore"></a>Restore<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A snapshot can be restored using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">POST /_snapshot/my_backup/snapshot_1/_restore</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/20.json"></div><p>By default, all indices in the snapshot are restored, and the cluster state is
<span class="strong strong"><strong>not</strong></span> restored. It’s possible to select indices that should be restored as well
as to allow the global cluster state from being restored by using <code class="literal">indices</code> and
<code class="literal">include_global_state</code> options in the restore request body. The list of indices
supports <a class="link" href="multi-index.html" title="Multiple Indices">multi index syntax</a>. The <code class="literal">rename_pattern</code>
and <code class="literal">rename_replacement</code> options can be also used to rename indices on restore
using regular expression that supports referencing the original text as
explained
<a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)" target="_top">here</a>.
Set <code class="literal">include_aliases</code> to <code class="literal">false</code> to prevent aliases from being restored together
with associated indices</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST /_snapshot/my_backup/snapshot_1/_restore
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": true,
  "rename_pattern": "index_(.+)",
  "rename_replacement": "restored_index_$1"
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/21.json"></div><p>The restore operation can be performed on a functioning cluster. However, an
existing index can be only restored if it’s <a class="link" href="indices-open-close.html" title="Open / Close Index API">closed</a> and
has the same number of shards as the index in the snapshot. The restore
operation automatically opens restored indices if they were closed and creates
new indices if they didn’t exist in the cluster. If cluster state is restored
with <code class="literal">include_global_state</code> (defaults to <code class="literal">false</code>), the restored templates that
don’t currently exist in the cluster are added and existing templates with the
same name are replaced by the restored templates. The restored persistent
settings are added to the existing persistent settings.</p><h4><a id="_partial_restore"></a>Partial restore<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>By default, the entire restore operation will fail if one or more indices participating in the operation don’t have
snapshots of all shards available. It can occur if some shards failed to snapshot for example. It is still possible to
restore such indices by setting <code class="literal">partial</code> to <code class="literal">true</code>. Please note, that only successfully snapshotted shards will be
restored in this case and all missing shards will be recreated empty.</p><h4><a id="_changing_index_settings_during_restore"></a>Changing index settings during restore<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Most of index settings can be overridden during the restore process. For example, the following command will restore
the index <code class="literal">index_1</code> without creating any replicas while switching back to default refresh interval:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">POST /_snapshot/my_backup/snapshot_1/_restore
{
  "indices": "index_1",
  "index_settings": {
    "index.number_of_replicas": 0
  },
  "ignore_index_settings": [
    "index.refresh_interval"
  ]
}</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/22.json"></div><p>Please note, that some settings such as <code class="literal">index.number_of_shards</code> cannot be changed during restore operation.</p><h4><a id="_restoring_to_a_different_cluster"></a>Restoring to a different cluster<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The information stored in a snapshot is not tied to a particular cluster or a cluster name. Therefore it’s possible to
restore a snapshot made from one cluster into another cluster. All that is required is registering the repository
containing the snapshot in the new cluster and starting the restore process. The new cluster doesn’t have to have the
same size or topology.  However, the version of the new cluster should be the same or newer (only 1 major version newer) than the cluster that was used to create the snapshot.  For example, you can restore a 1.x snapshot to a 2.x cluster, but not a 1.x snapshot to a 5.x cluster.</p><p>If the new cluster has a smaller size additional considerations should be made. First of all it’s necessary to make sure
that new cluster have enough capacity to store all indices in the snapshot. It’s possible to change indices settings
during restore to reduce the number of replicas, which can help with restoring snapshots into smaller cluster. It’s also
possible to select only subset of the indices using the <code class="literal">indices</code> parameter.</p><p>If indices in the original cluster were assigned to particular nodes using
<a class="link" href="shard-allocation-filtering.html" title="Shard Allocation Filtering">shard allocation filtering</a>, the same rules will be enforced in the new cluster. Therefore
if the new cluster doesn’t contain nodes with appropriate attributes that a restored index can be allocated on, such
index will not be successfully restored unless these index allocation settings are changed during restore operation.</p><p>The restore operation also checks that restored persistent settings are compatible with the current cluster to avoid accidentally
restoring an incompatible settings such as <code class="literal">discovery.zen.minimum_master_nodes</code> and as a result disable a smaller cluster until the
required number of master eligible nodes is added. If you need to restore a snapshot with incompatible persistent settings, try
restoring it without the global cluster state.</p><h3><a id="_snapshot_status"></a>Snapshot status<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A list of currently running snapshots with their detailed status information can be obtained using the following command:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/_status</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/23.json"></div><p>In this format, the command will return information about all currently running snapshots. By specifying a repository name, it’s possible
to limit the results to a particular repository:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/_status</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/24.json"></div><p>If both repository name and snapshot id are specified, this command will return detailed status information for the given snapshot even
if it’s not currently running:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_1/_status</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/25.json"></div><p>The output looks similar to the following:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "snapshots": [
    {
      "snapshot": "snapshot_1",
      "repository": "my_backup",
      "uuid": "XuBo4l4ISYiVg0nYUen9zg",
      "state": "SUCCESS",
      "include_global_state": true,
      "shards_stats": {
        "initializing": 0,
        "started": 0,
        "finalizing": 0,
        "done": 5,
        "failed": 0,
        "total": 5
      },
      "stats": {
        "incremental": {
          "file_count": 8,
          "size_in_bytes": 4704
        },
        "processed": {
          "file_count": 7,
          "size_in_bytes": 4254
        },
        "total": {
          "file_count": 8,
          "size_in_bytes": 4704
        },
        "start_time_in_millis": 1526280280355,
        "time_in_millis": 358,

        "number_of_files": 8,
        "processed_files": 8,
        "total_size_in_bytes": 4704,
        "processed_size_in_bytes": 4704
      }
    }
  ]
}</pre></div><p>The output is composed of different sections. The <code class="literal">stats</code> sub-object provides details on the number and size of files that were
snapshotted. As snapshots are incremental, copying only the Lucene segments that are not already in the repository,
the <code class="literal">stats</code> object contains a <code class="literal">total</code> section for all the files that are referenced by the snapshot, as well as an <code class="literal">incremental</code> section
for those files that actually needed to be copied over as part of the incremental snapshotting. In case of a snapshot that’s still
in progress, there’s also a <code class="literal">processed</code> section that contains information about the files that are in the process of being copied.</p><p><span class="emphasis"><em>Note</em></span>: Properties <code class="literal">number_of_files</code>, <code class="literal">processed_files</code>, <code class="literal">total_size_in_bytes</code> and <code class="literal">processed_size_in_bytes</code> are used for
backward compatibility reasons with older 5.x and 6.x versions. These fields will be removed in Elasticsearch v7.0.0.</p><p>Multiple ids are also supported:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_1,snapshot_2/_status</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/26.json"></div><h3><a id="_monitoring_snapshot_restore_progress"></a>Monitoring snapshot/restore progress<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>There are several ways to monitor the progress of the snapshot and restores processes while they are running. Both
operations support <code class="literal">wait_for_completion</code> parameter that would block client until the operation is completed. This is
the simplest method that can be used to get notified about operation completion.</p><p>The snapshot operation can be also monitored by periodic calls to the snapshot info:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_1</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/27.json"></div><p>Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,
executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait
for available resources before returning the result. On very large shards the wait time can be significant.</p><p>To get more immediate and complete information about snapshots the snapshot status command can be used instead:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">GET /_snapshot/my_backup/snapshot_1/_status</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/28.json"></div><p>While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns
complete breakdown of the current state for each shard participating in the snapshot.</p><p>The restore process piggybacks on the standard recovery mechanism of the Elasticsearch. As a result, standard recovery
monitoring services can be used to monitor the state of restore. When restore operation is executed the cluster
typically goes into <code class="literal">red</code> state. It happens because the restore operation starts with "recovering" primary shards of the
restored indices. During this operation the primary shards become unavailable which manifests itself in the <code class="literal">red</code> cluster
state. Once recovery of primary shards is completed Elasticsearch is switching to standard replication process that
creates the required number of replicas at this moment cluster switches to the <code class="literal">yellow</code> state. Once all required replicas
are created, the cluster switches to the <code class="literal">green</code> states.</p><p>The cluster health operation provides only a high level status of the restore process. It’s possible to get more
detailed insight into the current state of the recovery process by using <a class="link" href="indices-recovery.html" title="Indices Recovery">indices recovery</a> and
<a class="link" href="cat-recovery.html" title="cat recovery">cat recovery</a> APIs.</p><h3><a id="_stopping_currently_running_snapshot_and_restore_operations"></a>Stopping currently running snapshot and restore operations<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The snapshot and restore framework allows running only one snapshot or one restore operation at a time. If a currently
running snapshot was executed by mistake, or takes unusually long, it can be terminated using the snapshot delete operation.
The snapshot delete operation checks if the deleted snapshot is currently running and if it does, the delete operation stops
that snapshot before deleting the snapshot data from the repository.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">DELETE /_snapshot/my_backup/snapshot_1</pre></div><div class="console_widget" data-snippet="snippets/modules-snapshots/29.json"></div><p>The restore operation uses the standard shard recovery mechanism. Therefore, any currently running restore operation can
be canceled by deleting indices that are being restored. Please note that data for all deleted indices will be removed
from the cluster as a result of this operation.</p><h3><a id="_effect_of_cluster_blocks_on_snapshot_and_restore_operations"></a>Effect of cluster blocks on snapshot and restore operations<a href="https://github.com/elastic/elasticsearch/edit/6.6/docs/reference/modules/snapshots.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Many snapshot and restore operations are affected by cluster and index blocks. For example, registering and unregistering
repositories require write global metadata access. The snapshot operation requires that all indices and their metadata as
well as the global metadata were readable. The restore operation requires the global metadata to be writable, however
the index level blocks are ignored during restore because indices are essentially recreated during restore.
Please note that a repository content is not part of the cluster and therefore cluster blocks don’t affect internal
repository operations such as listing or deleting snapshots from an already registered repository.</p></div><div class="navfooter"><span class="prev"><a href="modules-scripting-engine.html">
              « 
              Advanced scripts using script engines</a>
           
        </span><span class="next">
           
          <a href="modules-threadpool.html">Thread Pool
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack">Stack Features (formerly X-Pack)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/security">Security</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/alerting">Alerting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/canvas">Canvas</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/monitoring">Monitoring</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/elasticsearch-sql">Elasticsearch SQL</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">Elasticsearch-Hadoop</a></li>
                  
                
              
                
                  
                    <li><a href="/products/ece">Elastic Cloud Enterprise</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
              
                <h3><a href="/cloud">Elastic Cloud ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/cloud/elasticsearch-service">Elasticsearch Service</a></li>
                  
                
              
                
                  
                    <li><a href="/aws-elasticsearch-service">AWS Elasticsearch Service Comparison</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/app-search-service">Elastic App Search Service</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/site-search-service">Elastic Site Search Service</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
              
                <h3></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/about/our-source-code">Our Source Code</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams">Teams</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/board">Board of Directors</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/history-of-elasticsearch">Our Story</a></li>
                  
                
              
                
                  
                    <li><a href="/about/why-open-source">Why Open Source</a></li>
                  
                
              
                
                  
                    <li><a href="/about/distributed">Distributed by Intention</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Media</a></li>
                  
                
              
                
                  
                    <li><a href="https://ir.elastic.co">Investor Relations</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="Facebook"><a id="footer_facebook" href="https://www.facebook.com/elastic.co">Facebook</a></li>
          
          		 	<li class="Twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic">Twitter</a></li>
          
          		 	<li class="LinkedIn"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co">LinkedIn</a></li>
          
          		 	<li class="Xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co">Xing</a></li>
          
          		 	<li class="YouTube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch">YouTube</a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-statement">Privacy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-text">
					<p>© 2019. Elasticsearch B.V. All Rights Reserved
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>