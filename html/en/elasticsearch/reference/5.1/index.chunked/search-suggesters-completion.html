<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Completion Suggester
        | Elasticsearch Reference [5.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.1]" /><link rel="up" href="search-suggesters.html" title="Suggesters" /><link rel="prev" href="search-suggesters-phrase.html" title="Phrase Suggester" /><link rel="next" href="suggester-context.html" title="Context Suggester" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.1]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> » <span class="breadcrumb-node">Completion Suggester</span></div><div xmlns="" class="navheader"><span class="prev"><a href="search-suggesters-phrase.html">
              « 
              Phrase Suggester</a>
           
        </span><span class="next">
           
          <a href="suggester-context.html">Context Suggester
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-completion"></a>Completion Suggester<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">completion</code> suggester provides auto-complete/search-as-you-type
functionality. This is a navigational feature to guide users to
relevant results as they are typing, improving search precision.
It is not meant for spell correction or did-you-mean functionality
like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters.</p><p>Ideally, auto-complete functionality should be as fast as a user
types to provide instant feedback relevant to what a user has already
typed in. Hence, <code class="literal">completion</code> suggester is optimized for speed.
The suggester uses data structures that enable fast lookups,
but are costly to build and are stored in-memory.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="completion-suggester-mapping"></a>Mapping<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To use this feature, specify a special mapping for this field,
which indexes the field values for fast completions.</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT music
{
    "mappings": {
        "song" : {
            "properties" : {
                "suggest" : {
                    "type" : "completion"
                },
                "title" : {
                    "type": "keyword"
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>Mapping supports the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">analyzer</code>
</span></dt><dd>
    The index analyzer to use, defaults to <code class="literal">simple</code>.
    In case you are wondering why we did not opt for the <code class="literal">standard</code>
    analyzer: We try to have easy to understand behaviour here, and if you
    index the field content <code class="literal">At the Drive-in</code>, you will not get any
    suggestions for <code class="literal">a</code>, nor for <code class="literal">d</code> (the first non stopword).
</dd><dt><span class="term">
<code class="literal">search_analyzer</code>
</span></dt><dd>
    The search analyzer to use, defaults to value of <code class="literal">analyzer</code>.
</dd><dt><span class="term">
<code class="literal">preserve_separators</code>
</span></dt><dd>
    Preserves the separators, defaults to <code class="literal">true</code>.
    If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
    suggest for <code class="literal">foof</code>.
</dd><dt><span class="term">
<code class="literal">preserve_position_increments</code>
</span></dt><dd>
    Enables position increments, defaults to <code class="literal">true</code>.
    If disabled and using stopwords analyzer, you could get a
    field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong"><strong>Note</strong></span>: You
    could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
    <code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
    enrich your data.
</dd><dt><span class="term">
<code class="literal">max_input_length</code>
</span></dt><dd>
    Limits the length of a single input, defaults to <code class="literal">50</code> UTF-16 code points.
    This limit is only used at index time to reduce the total number of
    characters per input string in order to prevent massive inputs from
    bloating the underlying datastructure. Most usecases won’t be influenced
    by the default value since prefix completions seldom grow beyond prefixes longer
    than a handful of characters.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="indexing"></a>Indexing<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You index suggestions like any other field. A suggestion is made of an
<code class="literal">input</code> and an optional <code class="literal">weight</code> attribute. An <code class="literal">input</code> is the expected
text to be matched by a suggestion query and the <code class="literal">weight</code> determines how
the suggestions will be scored. Indexing a suggestion is as follows:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT music/song/1?refresh
{
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "weight" : 34
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>The following parameters are supported:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">input</code>
</span></dt><dd>
    The input to store, this can be an array of strings or just
    a string. This field is mandatory.
</dd><dt><span class="term">
<code class="literal">weight</code>
</span></dt><dd>
    A positive integer or a string containing a positive integer,
    which defines a weight and allows you to rank your suggestions.
    This field is optional.
</dd></dl></div><p>You can index multiple suggestions for a document as follows:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT music/song/1?refresh
{
    "suggest" : [
        {
            "input": "Nevermind",
            "weight" : 10
        },
        {
            "input": "Nirvana",
            "weight" : 3
        }
    ]
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>You can use the following shorthand form. Note that you can not specify
a weight with suggestion(s).</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT music/song/1?refresh
{
  "suggest" : [ "Nevermind", "Nirvana" ]
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="querying"></a>Querying<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>. Suggestions are near real-time, which means
new suggestions can be made visible by <a class="link" href="indices-refresh.html" title="Refresh">refresh</a> and
documents once deleted are never shown. This request:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">POST music/_suggest?pretty
{
    "song-suggest" : {
        "prefix" : "nir",
        "completion" : {
            "field" : "suggest"
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>returns this response:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "nir",
    "offset" : 0,
    "length" : 3,
    "options" : [ {
      "text" : "Nirvana",
      "_index": "music",
      "_type": "song",
      "_id": "1",
      "_score": 1.0,
      "_source": {
        "suggest": ["Nevermind", "Nirvana"]
      }
    } ]
  } ]
}</pre></div><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml"><code class="literal">_source</code> meta-field must be enabled, which is the default
behavior, to enable returning <code class="literal">_source</code> with suggestions.</p></div></div><p>The configured weight for a suggestion is returned as <code class="literal">_score</code>. The
<code class="literal">text</code> field uses the <code class="literal">input</code> of your indexed suggestion. Suggestions
return the full document <code class="literal">_source</code> by default. The size of the <code class="literal">_source</code>
can impact performance due to disk fetch and network transport overhead.
To save some network overhead, filter out unnecessary fields from the <code class="literal">_source</code>
using <a class="link" href="search-request-source-filtering.html" title="Source filtering">source filtering</a> to minimize
<code class="literal">_source</code> size. Note that the _suggest endpoint doesn’t support source
filtering but using suggest on the <code class="literal">_search</code> endpoint does:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">POST music/_search?size=0
{
    "_source": "suggest",
    "suggest": {
        "song-suggest" : {
            "prefix" : "nir",
            "completion" : {
                "field" : "suggest"
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>Which should look like:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "took": 6,
    "timed_out": false,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits": {
        "total" : 0,
        "max_score" : 0.0,
        "hits" : []
    },
    "suggest": {
        "song-suggest" : [ {
            "text" : "nir",
            "offset" : 0,
            "length" : 3,
            "options" : [ {
                "text" : "Nirvana",
                "_index": "music",
                "_type": "song",
                "_id": "1",
                "_score": 1.0,
                "_source": {
                    "suggest": ["Nevermind", "Nirvana"]
                }
            } ]
        } ]
    }
}</pre></div><p>The basic completion suggester query supports the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">field</code>
</span></dt><dd>
The name of the field on which to run the query (required).
</dd><dt><span class="term">
<code class="literal">size</code>
</span></dt><dd>
The number of suggestions to return (defaults to <code class="literal">5</code>).
</dd></dl></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The completion suggester considers all documents in the index.
See <a class="xref" href="suggester-context.html" title="Context Suggester">Context Suggester</a> for an explanation of how to query a subset of
documents instead.</p></div></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">In case of completion queries spanning more than one shard, the suggest
is executed in two phases, where the last phase fetches the relevant documents
from shards, implying executing completion requests against a single shard is
more performant due to the document fetch overhead when the suggest spans
multiple shards. To get best performance for completions, it is recommended to
index completions into a single shard index. In case of high heap usage due to
shard size, it is still recommended to break index into multiple shards instead
of optimizing for completion performance.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="fuzzy"></a>Fuzzy queries<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The completion suggester also supports fuzzy queries - this means,
you can have a typo in your search and still get results back.</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">POST music/_suggest?pretty
{
    "song-suggest" : {
        "prefix" : "nor",
        "completion" : {
            "field" : "suggest",
            "fuzzy" : {
                "fuzziness" : 2
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>Suggestions that share the longest prefix to the query <code class="literal">prefix</code> will
be scored higher.</p><p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td><td valign="top">
<p>
    The fuzziness factor, defaults to <code class="literal">AUTO</code>.
    See  <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”</a> for allowed settings.
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">transpositions</code>
</p>
</td><td valign="top">
<p>
    if set to <code class="literal">true</code>, transpositions are counted
    as one change instead of two, defaults to <code class="literal">true</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min_length</code>
</p>
</td><td valign="top">
<p>
    Minimum length of the input before fuzzy
    suggestions are returned, defaults <code class="literal">3</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td valign="top">
<p>
    Minimum length of the input, which is not
    checked for fuzzy alternatives, defaults to <code class="literal">1</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">unicode_aware</code>
</p>
</td><td valign="top">
<p>
    If <code class="literal">true</code>, all measurements (like fuzzy edit
    distance, transpositions, and lengths) are
    measured in Unicode code points instead of
    in bytes.  This is slightly slower than raw
    bytes, so it is set to <code class="literal">false</code> by default.
</p>
</td></tr></tbody></table></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">If you want to stick with the default values, but
      still use fuzzy, you can either use <code class="literal">fuzzy: {}</code>
      or <code class="literal">fuzzy: true</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="regex"></a>Regex queries<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The completion suggester also supports regex queries meaning
you can express a prefix as a regular expression</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">POST music/_suggest?pretty
{
    "song-suggest" : {
        "regex" : "n[ever|i]r",
        "completion" : {
            "field" : "suggest"
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>The regex query can take specific regex parameters.
The following parameters are supported:</p><div class="horizontal"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p>
<code class="literal">flags</code>
</p>
</td><td valign="top">
<p>
    Possible flags are <code class="literal">ALL</code> (default), <code class="literal">ANYSTRING</code>, <code class="literal">COMPLEMENT</code>,
    <code class="literal">EMPTY</code>, <code class="literal">INTERSECTION</code>, <code class="literal">INTERVAL</code>, or <code class="literal">NONE</code>. See <a class="link" href="query-dsl-regexp-query.html" title="Regexp Query">regexp-syntax</a>
    for their meaning
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max_determinized_states</code>
</p>
</td><td valign="top">
<p>
    Regular expressions are dangerous because it’s easy to accidentally
    create an innocuous looking one that requires an exponential number of
    internal determinized automaton states (and corresponding RAM and CPU)
    for Lucene to execute.  Lucene prevents these using the
    <code class="literal">max_determinized_states</code> setting (defaults to 10000).  You can raise
    this limit to allow more complex regular expressions to execute.
</p>
</td></tr></tbody></table></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="search-suggesters-phrase.html">
              « 
              Phrase Suggester</a>
           
        </span><span class="next">
           
          <a href="suggester-context.html">Context Suggester
               »
            </a></span></div></body></html>