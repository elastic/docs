<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Heap: Sizing and Swapping
        | Elasticsearch: The Definitive Guide [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [master]" /><link rel="up" href="deploy.html" title="Production Deployment" /><link rel="prev" href="_don_8217_t_touch_these_settings.html" title="Donâ€™t Touch These Settings!" /><link rel="next" href="_file_descriptors_and_mmap.html" title="File Descriptors and MMap" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Docs/Elasticsearch/Definitive Guide/master" />
  	
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- RTP tag -->
    <script type='text/javascript' async>
    (function(c,h,a,f,i,e){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
     c[a].a=i;c[a].e=e;var g=h.createElement("script");g.async=true;g.type="text/javascript";
     g.src=f+'?aid='+i;var b=h.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b);
     })(window,document,"rtp","//sjrtp2-cdn.marketo.com/rtp-api/v1/rtp.js","elasticco");

    rtp('send','view');
    rtp('get', 'campaign',true);
    </script>
    <!-- End of RTP tag -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >


<!-- end DC tags -->


	<meta name="description" content="" />





	<meta property="og:image" content="/static/img/cluster-small.png" />

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	   

    <!-- css -->
    <link href="https://static-www.elastic.co/static/css/main.css?q=802" rel="stylesheet">
    
    

    <script src="https://static-www.elastic.co/static/js/jquery.min.js?q=802"></script>
    <script src="https://static-www.elastic.co/static/js/bootstrap.min.js?q=802"></script>
    <script src="https://static-www.elastic.co/static/js/jquery.cookie.js?q=802"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // ---------------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
        locales = {
          '/en/': '/',
          '/de/': '/de/',
          '/fr/': '/fr/',
          '/ja/':'/jp/',
          '/ko/':'/kr/'
        }
        localepages = ['/','/de/','/fr/','/jp/','/kr/','/products','/de/products','/fr/products','/jp/products','/kr/products'],
        locationpath = window.location.pathname,
        localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}',
        currentlocale = JSON.parse(localeUrl);
    
      if(localepages.indexOf(locationpath) != -1){
        if($.cookie("c_lang")){
          if($.cookie("c_lang") != currentlocale.relative_url_prefix){
            var cookieurl = $.cookie("c_lang") + currentlocale.url.slice(1,currentlocale.url.length);
            window.location = cookieurl;
          }
        }
        else{
          var locale_lang = "/";
          if(locales[lang] != undefined){
            locale_lang = locales[lang];
          }
          $.cookie("c_lang",locale_lang ,{ expires: 365, path: '/'}); 
          window.location = localepages[localepages.indexOf(locationpath)];
        }
      }
      
      // --------------------- end of set language based on browser language -----------------
      </script>


	
	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/guide.css?q=802" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->

    <!-- begin olark code -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
    f[z]=function(){
    (a.s=a.s||[]).push(arguments)};var a=f[z]._={
    },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
    f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
    0:+new Date};a.P=function(u){
    a.p[u]=new Date-a.p[0]};function s(){
    a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
    hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
    return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
    b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
    b.contentWindow[g].open()}catch(w){
    c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
    var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
    b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
    loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
    /* custom configuration goes here (www.olark.com/documentation) */
    olark.identify('1356-750-10-5709');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1356-750-10-5709/contact" title="Contact us">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <!-- end olark code -->

    <script> 
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ 
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), 
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) 
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); 
      ga('create', 'UA-12395217-16', 'auto'); 
      ga('send', 'pageview'); 
    </script>

    <!-- Header Section -->
    
<header class="header-wrapper">
   

  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
            <a href="/learn" class="nav-title hidden-sm hidden-md hidden-lg m-l-8">Learn</a>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <h1>
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="https://static-www.elastic.co/assets/bltd5ac38b4549d53de/elastic-logo-mobile (1).svg?q=802" alt="elastic-logo-mobile">
              </a>
            </h1>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>
            <li id="searchbar"><a class="button icon" href="#"></a></li>
            <li class="lang global-language">
                
                  <a href="#">EN</a>
                
              <ul class="language-list">
                
                  
                    
                  
                <li><a href="/" data-value="/" id="locale-select">English</a></li>
                
                  
                    
                  
                <li><a href="/fr/" data-value="/fr/" id="locale-select">FranÃ§ais</a></li>
                
                  
                    
                  
                <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                
                  
                    
                  
                <li><a href="/jp/" data-value="/jp/" id="locale-select">æ—¥æœ¬èªž</a></li>
                
                  
                    
                  
                <li><a href="/kr/" data-value="/kr/" id="locale-select">í•œêµ­ì–´</a></li>
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <h1>
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="https://static-www.elastic.co/assets/blt6050efb80ceabd47/elastic-logo (2).svg?q=802" alt="elastic-logo">
          </a>
        </h1>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a id="nav_products" class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_cloud" class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_services" class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_customers" class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a id="nav_learn" class="active" href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#"></a></li>
          <li class="hidden-xs lang global-language">
                
                  <a href="#">EN</a>
                
               <ul class="language-list">
              
                
                  
                
              <li><a class="" href="/" data-value="/">English</a></li>
              
                
                  
                
              <li><a class="" href="/fr/" data-value="/fr/">FranÃ§ais</a></li>
              
                
                  
                
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
                
                  
                
              <li><a class="" href="/jp/" data-value="/jp/">æ—¥æœ¬èªž</a></li>
              
                
                  
                
              <li><a class="" href="/kr/" data-value="/kr/">í•œêµ­ì–´</a></li>
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="https://static-www.elastic.co/static/css/horizon-swiper.min.css?q=802">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("https://static-www.elastic.co/assets/blt7b9c4fe6528dc4ef/m-search-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("https://static-www.elastic.co/assets/blt44d8b7530a76d01c/m-guide-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("https://static-www.elastic.co/assets/blt878040795c9d083b/m-contact-icon.png?q=802") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/horizon-swiper.min.js?q=802"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-arrow').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').toggleClass('show');
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-arrow')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    


  





  
  
  
  
    <div class="tertiary-nav">
      <div class="container">
        <div class="p-t-b-15 bdr-btm-e0e0e0 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  

</style>
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header"><b>PLEASE NOTE:</b><br/>We are working on updating this book for the latest version. Some content might be out of date.</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [master]
    </a></span> Â» <span class="breadcrumb-link"><a href="administration.html">Administration, Monitoring, and Deployment </a></span> Â» <span class="breadcrumb-link"><a href="deploy.html">Production Deployment</a></span> Â» <span class="breadcrumb-node">Heap: Sizing and Swapping</span></div><div class="navheader"><span class="prev"><a href="_don_8217_t_touch_these_settings.html">
              Â«Â 
              Donâ€™t Touch These Settings!</a>
          Â 
        </span><span class="next">
          Â 
          <a href="_file_descriptors_and_mmap.html">File Descriptors and MMap
              Â Â»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="heap-sizing"></a>Heap: Sizing and Swapping<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/510_Deployment/50_heap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The default installation of Elasticsearch is configured with a 1 GB heap. <a id="id-1.10.4.11.2.1" class="indexterm"></a>
<a id="id-1.10.4.11.2.2" class="indexterm"></a><a id="id-1.10.4.11.2.3" class="indexterm"></a>
<a id="id-1.10.4.11.2.4" class="indexterm"></a> For
just about every deployment, this number is usually too small.  If you are using the
default heap values, your cluster is probably configured incorrectly.</p><p>There are two ways to change the heap size in Elasticsearch.  The easiest is to
set an environment variable called <code class="literal">ES_HEAP_SIZE</code>.<a id="id-1.10.4.11.3.2" class="indexterm"></a>  When the server process
starts, it will read this environment variable and set the heap accordingly.
As an example, you can set it via the command line as follows:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">export ES_HEAP_SIZE=10g</pre></div><p>Alternatively, you can pass in the heap size via a command-line argument when starting
the process, if that is easier for your setup:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">./bin/elasticsearch -Xmx10g -Xms10g <a id="CO302-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO302-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Ensure that the min (<code class="literal">Xms</code>) and max (<code class="literal">Xmx</code>) sizes are the same to prevent
the heap from resizing at runtime, a very costly process.
</p></td></tr></table></div><p>Generally, setting the <code class="literal">ES_HEAP_SIZE</code> environment variable is preferred over setting
explicit <code class="literal">-Xmx</code> and <code class="literal">-Xms</code> values.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_give_less_than_half_your_memory_to_lucene"></a>Give (less than) Half Your Memory to Lucene<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/510_Deployment/50_heap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A common problem is configuring a heap that is <span class="emphasis"><em>too</em></span> large. <a id="id-1.10.4.11.9.2.2" class="indexterm"></a>
<a id="id-1.10.4.11.9.2.3" class="indexterm"></a>
<a id="id-1.10.4.11.9.2.4" class="indexterm"></a> You have a 64 GB
machineâ€”and by golly, you want to give Elasticsearch all 64 GB of memory.  More
is better!</p><p>Heap is definitely important to Elasticsearch.  It is used by many in-memory data
structures to provide fast operation.  But with that said, there is another major
user of memory that is <span class="emphasis"><em>off heap</em></span>: Lucene.</p><p>Lucene is designed to leverage the underlying OS for caching in-memory data structures.<a id="id-1.10.4.11.9.4.1" class="indexterm"></a>
<a id="id-1.10.4.11.9.4.2" class="indexterm"></a>
Lucene segments are stored in individual files.  Because segments are immutable,
these files never change.  This makes them very cache friendly, and the underlying
OS will happily keep hot segments resident in memory for faster access.  These segments
include both the inverted index (for fulltext search) and doc values (for aggregations).</p><p>Luceneâ€™s performance relies on this interaction with the OS.  But if you give all
available memory to Elasticsearchâ€™s heap, there wonâ€™t be any left over for Lucene.
This can seriously impact the performance.</p><p>The standard recommendation is to give 50% of the available memory to Elasticsearch
heap, while leaving the other 50% free.  It wonâ€™t go unused; Lucene will happily
gobble up whatever is left over.</p><p>If you are not aggregating on analyzed string fields (e.g. you wonâ€™t be needing
<a class="link" href="aggregations-and-analysis.html" title="Aggregations and Analysis">fielddata</a>) you can consider lowering the heap even
more.  The smaller you can make the heap, the better performance you can expect
from both Elasticsearch (faster GCs) and Lucene (more memory for caching).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="compressed_oops"></a>Donâ€™t Cross 32 GB!<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/510_Deployment/50_heap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>There is another reason to not allocate enormous heaps to Elasticsearch. As it turns<a id="id-1.10.4.11.10.2.1" class="indexterm"></a>
<a id="id-1.10.4.11.10.2.2" class="indexterm"></a>
<a id="id-1.10.4.11.10.2.3" class="indexterm"></a><a id="id-1.10.4.11.10.2.4" class="indexterm"></a>
out, the HotSpot JVM uses a trick to compress object pointers when heaps are less
than around 32 GB.</p><p>In Java, all objects are allocated on the heap and referenced by a pointer.
Ordinary object pointers (OOP) point at these objects, and are traditionally
the size of the CPUâ€™s native <span class="emphasis"><em>word</em></span>: either 32 bits or 64 bits, depending on the
processor.  The pointer references the exact byte location of the value.</p><p>For 32-bit systems, this means the maximum heap size is 4 GB.  For 64-bit systems,
the heap size can get much larger, but the overhead of 64-bit pointers means there
is more wasted space simply because the pointer is larger.  And worse than wasted
space, the larger pointers eat up more bandwidth when moving values between
main memory and various caches (LLC, L1, and so forth).</p><p>Java uses a trick called <a class="ulink" href="https://wikis.oracle.com/display/HotSpotInternals/CompressedOops" target="_top">compressed oops</a><a id="id-1.10.4.11.10.5.2" class="indexterm"></a>
to get around this problem.  Instead of pointing at exact byte locations in
memory, the pointers reference <span class="emphasis"><em>object offsets</em></span>.<a id="id-1.10.4.11.10.5.4" class="indexterm"></a>  This means a 32-bit pointer can
reference four billion <span class="emphasis"><em>objects</em></span>, rather than four billion bytes.  Ultimately, this
means the heap can grow to around 32 GB of physical size while still using a 32-bit
pointer.</p><p>Once you cross that magical ~32 GB boundary, the pointers switch back to
ordinary object pointers.  The size of each pointer grows, more CPU-memory
bandwidth is used, and you effectively lose memory.  In fact, it takes until around
40â€“50 GB of allocated heap before you have the same <span class="emphasis"><em>effective</em></span> memory of a
heap just under 32 GB using compressed oops.</p><p>The moral of the story is this: even when you have memory to spare, try to avoid
crossing the 32 GB heap boundary.  It wastes memory, reduces CPU performance, and
makes the GC struggle with large heaps.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_just_how_far_under_32gb_should_i_set_the_jvm"></a>Just how far under 32gb should I set the JVM?<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/510_Deployment/50_heap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Unfortunately, that depends.  The exact cutoff varies by JVMs and platforms.
If you want to play it safe, setting the heap to <code class="literal">31gb</code> is likely safe.
Alternatively, you can verify the cutoff point for the HotSpot JVM by adding
<code class="literal">-XX:+PrintFlagsFinal</code> to your JVM options and checking that the value of the
UseCompressedOops flag is true. This will let you find the exact cutoff for your
platform and JVM.</p><p>For example, here we test a Java 1.7 installation on MacOSX and see the max heap
size is around 32600mb (~31.83gb) before compressed pointers are disabled:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">$ JAVA_HOME=`/usr/libexec/java_home -v 1.7` java -Xmx32600m -XX:+PrintFlagsFinal 2&gt; /dev/null | grep UseCompressedOops
     bool UseCompressedOops   := true
$ JAVA_HOME=`/usr/libexec/java_home -v 1.7` java -Xmx32766m -XX:+PrintFlagsFinal 2&gt; /dev/null | grep UseCompressedOops
     bool UseCompressedOops   = false</pre></div><p>In contrast, a Java 1.8 installation on the same machine has a max heap size
around 32766mb (~31.99gb):</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">$ JAVA_HOME=`/usr/libexec/java_home -v 1.8` java -Xmx32766m -XX:+PrintFlagsFinal 2&gt; /dev/null | grep UseCompressedOops
     bool UseCompressedOops   := true
$ JAVA_HOME=`/usr/libexec/java_home -v 1.8` java -Xmx32767m -XX:+PrintFlagsFinal 2&gt; /dev/null | grep UseCompressedOops
     bool UseCompressedOops   = false</pre></div><p>The moral of the story is that the exact cutoff to leverage compressed oops
varies from JVM to JVM, so take caution when taking examples from elsewhere and
be sure to check your system with your configuration and JVM.</p><p>Beginning with Elasticsearch v2.2.0, the startup log will actually tell you if your
JVM is using compressed OOPs or not.  Youâ€™ll see a log message like:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">[2015-12-16 13:53:33,417][INFO ][env] [Illyana Rasputin] heap size [989.8mb], compressed ordinary object pointers [true]</pre></div><p>Which indicates that compressed object pointers are being used.  If they are not,
the message will say <code class="literal">[false]</code>.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>I Have a Machine with 1 TB RAM!</strong></p></div></div></div><p>The 32 GB line is fairly important.  So what do you do when your machine has a lot
of memory?  It is becoming increasingly common to see super-servers with 512â€“768 GB
of RAM.</p><p>First, we would recommend avoiding such large machines (see <a class="xref" href="hardware.html" title="Hardware">Hardware</a>).</p><p>But if you already have the machines, you have three practical options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Are you doing mostly full-text search?  Consider giving 4-32 GB to Elasticsearch
and letting Lucene use the rest of memory via the OS filesystem cache.  All that
memory will cache segments and lead to blisteringly fast full-text search.
</li><li class="listitem">
Are you doing a lot of sorting/aggregations?  Are most of your aggregations on numerics,
dates, geo_points and <code class="literal">not_analyzed</code> strings?  Youâ€™re in luck, your aggregations will be done on
memory-friendly doc values!  Give Elasticsearch somewhere from 4-32 GB of memory and leave the
rest for the OS to cache doc values in memory.
</li><li class="listitem"><p class="simpara">
Are you doing a lot of sorting/aggregations on analyzed strings (e.g. for word-tags,
or SigTerms, etc)?  Unfortunately that means youâ€™ll need fielddata, which means you
need heap space.  Instead of one node with a huge amount of RAM, consider running two or
more nodes on a single machine.  Still adhere to the 50% rule, though.
</p><p class="simpara">So if your machine has 128 GB of RAM, run two nodes each with just under 32 GB.  This means that less
than 64 GB will be used for heaps, and more than 64 GB will be left over for Lucene.</p><p class="simpara">If you choose this option, set <code class="literal">cluster.routing.allocation.same_shard.host: true</code>
in your config.  This will prevent a primary and a replica shard from colocating
to the same physical machine (since this would remove the benefits of replica high availability).</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_swapping_is_the_death_of_performance"></a>Swapping Is the Death of Performance<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/510_Deployment/50_heap.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It should be obvious,<a id="id-1.10.4.11.12.2.1" class="indexterm"></a>
<a id="id-1.10.4.11.12.2.2" class="indexterm"></a>
<a id="id-1.10.4.11.12.2.3" class="indexterm"></a><a id="id-1.10.4.11.12.2.4" class="indexterm"></a>
<a id="id-1.10.4.11.12.2.5" class="indexterm"></a><a id="id-1.10.4.11.12.2.6" class="indexterm"></a> but it bears spelling out clearly: swapping main memory
to disk will <span class="emphasis"><em>crush</em></span> server performance.  Think about it: an in-memory operation
is one that needs to execute quickly.</p><p>If memory swaps to disk, a 100-microsecond operation becomes one that take 10
milliseconds.  Now repeat that increase in latency for all other 10us operations.
It isnâ€™t difficult to see why swapping is terrible for performance.</p><p>The best thing to do is disable swap completely on your system.  This can be done
temporarily:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">sudo swapoff -a</pre></div><p>To disable it permanently, youâ€™ll likely need to edit your <code class="literal">/etc/fstab</code>.  Consult
the documentation for your OS.</p><p>If disabling swap completely is not an option, you can try to lower <code class="literal">swappiness</code>.
This value controls how aggressively the OS tries to swap memory.
This prevents swapping under normal circumstances, but still allows the OS to swap
under emergency memory situations.</p><p>For most Linux systems, this is configured using the <code class="literal">sysctl</code> value:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-bash">vm.swappiness = 1 <a id="CO303-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO303-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A <code class="literal">swappiness</code> of <code class="literal">1</code> is better than <code class="literal">0</code>, since on some kernel versions a <code class="literal">swappiness</code>
of <code class="literal">0</code> can invoke the OOM-killer.
</p></td></tr></table></div><p>Finally, if neither approach is possible, you should enable <code class="literal">mlockall</code>.
 file.  This allows the JVM to lock its memory and prevent
it from being swapped by the OS.  In your <code class="literal">elasticsearch.yml</code>, set this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">bootstrap.mlockall: true</pre></div></div></div><div class="navfooter"><span class="prev"><a href="_don_8217_t_touch_these_settings.html">
              Â«Â 
              Donâ€™t Touch These Settings!</a>
          Â 
        </span><span class="next">
          Â 
          <a href="_file_descriptors_and_mmap.html">File Descriptors and MMap
              Â Â»
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<h3>Top Videos</h3>
						<ul>
							<li><a href="https://www.elastic.co/webinars/elasticsearch-2-0-overview?baymax=default&elektra=docs&storm=top-video">Getting Started</a></li>
							<li><a href="http://www.elastic.co/webinars/elasticsearch-performance-optimization-tale-two-tickets/?elektra=docs">Scaling</a></li>
							<li><a href="http://www.elastic.co/webinars/shield-securing-your-data-in-elasticsearch/?elektra=docs">Security</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form">
          <form id="mktoForm_1398" class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack">X-Pack</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud">Elastic Cloud</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/security">Security (formerly Shield)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/alerting">Alerting (via Watcher)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/monitoring">Monitoring (formerly Marvel)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/x-pack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">ES-Hadoop</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              <ul>
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              <ul>
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Press</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Language</h3>
              
              <ul>
              
                
                  <li><a href="/" data-value="/">English</a></li>
                
              
                
                  <li><a href="/fr/" data-value="/fr/">FranÃ§ais</a></li>
                
              
                
                  <li><a href="/de/" data-value="/de/">Deutsch</a></li>
                
              
                
                  <li><a href="/jp/" data-value="/jp/">æ—¥æœ¬èªž</a></li>
                
              
                
                  <li><a href="/kr/" data-value="/kr/">í•œêµ­ì–´</a></li>
                
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-12">
        <p class="text-center font-size-10 m-0">FOLLOW US</p>
        <ul>
          
          <li class="facebook"><a id="footer_facebook" href="http://www.facebook.com/elastic.co"></a></li>
          
          <li class="twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic"></a></li>
          
          <li class="linkedin"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co"></a></li>
          
          <li class="xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co"></a></li>
          
          <li class="youtube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch"></a></li>
          
        </ul>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-policy">Privacy</a></li>
				<li><a href="/legal/privacy-and-cookie-policy">Cookie Policy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer.svg" class="img-responsive"></a>
				</div>
				<div class="footer-text">
					<p>Â© 2016. All Rights Reserved - Elasticsearch
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
    
		.facebook{background:url("https://static-www.elastic.co/assets/bltf546ff2e0a8f2de5/facebook.svg?q=802") no-repeat;}
    
    
      .facebook:hover {background:url("https://static-www.elastic.co/assets/bltc24cf11c714ecfc4/facebook-hover.svg?q=802")}		
    
	
    
		.twitter{background:url("https://static-www.elastic.co/assets/bltdd9556d6b24e2b85/twitter.svg?q=802") no-repeat;}
    
    
      .twitter:hover {background:url("https://static-www.elastic.co/assets/blt90b0372cc07a54d3/twitter-hover.svg?q=802")}		
    
	
    
		.linkedin{background:url("https://static-www.elastic.co/assets/bltc4a77e0f52ce07f1/linkedin.svg?q=802") no-repeat;}
    
    
      .linkedin:hover {background:url("https://static-www.elastic.co/assets/blt01ce654380e4ea6c/linkedin-hover.svg?q=802")}		
    
	
    
		.xing{background:url("https://static-www.elastic.co/assets/bltc6347078dcc9ec76/xing.svg?q=802") no-repeat;}
    
    
      .xing:hover {background:url("https://static-www.elastic.co/assets/bltededebe5f7521a39/xing-hover.svg?q=802")}		
    
	
    
		.youtube{background:url("https://static-www.elastic.co/assets/blt4982061ce1aebc7f/youtube.svg?q=802") no-repeat;}
    
    
      .youtube:hover {background:url("https://static-www.elastic.co/assets/bltddeb6c6404ae81a5/youtube-hover.svg?q=802")}		
    
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
  MktoForms2.whenReady(function (form) {
  //    // Put your code that uses the form object here
  //   $('#Email').attr("placeholder","Email Address");
  //   $('#FirstName').attr("placeholder","First Name");
  //   $('#LastName').attr("placeholder","Last Name");
  //   $('#Form_Message').attr("placeholder","Tell us in your words");
  // // ========================End Mktoform placeholder==================
  });

  MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", 1398,function(form){
    form.onSuccess(function(form){
      $('#mktoForm_1398').css('display','none');
      $('.subscribe-wrapper .subscribe-form-container').hide();
      $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
      dataLayer.push({'event': 'mktoFormSubmit'});
        return false;
      });
  });
</script>
      </section>
    </div>
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";	
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","url":"/guide_template"}';
</script>
<script src="https://static-www.elastic.co/static/js/jquery.autocomplete.js?q=802"></script>
<script type="text/javascript" src="https://static-www.elastic.co/static/js/slick.min.js?q=802"></script>
<script src="https://static-www.elastic.co/static/js/nav-v5.js?q=802"></script>
<script src="https://static-www.elastic.co/static/js/script.js?q=802"></script> 
     
     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>