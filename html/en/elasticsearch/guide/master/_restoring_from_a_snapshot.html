
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Restoring from a Snapshot</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide" /><link rel="up" href="post_deploy.html" title="Post-Deployment" /><link rel="prev" href="backing-up-your-cluster.html" title="Backing Up Your Cluster" /><link rel="next" href="_clusters_are_living_breathing_creatures.html" title="Clusters Are Living, Breathing Creatures" />
  
 
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	
	<meta name="description" content="" />
	<meta name="keywords" content="" />



	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<!-- For third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

	<!-- For iPhone with high-resolution Retina display: -->

	<link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

	<!-- For first- and second-generation iPad: -->

	<link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	<link type="text/css" rel="stylesheet" href="/static/css/skel.css" />	
	<link type="text/css" rel="stylesheet" href="/static/css/style.css" />	
	<script src="/static/js/skel.min.js"></script>
	<script type="text/javascript">form_name = "guide_template"</script>
	<script src="/static/js/init.js"></script>
	<script src="/static/js/classie.js"></script>
	

	
	<link type="text/css" rel="stylesheet" href="/static/css/prettify.css" />	
	<script type="text/javascript" src="/static/js/prettify.js"></script>

	

<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
<body >
	<!-- Google Tag Manager -->
	<script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
													  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
			'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-58RLH5');</script>
	<!-- End Google Tag Manager -->
	
	<div class="header-cont">
		<div id="header-wrapper">
			

<div class="container w100">
	<div class="row">
		<div class="12u">
			<section>
				<div class="row">
					<div class="8u 6u(small) 6u(xsmall)">
						<div id="elastic">
							<h1><a href="/"></a></h1>
						</div>
						<!-- Searchbar Input box -->
						<form method="get" action="/search" name="searchForm" class="header-search-form">
						   <input type="text" id="search-header-autocomplete" name="q" class="form-control global-input" placeholder="elastic{search}">
						</form>
						<div class="mobile-auto-complete"></div> 
					</div>
					<div class="4u 6u(small) 6u(xsmall)">
						<!-- Mobile Menu -->
						<div class="mobile-menu-wrapper">
							<ul class="m-shortcuts">
								<li><a id="header-search" class="m-search" href="#"></a></li>
								<li><a class="m-guide" href="/guide"></a></li>
								<li><a class="m-contact" href="/contact"></a></li>
							</ul>											
							<nav class="nav-menu">
								<div class="menu-button">
									<span></span>
								</div>
								<div class="nav-menu-list-wrap">
									<div class="nav-menu-list">
										<h3><a href="/products">Products</a></h3>
										<ul>
											<li><a href="/products/elasticsearch">Elasticsearch</a></li>
											<li><a href="/products/logstash">Logstash</a></li>
											<li><a href="/products/kibana">Kibana</a></li>
											<li><a href="/products/shield">Shield</a></li>
											<li><a href="/products/marvel">Marvel</a></li>
											<li><a href="/products/hadoop">Hadoop</a></li>
											<li><a href="/subscriptions">Support</a></li>
											<li><a href="/downloads">Downloads</a></li>
										</ul>
										<h3><a href="/subscriptions">Subscriptions</a></h3>
										<h3><a href="/learn">Learn</a></h3>
										<ul>
											<li><a href="/guide">Docs</a></li>
											<li><a href="/videos">Videos</a></li>
											<li><a href="http://purchases.elasticsearch.com" target="_blank">Training</a></li>
											<li><a href="/blog">Blog</a></li>
											<li><a href="/elasticon">elastic{ON}</a></li>
										</ul>
										<h3><a href="/community">Community</a></h3>
										<ul>
											<li><a href="/community/meetups">Meetups</a></li>
										</ul>
										<h3><a href="/use-cases">Use Cases</a></h3>
										<h3><a href="/about">About</a></h3>
										<ul>
											<li><a href="/about/leadership">Leadership</a></li>
											<li><a href="/about/board">Board of Directors</a></li>
											<li><a href="/about/careers">Careers</a></li>
											<li><a href="/about/partners">Partners</a></li>
											<li><a href="/about/press">Press</a></li>
										</ul>
									</div>
								</div>
							</nav>
						</div>
						<!-- Shortcuts -->
						<nav id="shortcuts">
							<ul class="links">
								
									<li class="sc-downloads grayscale"><a href="/downloads" id="header_downloads">downloads</a></li>
								
									<li class="sc-docs grayscale"><a href="/guide" id="header_guide">docs</a></li>
								
									<li class="sc-support grayscale"><a href="/subscriptions" id="header_subscriptions">support</a></li>
								
									<li class="sc-contact grayscale"><a href="/contact" id="header_contact">contact</a></li>
								
							</ul>
						</nav>
					</div>
				</div>
			</section>
			

<section class="desktop-main-nav">
	<div class="row">
		<div class="9u">
			<!-- Nav -->
			<nav id="nav">
				<ul>
					
					<li>
						<a href="/products" id="nav_products" >PRODUCTS</a>
						
						<ul class="dropdown">
							
								<li><a href="/products/elasticsearch" id="nav_elasticsearch" >elasticsearch</a></li>								
							
								<li><a href="/products/logstash" id="nav_logstash" >logstash</a></li>								
							
								<li><a href="/products/kibana" id="nav_kibana" >kibana</a></li>								
							
								<li><a href="/products/shield" id="nav_shield" >shield</a></li>								
							
								<li><a href="/products/marvel" id="nav_marvel" >marvel</a></li>								
							
								<li><a href="/products/hadoop" id="nav_hadoop" >hadoop</a></li>								
							
								<li><a href="/subscriptions" id="nav_support" >support</a></li>								
							
								<li><a href="/downloads" id="nav_downloads" >downloads</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/subscriptions" id="nav_subscriptions" >SUBSCRIPTIONS</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/learn" id="nav_learn" >LEARN</a>
						
						<ul class="dropdown">
							
								<li><a href="/guide" id="nav_guide" >docs</a></li>								
							
								<li><a href="/videos" id="nav_videos" >videos</a></li>								
							
								<li><a href="http://purchases.elastic.co" id="nav_training" >training</a></li>								
							
								<li><a href="/blog" id="nav_learn_blog" >blog</a></li>								
							
								<li><a href="/elasticon" id="nav_learn_elasticon" >elastic{ON}</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/community" id="nav_community" >COMMUNITY</a>
						
						<ul class="dropdown">
							
								<li><a href="/community/meetups" id="nav_meetups" >meetups</a></li>								
								
						</ul>							
					</li>
					
					<li>
						<a href="/use-cases" id="nav_usecases" >USE CASES</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/blog" id="nav_blog" >BLOG</a>
						
						<ul class="dropdown">
								
						</ul>							
					</li>
					
					<li>
						<a href="/about" id="nav_about" >ABOUT</a>
						
						<ul class="dropdown">
							
								<li><a href="/about/leadership" id="nav_leadership" >leadership</a></li>								
							
								<li><a href="/about/board" id="nav_board" >board of directors</a></li>								
							
								<li><a href="/about/careers" id="nav_careers" >careers</a></li>								
							
								<li><a href="/about/partners" id="nav_partners" >partners</a></li>								
							
								<li><a href="/about/press" id="nav_press" >press</a></li>								
								
						</ul>							
					</li>
					
				</ul>
			</nav>
		</div>
		<!-- Search -->
		<div class="3u">
			<div id="searchbar">
				<form method="get" action="/search" name="searchForm">
					<input type="text" value="" name="q" placeholder="elastic{search}" id="autocomplete">
					<button class="button icon" onclick="searchForm.submit()">GO</button>
				</form>
			</div>
			<div class="nav-auto-complete"></div>
		</div>
	</div>
</section>

		</div>
	</div>
</div>

<style>	
	
		.sc-downloads{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-docs{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-support{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
	
		.sc-contact{ background: url("/assets/blt0b75d0822b89593e/shortcuts.png") no-repeat;}
		
</style>
		</div>
	</div>
  	<div id="content">
  		
  			
            <div id="pageheader">
    <div class="container">
        <header>
            <h1>Learn |</h1>
            <h2>Docs</h2>
        </header>
    </div>
</div>
<section id="guide">

            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide</a></span> » <span class="breadcrumb-link"><a href="administration.html">Administration, Monitoring, and Deployment </a></span> » <span class="breadcrumb-link"><a href="post_deploy.html">Post-Deployment</a></span> » <span class="breadcrumb-node">Restoring from a Snapshot</span></div><div class="navheader"><span class="prev"><a href="backing-up-your-cluster.html">
              « 
              Backing Up Your Cluster</a>
           
        </span><span class="next">
           
          <a href="_clusters_are_living_breathing_creatures.html">Clusters Are Living, Breathing Creatures
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_restoring_from_a_snapshot"></a>Restoring from a Snapshot<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/520_Post_Deployment/60_restore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="_changing_settings_dynamically.html">Changing Settings Dynamically</a></span></dt><dt><span class="section"><a href="logging.html">Logging</a></span></dt><dt><span class="section"><a href="indexing-performance.html">Indexing Performance Tips</a></span></dt><dt><span class="section"><a href="_rolling_restarts.html">Rolling Restarts</a></span></dt><dt><span class="section"><a href="backing-up-your-cluster.html">Backing Up Your Cluster</a></span></dt><dt><span class="section"><a href="_restoring_from_a_snapshot.html">Restoring from a Snapshot</a></span></dt><dt><span class="section"><a href="_clusters_are_living_breathing_creatures.html">Clusters Are Living, Breathing Creatures</a></span></dt></dl></div><p>Once you’ve backed up some data, restoring it is easy: simply add <code class="literal">_restore</code>
to the ID of<a id="id-1.10.5.8.2.2" class="indexterm"></a>
<a id="id-1.10.5.8.2.3" class="indexterm"></a><a id="id-1.10.5.8.2.4" class="indexterm"></a> the snapshot you wish to restore into your cluster:</p><pre class="programlisting prettyprint lang-js">POST _snapshot/my_backup/snapshot_1/_restore</pre><p>The default behavior is to restore all indices that exist in that snapshot.
If <code class="literal">snapshot_1</code> contains five indices, all five will be restored into
our cluster. <a id="id-1.10.5.8.4.2" class="indexterm"></a>
<a id="id-1.10.5.8.4.3" class="indexterm"></a> As with the <code class="literal">snapshot</code> API, it is possible to select which indices
we want to restore.</p><p>There are also additional options for renaming indices.  This allows you to
match index names with a pattern, and then provide a new name during the restore process.
This is useful if you want to restore old data to verify its contents, or perform
some other processing, without replacing existing data.  Let’s restore
a single index from the snapshot and provide a replacement name:</p><pre class="programlisting prettyprint lang-js">POST /_snapshot/my_backup/snapshot_1/_restore
{
    "indices": "index_1", <a id="CO320-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "rename_pattern": "index_(.+)", <a id="CO320-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "rename_replacement": "restored_index_$1" <a id="CO320-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO320-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Restore only the <code class="literal">index_1</code> index, ignoring the rest that are present in the
snapshot.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO320-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Find any indices being restored that match the provided pattern.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO320-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Then rename them with the replacement pattern.
</p></td></tr></table></div><p>This will restore <code class="literal">index_1</code> into your cluster, but rename it to <code class="literal">restored_index_1</code>.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Similar to snapshotting, the <code class="literal">restore</code> command will return immediately, and the
restoration process will happen in the background.  If you would prefer your HTTP
call to block until the restore is finished, simply add the <code class="literal">wait_for_completion</code>
flag:</p><pre class="programlisting prettyprint lang-js">POST _snapshot/my_backup/snapshot_1/_restore?wait_for_completion=true</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_monitoring_restore_operations"></a>Monitoring Restore Operations<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/520_Post_Deployment/60_restore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The restoration of data from a repository piggybacks on the existing recovery
mechanisms already in place in Elasticsearch.<a id="id-1.10.5.8.10.2.1" class="indexterm"></a>
<a id="id-1.10.5.8.10.2.2" class="indexterm"></a>  Internally, recovering shards
from a repository is identical to recovering from another node.</p><p>If you wish to monitor the progress of a restore, you can use the <code class="literal">recovery</code>
API.  This is a general-purpose API that shows the status of shards moving around
your cluster.</p><p>The API can be invoked for the specific indices that you are recovering:</p><pre class="programlisting prettyprint lang-js">GET /_recovery/restored_index_3</pre><p>Or for all indices in your cluster, which may include other shards moving around,
unrelated to your restore process:</p><pre class="programlisting prettyprint lang-js">GET /_recovery/</pre><p>The output will look similar to this (and note, it can become very verbose
depending on the activity of your clsuter!):</p><pre class="programlisting prettyprint lang-js">{
  "restored_index_3" : {
    "shards" : [ {
      "id" : 0,
      "type" : "snapshot", <a id="CO321-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
      "stage" : "index",
      "primary" : true,
      "start_time" : "2014-02-24T12:15:59.716",
      "stop_time" : 0,
      "total_time_in_millis" : 175576,
      "source" : { <a id="CO321-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        "repository" : "my_backup",
        "snapshot" : "snapshot_3",
        "index" : "restored_index_3"
      },
      "target" : {
        "id" : "ryqJ5lO5S4-lSFbGntkEkg",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "files" : {
          "total" : 73,
          "reused" : 0,
          "recovered" : 69,
          "percent" : "94.5%" <a id="CO321-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        },
        "bytes" : {
          "total" : 79063092,
          "reused" : 0,
          "recovered" : 68891939,
          "percent" : "87.1%"
        },
        "total_time_in_millis" : 0
      },
      "translog" : {
        "recovered" : 0,
        "total_time_in_millis" : 0
      },
      "start" : {
        "check_index_time" : 0,
        "total_time_in_millis" : 0
      }
    } ]
  }
}</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO321-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">type</code> field tells you the nature of the recovery; this shard is being
recovered from a snapshot.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO321-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">source</code> hash describes the particular snapshot and repository that is
being recovered from.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO321-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">percent</code> field gives you an idea about the status of the recovery.
This particular shard has recovered 94% of the files so far; it is almost complete.
</p></td></tr></table></div><p>The output will list all indices currently undergoing a recovery, and then
list all shards in each of those indices.  Each shard will have stats
about start/stop time, duration, recover percentage, bytes transferred, and more.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_canceling_a_restore"></a>Canceling a Restore<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/520_Post_Deployment/60_restore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To cancel a restore, you need to delete the indices being restored.<a id="id-1.10.5.8.11.2.1" class="indexterm"></a>
<a id="id-1.10.5.8.11.2.2" class="indexterm"></a>  Because
a restore process is really just shard recovery, issuing a <code class="literal">delete-index</code> API
alters the cluster state, which will in turn halt recovery.  For example:</p><pre class="programlisting prettyprint lang-js">DELETE /restored_index_3</pre><p>If <code class="literal">restored_index_3</code> was actively being restored, this delete command would
halt the restoration as well as deleting any data that had already been restored
into the cluster.</p></div></div><div class="navfooter"><span class="prev"><a href="backing-up-your-cluster.html">
              « 
              Backing Up Your Cluster</a>
           
        </span><span class="next">
           
          <a href="_clusters_are_living_breathing_creatures.html">Clusters Are Living, Breathing Creatures
               »
            </a></span></div>
<!-- end body -->

            </section>

            <!-- Footer -->
        
	<div id="footer-wrapper">
		<section id="footer" class="container">
			<div class="row">
				<div class="12u">
					<!-- Copyright -->
					<div id="copyright">
	<p>
		© 2015. All Rights Reserved - Elasticsearch
	</p>
	<ul class="links">
		<li>Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries</li>
		<li><a href="/legal/trademarks" id="footer_trademarks">Trademarks</a></li>
		<li><a href="/legal/terms-of-use" id="footer_terms">Terms</a></li>
		<li><a href="/legal/privacy-policy" id="footer_privacy">Privacy</a></li>
	</ul>
	<p>
		Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/" target="_blank">Apache Software Foundation</a> in the United States and/or other&nbsp;countries.
	</p>
</div><!--<div class="row">
{replace4}
</div>-->
				</div>
			</div>					
		</section>
	</div>
			
	<!-- Social Media -->
	<div id="socialmedia-wrapper">
		<section id="socialmedia" class="container">
			<!-- social icons -->
			<div id="social">
				<ul class="links">
					
						<li class="facebook grayscale"><a href="http://www.facebook.com/elastic.co" target="_blank" id="footer_facebook"></a></li>
					
						<li class="twitter grayscale"><a href="https://www.twitter.com/elastic" target="_blank" id="footer_twitter"></a></li>
					
						<li class="linkedin grayscale"><a href="http://www.linkedin.com/company/elasticsearch" target="_blank" id="footer_linkedin"></a></li>
					
						<li class="xing grayscale"><a href="https://www.xing.com/companies/elastic.co" target="_blank" id="footer_xing"></a></li>
					
				</ul>
			</div>
		</section>
	</div>


<style type="text/css">
	
		.facebook{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.twitter{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.linkedin{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
		.xing{background:url("/assets/blte0d4d10ae3bd8337/social-media.png") no-repeat;}		
	
</style>	

  	</div>
  	<!-- <div class="preloader">
    	<div class="status"></div>
	</div> -->
  	<style></style>
   	<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script src="/static/js/script.js"></script>
   	
   		

            <script type="text/javascript">
  jQuery(function() {
    jQuery('#guide a[id]').each(function() { this.href='#'+this.id });
    jQuery('pre.prettyprint').each(function() {
      var pre = jQuery(this);
      pre.css('position','absolute');
      pre.css('width','auto');
      var height = pre.innerHeight();
      pre.wrap('<div class="pre_wrapper" style="height:' + (10 + height) + 'px"></div>');
    })
  });
</script>
<script type='text/javascript' src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'></script>
<script type="text/javascript" >
  (function ($, $a, $title, $list) {
    $a = $('[id^="js-api-method-index"]');
    if (!$a.size()) return;
    $('#guide').addClass('js-client-docs');
    $list = $a.siblings('.itemizedlist').detach();
    $title = $(document.createElement('h2')).text('api methods')
    $a.parent().remove();
    $('.toc').first().append($(document.createElement('div')).addClass('js-api-method-index').append($title).append($list));
  }(jQuery));
</script>

            </body>
        