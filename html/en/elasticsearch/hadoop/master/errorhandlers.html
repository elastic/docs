<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Error Handlers
        | Elasticsearch for Apache Hadoop [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [master]" /><link rel="up" href="reference.html" title="Elasticsearch for Apache Hadoop" /><link rel="prev" href="mapping.html" title="Mapping and Types" /><link rel="next" href="metrics.html" title="Hadoop Metrics" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">
<!-- DC tags section -->
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >



	



<!-- end DC tags -->


	<meta name="description" content="" />



	<meta name="localized" content="true" />


















		
			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
		

		

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

	 

    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    
    

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <script type="text/javascript">
  // -------------------- set language based on browser language --------------------
  var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

  if($.cookie("is_lang_detected") == undefined){
    if(locales[lang] != undefined && locales[lang] != currentlocale){
      locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
      $.cookie("is_lang_detected",true ,{ path: '/'}); 
      window.location = locale_lang_url;
    } 
  }
        
  // --------------------- end of set language based on browser language -----------------
  </script>


	
	<link type="text/css" rel="stylesheet" href="/static/css/guide.css" />


  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>
  <body >
  	<!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5"
                              height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
<script src="/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>


<script type="text/javascript">
  var active;
  
  active = Math.random() < 1 //0.9 
  
  elasticApm.init({
    active: active,
    serviceName: "elastic-co-frontend",
    serverUrl: "https://elastic-co-apm-server.app.elstc.co"
  })

  var pageLoadName
  var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
  var parts = pathname.split('/');

  if (parts.length && parts[1] === 'blog') {
    if (parts.length === 2) {
      pageLoadName =  '/blog';
    }
    else if (parts[2] === 'category') {
      pageLoadName =  '/blog/category';
    }
    else if (parts[2] === 'archive') {
      pageLoadName =  '/blog/archive';
    }
    else {
      pageLoadName =  '/blog/detail';
    }
  }
  else if (parts.length && parts[1] === 'elasticon') {
    if (parts.length === 2) {
      pageLoadName =  '/elasticon';
    }
    else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/overview';
    }
    else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
      pageLoadName =  '/elasticon/video';
    }
  }
  else if (parts.length && parts[1] === 'guide') {
    pageLoadName =  '/guide';
  }
  else if (parts.length === 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos';
  }
  else if (parts.length > 2 && parts[1] === 'videos') {
    pageLoadName =  '/videos/detail';
  }
  else if (parts.length > 2 && parts[1] === 'webinars') {
    pageLoadName =  '/webinars/detail';
  }
  else {
    pageLoadName =  window.location.pathname;
  }

  console.log('apm pageLoadName:', pageLoadName, parts)
  elasticApm.setTags({env:"production"});
  elasticApm.setInitialPageLoadName(pageLoadName);
</script>

<!-- Elastic APM -->


    <!-- Header Section -->
    
<header class="header-wrapper">
  



  




<div class="navigation-wrapper">
  <div class="container">
    <nav class="navbar">
    <!-- Brand and toggle get grouped for better mobile display -->

    <div class="navbar-mobile-header navbar-header mr-20 mr-xs-0">
      <div class="row hidden-sm hidden-md hidden-lg">
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg">
          <div class="navbar-mobile-header-icon navbar-mobile-header-icon-out">
            <span></span>
            <span></span>
            <span></span>
          </div>
          
        </div>
        <div class="col-xs-2 text-center">
          <div class="navbar-brand" id="elastic">
            <div id="logo">
              <a class="logo-m hidden-sm hidden-md hidden-lg" href="/">
                <img src="/assets/blta09706b1c5cc1e99/elastic-logo-mobile.svg" alt="elastic-logo-mobile">
              </a>
            </div>
          </div>
        </div>
        <div class="col-xs-5 hidden-sm hidden-md hidden-lg text-right">
          <ul class="menu-m hidden-sm hidden-md hidden-lg">
            <li class=""><a class="icon-contact" href="/contact"></a></li>

            <li id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>
            <li class="lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
              <ul class="language-list">
                
                  
                    
                  
                  
                  <li><a href="/de/" data-value="/de/" id="locale-select">Deutsch</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="#" data-value="/" id="locale-select">English</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/es/" data-value="/es/" id="locale-select">Español</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/fr/" data-value="/fr/" id="locale-select">Français</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/jp/" data-value="/jp/" id="locale-select">日本語</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/kr/" data-value="/kr/" id="locale-select">한국어</a></li>
                  
                
                  
                    
                  
                  
                  <li><a href="/cn/" data-value="/cn/" id="locale-select">简体中文</a></li>
                  
                
              </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="navbar-brand hidden-xs" id="elastic">
        <div id="logo">
          <a class="hidden-xs" id="elastic-logo" href="/">
            <img src="/assets/blt244a845f141977c3/elastic-logo.svg" alt="elastic-logo">
          </a>
        </div>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse mobile-inner-nav">
      <nav class="nav navbar-nav primary-nav-hover" id="nav">
        <ul>
        
          
            
              
            
            <li>
              <a class=" " href="/products">Products</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/cloud">Cloud</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/services">Services</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/use-cases">Customers</a>
            </li>
          
        
          
            
              
            
            <li>
              <a class=" " href="/learn">Learn</a>
            </li>
          
        
          
        
        </ul>
      </nav>
      <nav class="nav navbar-nav navbar-right hidden-xs">
        <ul>
          <li class="hidden-xs hidden-sm"><a href="/downloads">downloads</a></li>
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-download" href="/downloads"></a></li>
          <!-- To set parameters to contact button -->
          
           
            
          

          
            
            
          
          <li class="hidden-xs hidden-sm"><a class="btn btn-secondary btn-contact" href="/contact?storm=global-header-en">contact</a></li>
          <!-- ////////////////ends here///////////////-->          
          <li class="hidden-xs hidden-md hidden-lg"><a class="icon-contact" href="/contact?storm=global-header-en"></a></li>
          <li class="hidden-xs" id="searchbar"><a class="button icon" href="#" alt="Search"></a></li>

          <li class="hidden-xs lang global-language">
                
                  
                
                  
                    <a href="#">EN</a>
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
               <ul class="language-list">
              
                
                  
                
              
              <li><a class="" href="/de/" data-value="/de/">Deutsch</a></li>
              
              
                
                  
                
              
              <li><a class="" href="#" data-value="/">English</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/es/" data-value="/es/">Español</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/fr/" data-value="/fr/">Français</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/jp/" data-value="/jp/">日本語</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/kr/" data-value="/kr/">한국어</a></li>
              
              
                
                  
                
              
              <li><a class="" href="/cn/" data-value="/cn/">简体中文</a></li>
              
              
            </ul>
          </li>
        </ul>
      </nav>
    </div><!-- /.navbar-collapse -->
  </nav>
  </div>
</div>

<div class="header-search-wrapper open-search"> 
  <div class="container">
    <div class="big-search">
      <i class="big-search-icon"></i>
      <form id="searchfrm" name="searchForm" autocomplete="on" action="/search" method="get">
        <ul class="tags-wrapper">
          <li class="search-field"><input type="text" name="q" id="autocomplete" class="form-control global-input" autocomplete="off"></li>
        </ul>
      </form>
      <a class="header-search-cancel" href="#"></a>
    </div>
    <div class="nav-auto-complete"></div>
  </div>
</div>
</header>
<link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">
<style> 
    
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    
    
</style>
<script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>
<script type="text/javascript">
  $(document).ready( function(){
    // if($('#scrollable-pane li').length > 3){
      $('.horizon-swiper').horizonSwiper({
        showItems: 3,
        arrows: true
      }); 
    // }
    
    $('.navbar-toggle').on('click', function(){
      $('.mobile-navigation, .menu-open').hide();
      $('.navigation-wrapper').addClass('mobile-navigation');
      $('.navbar').addClass('menu-open');
      $('.menu-close').show();
    });
    $('.menu-close').on('click', function(){
      $('.navigation-wrapper').removeClass('mobile-navigation');
      $('.navbar').removeClass('menu-open');
      $('.menu-close').hide();
    });

    var active_url = "";

    $(".navbar-mobile-header-icon").click(function(index){
      $('.navigation-wrapper').toggleClass('menu-overlay');
      $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
      $(".mobile-inner-nav").slideToggle(500);
      $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
        $(this).css({'animation-delay': (index/25)+'0.4s'});
      });
    });

    $('.dropdown-btn').on('click', function(e){
      e.preventDefault();
      setDropdown();
    });
    
    function setDropdown() {
      $('#myDropdown').slideToggle();
    }

    $('body').on('click', function(event){
      if (!event.target.matches('.dropdown-btn')) {

        var dropdowns = $(".dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    });

    // if($(window).width() < 769){
    //   var $item = $('.scrollable-panel li'), 
    //       visible = 3, //Set the number of items that will be visible
    //       index = 0, //Starting index
    //       endIndex = ( $item.length / visible ) - 1; //End index (NOTE:: Requires visible to be a factor of $item.length... You can improve this by rounding...)

    //   $('#right-arrow').click(function(){
    //     if(index < endIndex ){
    //       index++;
    //       $item.animate({'left':'-=300px'});
    //     }
    //   });

    //   $('#left-arrow').click(function(){
    //     if(index > 0){
    //       index--;            
    //       $item.animate({'left':'+=300px'});
    //     }
    //   });
    // }
  });
  $(window).resize(function () {
    $('.horizon-swiper').horizonSwiper({
      showItems: 3,
      arrows: true
    });
  });
</script>
    
      


  





  
  
  
  
    <div class="tertiary-nav bdr-btm-e0e0e0">
      <div class="container">
        <div class="p-t-b-15 clearfix">
          <div class="breadcrum-wrapper pull-left text-left">
          
            <a href="/guide">Docs</a> 
          
          </div>
          
          
          
        </div>
      </div>
    </div>

    <div class="nav-mobile-dropdown hidden-sm hidden-md hidden-lg bdr-btm-e0e0e0 clearfix">
      <div class="container text-right">
        <div class="breadcrum-wrapper pull-left text-left">
          
              <a href="/guide">Docs</a>
          
        </div>
        
        
      </div>
    </div>
  


<style type="text/css">

  
</style>
    
    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   
          
            
        			<!-- <div class="pageheader">
	<div class="common-container">
		
			<h2 class="page-title">Guide template</h2>
		
	</div>
</div> -->


        		
          

          
	<section id="guide" lang="en">
		<div class="container">
			<div class="row">
			  <!-- start body -->
				
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Elasticsearch for Apache Hadoop</a></span> » <span class="breadcrumb-node">Error Handlers</span></div><div class="navheader"><span class="prev"><a href="mapping.html">
              « 
              Mapping and Types</a>
           
        </span><span class="next">
           
          <a href="metrics.html">Hadoop Metrics
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="errorhandlers"></a>Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Added in 6.4. </p></div></div><p>Elasticsearch for Apache Hadoop is designed to be a mostly hands off integration. Most of the features are managed through conventions and
configurations and no substantial amount of code is required to get up and running with the connector. When it comes to
exceptions, substantial effort has been put into handling the most common and expected errors from Elasticsearch.
In the case where errors are unexpected or indicative of a real problem, the connector adopts a "fail-fast" approach. We
realize that this approach is not the best for all users, especially those concerned with uptime of their jobs.</p><p>In these situations, users can handle unexpected errors by specifying the actions
to take when encountering them. To this end, we have provided a set of APIs and extensions that users can
implement in order to tailor the connector’s behavior toward encountering failures in the most common locations to their
needs.</p><h3><a id="errorhandlers-mechanics"></a>Error Handler Mechanics<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each type of failure that can be handled in elasticsearch-hadoop has its own error handler API tailored to operation being performed.
An error handler is simply a function that is called when an error occurs, and informs elasticsearch-hadoop how to proceed.
Multiple error handlers may be specified for each type of failure. When a failure occurs, each error handler will be
executed in the order that they are specified in the configuration.</p><p>An error handler is given information about the performed operation and any details about the error that was
encountered. The handler may then acknowledge and consume the failure telling elasticsearch-hadoop to ignore the error.
Alternatively, the handler may mark the error to be rethrown, potentially ending the job. Error handlers are also given
the option to modify the operation’s parameters and retry it. Finally, the handler may also "pass" the failure on to the
next handler in the list if it does not know how to handle it.</p><p>If every handler in the provided list of handlers chooses to "pass", it is marked as an unhandled
error and the exceptions will be rethrown, potentially ending the job. The connector ships with a few default error
handlers that take care of most use cases, but if you find that you need a more specific error handling strategy, you
can always write your own.</p><p>In the following sections, we will detail the different types of error handlers, where they are called, how to configure
them, and how to write your own if you need to.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="errorhandlers-bulk"></a>Bulk Write Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When writing data, the connector batches up documents into a bulk request before sending them to Elasticsearch. In the response,
Elasticsearch returns a status for each document sent, which may include rejections or failures. A common error encountered
here is a <span class="emphasis"><em>rejection</em></span> which means that the shard that the document was meant to be written to was too busy to accept
the write. Other failures here might include documents that are refused because they do not conform to the current
index mapping, or conflict with the current version of the document.</p><p>Elasticsearch for Apache Hadoop provides an API to handle document level errors from bulk responses. Error handlers for bulk writes are given:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The raw JSON bulk entry that was tried
</li><li class="listitem">
Error message
</li><li class="listitem">
HTTP status code for the document
</li><li class="listitem">
Number of times that the current document has been sent to Elasticsearch
</li></ul></div><p>There are a few default error handlers provided by the connector:</p><h4><a id="errorhandlers-bulk-http"></a>HTTP Retry Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Always configured as the first error handler for bulk writes.</p><p>This handler checks the failures for common HTTP codes that can be retried. These codes are usually indicators that the
shard the document would be written to is too busy to accept the write, and the document was rejected to shed load.
This handler is always configured to be run first for bulk failures. All handlers that are configured by the user are
placed in order after this one.</p><p>While the handler’s position in the list of error handlers cannot be modified, its behavior can be modified by adjusting
the following configurations:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.batch.write.retry.policy</code> (default: simple)
</span></dt><dd>
Defines the policy for determining which http codes are able to be retried. The default value <code class="literal">simple</code> allows for 429
(Too Many Requests) and 503 (Unavailable) to be retried. Setting the value to <code class="literal">none</code> will allow no status codes to be
retried.
</dd><dt><span class="term">
<code class="literal">es.batch.write.retry.count</code> (default 3)
</span></dt><dd>
Number of retries for a given batch in case Elasticsearch is overloaded and data is rejected. Note that only the rejected data
is retried. If there is still data rejected after the retries have been performed, the Hadoop job is cancelled (and
fails). A negative value indicates infinite retries; be careful in setting this value as it can have unwanted side
effects.
</dd><dt><span class="term">
<code class="literal">es.batch.write.retry.wait</code> (default 10s)
</span></dt><dd>
Time to wait between batch write retries that are caused by bulk rejections.
</dd></dl></div><h4><a id="errorhandlers-bulk-log"></a>Drop and Log Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">log</code></p><p>When this handler is invoked it logs a message containing the JSON bulk entry that failed, the error message, and any previous
handler messages. After logging this message, the handler signals that the error has been acknowledged, thus
consuming/ignoring it.</p><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.write.rest.error.handler.log.logger.name</code> (required)
</span></dt><dd>
The string name to use when creating the logger instance to log the errors. This setting is required if this handler is used.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.log.logger.class</code> (alternative to logger.name)
</span></dt><dd>
The class name to use when creating the logger instance to log the errors. This setting can be used instead of the
required setting <code class="literal">es.write.rest.error.handler.log.logger.name</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.log.logger.level</code> (default: WARN)
</span></dt><dd>
The logger level to use when logging the error message. Available options are <code class="literal">FATAL</code>, <code class="literal">ERROR</code>, <code class="literal">WARN</code>, <code class="literal">INFO</code>, <code class="literal">DEBUG</code>, and <code class="literal">TRACE</code>.
</dd></dl></div><h4><a id="errorhandlers-bulk-fail"></a>Abort on Failure Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">fail</code></p><p>When this handler is called it rethrows the error given to it and aborts. This handler is always loaded and automatically
placed at the end of the list of error handlers.</p><p>There are no configurations for this handler.</p><h4><a id="errorhandlers-bulk-es"></a>Elasticsearch Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">es</code></p><p>When this handler is invoked it converts the error given into a JSON document and inserts it into an Elasticsearch index.
When this indexing operation is complete, the handler can be configured to signal that the error is handled (default),
or pass the error along to the next handler in the chain. The ES handler serializes error information using its own
mapping of the Elastic Common Schema. This data can accept additional user provided metadata that can assist users in
searching and reporting on failures (see labels and tags settings below).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Error handlers are built to execute on a per record/error basis. The Elasticsearch Error Handler does not bulk
insert error information currently. Each error is inserted one at a time in order to ensure each record/error is handled.
This handler may not provide a very high throughput in cases where there are a large number of error events to handle. You
should try to design your jobs so that error handling is a relatively uncommon occurrence.</p></div></div><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.nodes</code> (default: "localhost" or currently configured nodes)
</span></dt><dd>
The comma separated string of node addresses to write errors to. It is recommended that this be a different cluster than
the one being written to (in order to avoid write contention).
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.port</code> (default: 9200 or currently configured port)
</span></dt><dd>
The http port to use when connecting to the Elasticsearch nodes.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.resource</code> (required)
</span></dt><dd>
The index to write error information into. It is highly recommended that this index be just for error information.
Does not support index patterns.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.inherit</code> (default: true)
</span></dt><dd>
Determines if the settings to create the client used for sending error information should inherit the same client settings
from the currently running job. By default, all client settings in the job configuration are inherited by this client.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.conf.&lt;CONFIGURATION&gt;</code> 
</span></dt><dd>
This configuration prefix is used to set client configuration values in the handler’s underlying ES client. This accepts
most of the settings documented in <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.label.&lt;LABEL&gt;</code> (optional)
</span></dt><dd>
A user defined label field that is added to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.tags</code> (optional)
</span></dt><dd>
The comma separated string of tags to add to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default</code> (default: HANDLED)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error is successfully written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">HANDLED</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default.reason</code> (optional)
</span></dt><dd>
In the case that the default return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for
the handler to pass the data along to the next handler in the chain.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error</code> (default: ABORT)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error cannot be written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">ABORT</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error.reason</code> (optional)
</span></dt><dd>
In the case that the error return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for the
handler to pass the data along to the next handler in the chain.
</dd></dl></div><h3><a id="errorhandlers-bulk-use"></a>Using Bulk Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure bulk error handlers, you must specify the handlers in order with the following properties.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.rest.error.handlers</code>
</span></dt><dd>
Lists the names of the error handlers to use for bulk write error handling, and the order that they should be called on.
Each default handler can be referenced by their handler name as the connector knows how to load them. Any handlers
provided from users or third party code will need to have their handler names defined with the <code class="literal">es.write.rest.error.handler.</code>
prefix.
</dd></dl></div><p>For bulk write failures, the HTTP Retry built-in handler is always placed as the first error handler. Additionally, the Abort on
Failure built-in handler is always placed as the last error handler to catch any unhandled errors. These two error handlers alone
form the default bulk write error handling behavior for elasticsearch-hadoop, which matches the behavior from previous versions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
HTTP Retry Built-In Handler: Retries benign bulk rejections and failures from Elasticsearch and passes any other error down the line
</li><li class="listitem">
Any configured user handlers will go here.
</li><li class="listitem">
Abort on Failure Built-In Handler: Rethrows the any errors it encounters
</li></ol></div><p>This behavior is modified by inserting handlers into the chain by using the handlers property. Let’s say that we want
to log ALL errors and ignore them.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handlers = log <a id="CO100-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO100-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log handler
</p></td></tr></table></div><p>With the above configuration, the handler list now looks like the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
HTTP Retry Handler
</li><li class="listitem">
Drop and Log Handler
</li><li class="listitem">
Abort on Failure Handler
</li></ol></div><p>As described above, the built-in <code class="literal">log</code> error handler has a required setting: What to use for the logger name. The logger
used will respect whatever logging configuration you have in place, and thus needs a name for the logger to use:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handlers = log <a id="CO101-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.write.rest.error.handler.log.logger.name = BulkErrors <a id="CO101-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO101-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log built-in handler
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO101-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The Drop and Log built-in handler will log all errors to the <code class="literal">BulkErrors</code> logger
</p></td></tr></table></div><p>At this point, the Abort on Failure built-in handler is effectively ignored since the Drop and Log built-in handler will
always mark an error as consumed. This practice can prove to be hazardous, as potentially important errors may simply be
ignored. In many cases, it is preferable for users to write their own error handler to handle expected exceptions.</p><h4><a id="errorhandlers-bulk-user-handlers"></a>Writing Your Own Bulk Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Let’s say that you are streaming sensitive transaction data to Elasticsearch. In this scenario, your data is carefully versioned
and you take advantage of Elasticsearch’s version system to keep from overwriting newer data with older data. Perhaps your data
is distributed in a way that allows newer data to sneak in to Elasticsearch before some older bits of data. No worries, the
version system will reject the older data and preserve the integrity of the data in Elasticsearch. The problem here is that your
streaming job has failed because conflict errors were returned and the connector was unsure if you were expecting that.</p><p>Let’s write an error handler for this situation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.rest.bulk.handler.BulkWriteErrorHandler;
import org.elasticsearch.hadoop.rest.bulk.handler.BulkWriteFailure;
import org.elasticsearch.hadoop.rest.bulk.handler.DelayableErrorCollector;

public class IgnoreConflictsHandler extends BulkWriteErrorHandler { <a id="CO102-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private static final Logger LOGGER = ...; <a id="CO102-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

    @Override
    public HandlerResult onError(BulkWriteFailure entry, DelayableErrorCollector&lt;byte[]&gt; collector) <a id="CO102-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
    throws Exception
    {
        if (entry.getResponseCode() == 409) { <a id="CO102-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            LOGGER.warn("Encountered conflict response. Ignoring old data.");
            return HandlerResult.HANDLED; <a id="CO102-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
        }
        return collector.pass("Not a conflict response code."); <a id="CO102-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We create a class and extend the BulkWriteErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Create a logger using preferred logging solution
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Override the <code class="literal">onError</code> method which will be invoked with the error details
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Check the response code from the error to see if it is 409 (Confict)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If it is a conflict, log the error and return <code class="literal">HandlerResult.HANDLED</code> to signal that the error is acknowledged
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO102-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If the error is not a conflict we pass it along to the next error handler with the reason we couldn’t handle it
</p></td></tr></table></div><p>Before we can place this handler in the list of bulk write error handlers, we must register the handler class with a
name in the settings using <code class="literal">es.write.rest.error.handler.[HANDLER-NAME]</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.rest.error.handler.[HANDLER-NAME]</code>
</span></dt><dd>
Create a new handler named HANDLER-NAME. The value of this property must be the binary name of the class to
instantiate for this handler.
</dd></dl></div><p>In this case, lets register a handler name for our ignore conflicts handler:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handler.ignoreConflict = org.myproject.myhandlers.IgnoreConflictsHandler</pre></div><p>Now that we have a name for the handler, we can use it in the handler list:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handlers = ignoreConflict
es.write.rest.error.handler.ignoreConflict = org.myproject.myhandlers.IgnoreConflictsHandler</pre></div><p>Now, your ignore conflict error handler will be invoked whenever a bulk failure occurs, and will instruct the connector
that it is ok with ignoring conflict response codes from Elasticsearch.</p><h4><a id="errorhandlers-bulk-advanced"></a>Advanced Concepts<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>What if instead of logging data and dropping it, what if you wanted to persist it somewhere for safe keeping? What if
we wanted to pass properties into our handlers to parameterize their behavior? Lets create a handler that stores error
information in a local file for later analysis.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import ...

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.rest.bulk.handler.BulkWriteErrorHandler;
import org.elasticsearch.hadoop.rest.bulk.handler.BulkWriteFailure;
import org.elasticsearch.hadoop.rest.bulk.handler.DelayableErrorCollector;

public class OutputToFileHandler extends BulkWriteErrorHandler { <a id="CO103-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private OutputStream outputStream;   <a id="CO103-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    private BufferedWriter writer;

    @Override
    public void init(Properties properties) {   <a id="CO103-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        try {
            outputStream = new FileOutputStream(properties.getProperty("filename"));   <a id="CO103-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            writer = new BufferedWriter(new OutputStreamWriter(outputStream));
        } catch (FileNotFoundException e) {
            throw new RuntimeException("Could not open file", e);
        }
    }

    @Override
    public HandlerResult onError(BulkWriteFailure entry, DelayableErrorCollector&lt;byte[]&gt; collector)   <a id="CO103-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
    throws Exception
    {
        writer.write("Code: " + entry.getResponseCode());
        writer.newLine();
        writer.write("Error: " + entry.getException().getMessage());
        writer.newLine();
        for (String message : entry.previousHandlerMessages()) {
            writer.write("Previous Handler: " + message);           <a id="CO103-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
            writer.newLine();
        }
        writer.write("Attempts: " + entry.getNumberOfAttempts());
        writer.newLine();
        writer.write("Entry: ");
        writer.newLine();
        IOUtils.copy(entry.getEntryContents(), writer);
        writer.newLine();

        return HandlerResult.HANDLED; <a id="CO103-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
    }

    @Override
    public void close() {   <a id="CO103-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
        try {
            writer.close();
            outputStream.close();
        } catch (IOException e) {
            throw new RuntimeException("Closing file failed", e);
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Extend the BulkWriteErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Some local state for writing data out to a file
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We override the <code class="literal">init</code> method. Any properties for this handler are passed in here.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We are extracting the file to write to from the properties. We’ll see how to set this property below.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Overriding the <code class="literal">onError</code> method to define our behavior.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Write out the error information. This highlights all the available data provided by the <code class="literal">BulkWriteFailure</code> object.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Return the <code class="literal">HANDLED</code> result to signal that the error is handled.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO103-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally, close out any internally allocated resources.
</p></td></tr></table></div><p>Added to this handler are the <code class="literal">init</code> and <code class="literal">close</code> methods. The <code class="literal">init</code> method is called when the handler is first created
at the start of the task and the <code class="literal">close</code> method is called when the task concludes. The <code class="literal">init</code> method accepts a properties
parameter, which contains any handler specific properties set by using <code class="literal">es.write.rest.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.rest.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>
</span></dt><dd>
Used to pass properties into handlers. HANDLER-NAME is the handler to be configured, and PROPERTY-NAME is the property
to set for the handler.
</dd></dl></div><p>In our use case, we will configure the our file logging error handler like so:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handler.writeFile = org.myproject.myhandlers.OutputToFileHandler   <a id="CO104-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.write.rest.error.handler.writeFile.filename = /path/to/some/output/file   <a id="CO104-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO104-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We register our new handler with the name <code class="literal">writeFile</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO104-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Now we set a property named <code class="literal">filename</code> for the <code class="literal">writeFile</code> handler. In the <code class="literal">init</code> method of the handler, this can be picked up by using <code class="literal">filename</code> as the property key.
</p></td></tr></table></div><p>Now to bring it all together with the previous example (ignoring conflicts):</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.rest.error.handlers = ignoreConflict,writeFile

es.write.rest.error.handler.ignoreConflict = org.myproject.myhandlers.IgnoreConflictsHandler

es.write.rest.error.handler.writeFile = org.myproject.myhandlers.OutputToFileHandler
es.write.rest.error.handler.writeFile.filename = /path/to/some/output/file</pre></div><p>You now have a chain of handlers that retries bulk rejections by default (HTTP Retry built-in handler), then ignores
any errors that are conflicts (our own ignore conflicts handler), then ignores any other errors by writing them out to
a file (our own output to file handler).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="errorhandlers-serialization"></a>Serialization Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Before sending data to Elasticsearch, elasticsearch-hadoop must serialize each document into a JSON bulk entry. It is during this
process that the bulk operation is determined, document metadata is extracted, and integration specific data structures
are converted into JSON documents. During this process, inconsistencies with record structure can cause exceptions to be
thrown during the serialization process. These errors often lead to failed tasks and halted processing.</p><p>Elasticsearch for Apache Hadoop provides an API to handle serialization errors at the record level. Error handlers for serialization are given:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The integration specific data structure that was unable to be serialized
</li><li class="listitem">
Exception encountered during serialization
</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Serialization Error Handlers are not yet available for Hive. Elasticsearch for Apache Hadoop uses Hive’s SerDe constructs to convert data into
bulk entries before being sent to the output format. SerDe objects do not have a cleanup method that is called when the
object ends its lifecycle. Because of this, we do not support serialization error handlers in Hive as they cannot be
closed at the end of the job execution.</p></div></div><p>There are a few default error handlers provided by the connector:</p><h4><a id="errorhandlers-serialization-log"></a>Drop and Log Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">log</code></p><p>When this handler is invoked it logs a message containing the data structure’s toString() contents that failed, the
error message, and any previous handler messages. After logging this message, the handler signals that the error has
been acknowledged, thus consuming/ignoring it.</p><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.write.data.error.handler.log.logger.name</code> (required)
</span></dt><dd>
The string name to use when creating the logger instance to log the errors. This setting is required if this handler is used.
</dd><dt><span class="term">
<code class="literal">es.write.data.error.handler.log.logger.class</code> (alternative to logger.name)
</span></dt><dd>
The class name to use when creating the logger instance to log the errors. This setting can be used instead of the
required setting <code class="literal">es.write.data.error.handler.log.logger.name</code>.
</dd><dt><span class="term">
<code class="literal">es.write.data.error.handler.log.logger.level</code> (default: WARN)
</span></dt><dd>
The logger level to use when logging the error message. Available options are <code class="literal">FATAL</code>, <code class="literal">ERROR</code>, <code class="literal">WARN</code>, <code class="literal">INFO</code>, <code class="literal">DEBUG</code>, and <code class="literal">TRACE</code>.
</dd></dl></div><h4><a id="errorhandlers-serialization-fail"></a>Abort on Failure Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">fail</code></p><p>When this handler is called it rethrows the error given to it and aborts. This handler is always loaded and automatically
placed at the end of the list of error handlers.</p><p>There are no configurations for this handler.</p><h4><a id="errorhandlers-serialization-es"></a>Elasticsearch Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">es</code></p><p>When this handler is invoked it converts the error given into a JSON document and inserts it into an Elasticsearch index.
When this indexing operation is complete, the handler can be configured to signal that the error is handled (default),
or pass the error along to the next handler in the chain. The ES handler serializes error information using its own
mapping of the Elastic Common Schema. This data can accept additional user provided metadata that can assist users in
searching and reporting on failures (see labels and tags settings below).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Error handlers are built to execute on a per record/error basis. The Elasticsearch Error Handler does not bulk
insert error information currently. Each error is inserted one at a time in order to ensure each record/error is handled.
This handler may not provide a very high throughput in cases where there are a large number of error events to handle. You
should try to design your jobs so that error handling is a relatively uncommon occurrence.</p></div></div><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.nodes</code> (default: "localhost" or currently configured nodes)
</span></dt><dd>
The comma separated string of node addresses to write errors to. It is recommended that this be a different cluster than
the one being written to (in order to avoid write contention).
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.port</code> (default: 9200 or currently configured port)
</span></dt><dd>
The http port to use when connecting to the Elasticsearch nodes.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.resource</code> (required)
</span></dt><dd>
The index to write error information into. It is highly recommended that this index be just for error information.
Does not support index patterns.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.inherit</code> (default: true)
</span></dt><dd>
Determines if the settings to create the client used for sending error information should inherit the same client settings
from the currently running job. By default, all client settings in the job configuration are inherited by this client.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.conf.&lt;CONFIGURATION&gt;</code> 
</span></dt><dd>
This configuration prefix is used to set client configuration values in the handler’s underlying ES client. This accepts
most of the settings documented in <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.label.&lt;LABEL&gt;</code> (optional)
</span></dt><dd>
A user defined label field that is added to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.tags</code> (optional)
</span></dt><dd>
The comma separated string of tags to add to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default</code> (default: HANDLED)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error is successfully written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">HANDLED</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default.reason</code> (optional)
</span></dt><dd>
In the case that the default return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for
the handler to pass the data along to the next handler in the chain.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error</code> (default: ABORT)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error cannot be written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">ABORT</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error.reason</code> (optional)
</span></dt><dd>
In the case that the error return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for the
handler to pass the data along to the next handler in the chain.
</dd></dl></div><h3><a id="errorhandlers-serialization-use"></a>Using Serialization Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure serialization error handlers, you must specify the handlers in order with the following properties.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.data.error.handlers</code>
</span></dt><dd>
Lists the names of the error handlers to use for serialization error handling, and the order that they should be called on.
Each default handler can be referenced by their handler name as the connector knows how to load them. Any handlers
provided from users or third party code will need to have their handler names defined with the <code class="literal">es.write.data.error.handler.</code>
prefix.
</dd></dl></div><p>For serialization failures, the Abort on Failure built-in handler is always placed as the last error handler to catch
any unhandled errors. This error handler forms the default serialization error handling behavior for elasticsearch-hadoop, which
matches the behavior from previous versions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Any configured user handlers will go here.
</li><li class="listitem">
Abort on Failure Built-In Handler: Rethrows the any errors it encounters
</li></ol></div><p>This behavior is modified by inserting handlers into the chain by using the handlers property. Let’s say that we want
to log ALL errors and ignore them.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handlers = log <a id="CO105-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO105-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log handler
</p></td></tr></table></div><p>With the above configuration, the handler list now looks like the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Drop and Log Handler
</li><li class="listitem">
Abort on Failure Handler
</li></ol></div><p>As described above, the built-in <code class="literal">log</code> error handler has a required setting: What to use for the logger name. The logger
used will respect whatever logging configuration you have in place, and thus needs a name for the logger to use:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handlers = log <a id="CO106-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.write.data.error.handler.log.logger.name = SerializationErrors <a id="CO106-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log built-in handler
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO106-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The Drop and Log built-in handler will log all errors to the <code class="literal">SerializationErrors</code> logger
</p></td></tr></table></div><p>At this point, the Abort on Failure built-in handler is effectively ignored since the Drop and Log built-in handler will
always mark an error as consumed. This practice can prove to be hazardous, as potentially important errors may simply be
ignored. In many cases, it is preferable for users to write their own error handler to handle expected exceptions.</p><h4><a id="errorhandlers-serialization-user-handlers"></a>Writing Your Own Serialization Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Let’s say that you are streaming some unstructured data to Elasticsearch. In this scenario, your data is not fully sanitized and
may contain field values that cannot be translated to JSON by the connector. You may not want to have your streaming job
fail on this data, as you are potentially expecting it to contain errors. In this situation, you may want to log the
data in a more comprehensive manner than to rely on the logging solution’s toString() method for your data.</p><p>Let’s write an error handler for this situation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.handler.ErrorCollector;
import org.elasticsearch.hadoop.serialization.handler.write.SerializationErrorHandler;
import org.elasticsearch.hadoop.serialization.handler.write.SerializationFailure;

public class CustomLogOnError extends SerializationErrorHandler {      <a id="CO107-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private Log logger = ???; <a id="CO107-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>

    @Override
    public HandlerResult onError(SerializationFailure entry, ErrorCollector&lt;Object&gt; collector) throws Exception {  <a id="CO107-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        MyRecord record = (MyRecord) entry.getRecord();                             <a id="CO107-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
        logger.error("Could not serialize record. " +
                "Record data : " + record.getSpecificField() + ", " + record.getOtherField(), entry.getException()); <a id="CO107-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
        return HandlerResult.HANDLED;                                               <a id="CO107-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We create a class and extend the SerializationErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Create a logger using preferred logging solution
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Override the <code class="literal">onError</code> method which will be invoked with the error details
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Retrieve the record that failed to be serialized. Cast it to the record type you are expecting from your job
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Log the specific information from the data you are interested in
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO107-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally after logging the error, return <code class="literal">HandlerResult.HANDLED</code> to signal that the error is acknowledged
</p></td></tr></table></div><p>Before we can place this handler in the list of serialization error handlers, we must register the handler class with a
name in the settings using <code class="literal">es.write.data.error.handler.[HANDLER-NAME]</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.data.error.handler.[HANDLER-NAME]</code>
</span></dt><dd>
Create a new handler named HANDLER-NAME. The value of this property must be the binary name of the class to
instantiate for this handler.
</dd></dl></div><p>In this case, lets register a handler name for our ignore conflicts handler:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handler.customLog = org.myproject.myhandlers.CustomLogOnError</pre></div><p>Now that we have a name for the handler, we can use it in the handler list:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handlers = customLog
es.write.data.error.handler.customLog = org.myproject.myhandlers.CustomLogOnError</pre></div><p>Now, your custom logging error handler will be invoked whenever a serialization failure occurs, and will instruct the
connector that it is ok with ignoring those failures to continue processing.</p><h4><a id="errorhandlers-serialization-advanced"></a>Advanced Concepts<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Instead of logging data and dropping it, what if you wanted to persist it somewhere for safe keeping? What if
we wanted to pass properties into our handlers to parameterize their behavior? Lets create a handler that stores error
information in a local file for later analysis.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import ...

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.handler.ErrorCollector;
import org.elasticsearch.hadoop.serialization.handler.write.SerializationErrorHandler;
import org.elasticsearch.hadoop.serialization.handler.write.SerializationFailure;

public class OutputToFileHandler extends SerializationErrorHandler { <a id="CO108-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private OutputStream outputStream;   <a id="CO108-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    private BufferedWriter writer;

    @Override
    public void init(Properties properties) {   <a id="CO108-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        try {
            outputStream = new FileOutputStream(properties.getProperty("filename"));   <a id="CO108-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            writer = new BufferedWriter(new OutputStreamWriter(outputStream));
        } catch (FileNotFoundException e) {
            throw new RuntimeException("Could not open file", e);
        }
    }

    @Override
    public HandlerResult onError(SerializationFailure entry, ErrorCollector&lt;Object&gt; collector)   <a id="CO108-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
    throws Exception
    {
        writer.write("Record: " + entry.getRecord().toString());
        writer.newLine();
        writer.write("Error: " + entry.getException().getMessage());
        writer.newLine();
        for (String message : entry.previousHandlerMessages()) {
            writer.write("Previous Handler: " + message);           <a id="CO108-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
            writer.newLine();
        }

        return HandlerResult.PASS; <a id="CO108-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
    }

    @Override
    public void close() {   <a id="CO108-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
        try {
            writer.close();
            outputStream.close();
        } catch (IOException e) {
            throw new RuntimeException("Closing file failed", e);
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Extend the SerializationErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Some local state for writing data out to a file
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We override the <code class="literal">init</code> method. Any properties for this handler are passed in here.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We are extracting the file to write to from the properties. We’ll see how to set this property below.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Overriding the <code class="literal">onError</code> method to define our behavior.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Write out the error information. This highlights all the available data provided by the <code class="literal">SerializationFailure</code> object.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Return the <code class="literal">PASS</code> result to signal that the error should be handed off to the next error handler in the chain.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally, close out any internally allocated resources.
</p></td></tr></table></div><p>Added to this handler are the <code class="literal">init</code> and <code class="literal">close</code> methods. The <code class="literal">init</code> method is called when the handler is first created
at the start of the task and the <code class="literal">close</code> method is called when the task concludes. The <code class="literal">init</code> method accepts a properties
parameter, which contains any handler specific properties set by using <code class="literal">es.write.data.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.write.data.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>
</span></dt><dd>
Used to pass properties into handlers. HANDLER-NAME is the handler to be configured, and PROPERTY-NAME is the property
to set for the handler.
</dd></dl></div><p>In our use case, we will configure the our file logging error handler like so:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handler.writeFile = org.myproject.myhandlers.OutputToFileHandler   <a id="CO109-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.write.data.error.handler.writeFile.filename = /path/to/some/output/file <a id="CO109-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We register our new handler with the name <code class="literal">writeFile</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO109-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Now we set a property named <code class="literal">filename</code> for the <code class="literal">writeFile</code> handler. In the <code class="literal">init</code> method of the handler, this can be picked up by using <code class="literal">filename</code> as the property key.
</p></td></tr></table></div><p>Now to bring it all together:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.write.data.error.handlers = writeFile,customLog

es.write.data.error.handler.customLog = org.myproject.myhandlers.CustomLogOnError

es.write.data.error.handler.writeFile = org.myproject.myhandlers.OutputToFileHandler
es.write.data.error.handler.writeFile.filename = /path/to/some/output/file</pre></div><p>You now have a chain of handlers that writes all relevant data about the failure to a file (our writeFile handler), then
logs the errors using a custom log line and ignores the error to continue processing (our customLog handler).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="errorhandlers-read-json"></a>Deserialization Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When reading data, the connector executes scroll requests against the configured indices and reads their contents. For
each hit in a scroll search result, the connector attempts to deserialize it into an integration specific record type.
When using MapReduce, this data type is either a MapWritable or Text (for raw JSON data). For an integration like
Spark SQL which uses data schemas, the resulting data type is a Row object.</p><p>Elasticsearch stores documents in lucene indices. These documents can sometimes have loose definitions, or have
structures that cannot be parsed into a schema-based data type, for one reason or another. Sometimes a field may be
in a format that cannot be read correctly.</p><p>Elasticsearch for Apache Hadoop provides an API to handle document level deserialization errors from scroll responses. Error handlers for scroll reads are given:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The raw JSON search result that was tried
</li><li class="listitem">
Exception encountered
</li></ul></div><p>Note: Deserialization Error Handlers only allow handling of errors that occur when parsing documents from scroll
responses. It may be possible that a search result can be successfully read, but is still malformed, thus causing an
exception when it is used in a completely different part of the framework. This Error Handler is called from the top of
the most reasonable place to handle exceptions in the scroll reading process, but this does not encapsulate all logic
for each integration.</p><p>There are a few default error handlers provided by the connector:</p><h4><a id="errorhandlers-read-json-log"></a>Drop and Log Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">log</code></p><p>When this handler is invoked it logs a message containing the JSON search hit that failed, the error message, and any previous
handler messages. After logging this message, the handler signals that the error has been acknowledged, thus
consuming/ignoring it.</p><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.read.data.error.handler.log.logger.name</code> (required)
</span></dt><dd>
The string name to use when creating the logger instance to log the errors. This setting is required if this handler is used.
</dd><dt><span class="term">
<code class="literal">es.read.data.error.handler.log.logger.class</code> (alternative to logger.name)
</span></dt><dd>
The class name to use when creating the logger instance to log the errors. This setting can be used instead of the
required setting <code class="literal">es.read.data.error.handler.log.logger.name</code>.
</dd><dt><span class="term">
<code class="literal">es.read.data.error.handler.log.logger.level</code> (default: WARN)
</span></dt><dd>
The logger level to use when logging the error message. Available options are <code class="literal">FATAL</code>, <code class="literal">ERROR</code>, <code class="literal">WARN</code>, <code class="literal">INFO</code>, <code class="literal">DEBUG</code>, and <code class="literal">TRACE</code>.
</dd></dl></div><h4><a id="errorhandlers-read-json-fail"></a>Abort on Failure Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">fail</code></p><p>When this handler is called it rethrows the error given to it and aborts. This handler is always loaded and automatically
placed at the end of the list of error handlers.</p><p>There are no configurations for this handler.</p><h4><a id="errorhandlers-read-json-es"></a>Elasticsearch Error Handler<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Default Handler Name: <code class="literal">es</code></p><p>When this handler is invoked it converts the error given into a JSON document and inserts it into an Elasticsearch index.
When this indexing operation is complete, the handler can be configured to signal that the error is handled (default),
or pass the error along to the next handler in the chain. The ES handler serializes error information using its own
mapping of the Elastic Common Schema. This data can accept additional user provided metadata that can assist users in
searching and reporting on failures (see labels and tags settings below).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Error handlers are built to execute on a per record/error basis. The Elasticsearch Error Handler does not bulk
insert error information currently. Each error is inserted one at a time in order to ensure each record/error is handled.
This handler may not provide a very high throughput in cases where there are a large number of error events to handle. You
should try to design your jobs so that error handling is a relatively uncommon occurrence.</p></div></div><p>Available configurations for this handler:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.nodes</code> (default: "localhost" or currently configured nodes)
</span></dt><dd>
The comma separated string of node addresses to write errors to. It is recommended that this be a different cluster than
the one being written to (in order to avoid write contention).
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.port</code> (default: 9200 or currently configured port)
</span></dt><dd>
The http port to use when connecting to the Elasticsearch nodes.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.resource</code> (required)
</span></dt><dd>
The index to write error information into. It is highly recommended that this index be just for error information.
Does not support index patterns.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.inherit</code> (default: true)
</span></dt><dd>
Determines if the settings to create the client used for sending error information should inherit the same client settings
from the currently running job. By default, all client settings in the job configuration are inherited by this client.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.client.conf.&lt;CONFIGURATION&gt;</code> 
</span></dt><dd>
This configuration prefix is used to set client configuration values in the handler’s underlying ES client. This accepts
most of the settings documented in <a class="xref" href="configuration.html" title="Configuration"><em>Configuration</em></a>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.label.&lt;LABEL&gt;</code> (optional)
</span></dt><dd>
A user defined label field that is added to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.tags</code> (optional)
</span></dt><dd>
The comma separated string of tags to add to each error event created by this handler. This field will be indexed into
the Elasticsearch index provided for this handler. Text data only.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default</code> (default: HANDLED)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error is successfully written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">HANDLED</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.default.reason</code> (optional)
</span></dt><dd>
In the case that the default return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for
the handler to pass the data along to the next handler in the chain.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error</code> (default: ABORT)
</span></dt><dd>
The handler result to be returned to the error handling framework when an error cannot be written to Elasticsearch.
Available values are <code class="literal">HANDLED</code>, <code class="literal">PASS</code>, and <code class="literal">ABORT</code>. Default result is <code class="literal">ABORT</code>.
</dd><dt><span class="term">
<code class="literal">es.write.rest.error.handler.es.return.error.reason</code> (optional)
</span></dt><dd>
In the case that the error return value is <code class="literal">PASS</code>, this optional text setting allows a user to specify the reason for the
handler to pass the data along to the next handler in the chain.
</dd></dl></div><h3><a id="errorhandlers-read-json-use"></a>Using Deserialization Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To configure deserialization error handlers, you must specify the handlers in order with the following properties.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.read.data.error.handlers</code>
</span></dt><dd>
Lists the names of the error handlers to use for deserialization error handling, and the order that they should be called on.
Each default handler can be referenced by their handler name as the connector knows how to load them. Any handlers
provided from users or third party code will need to have their handler names defined with the <code class="literal">es.read.data.error.handler.</code>
prefix.
</dd></dl></div><p>For deserialization failures, the Abort on Failure built-in handler is always placed as the last error handler to catch
any unhandled errors. This error handler alone forms the default deserialization error handling behavior for elasticsearch-hadoop, which
matches the behavior from previous versions.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Any configured user handlers will go here.
</li><li class="listitem">
Abort on Failure Built-In Handler: Rethrows the any errors it encounters
</li></ol></div><p>This behavior is modified by inserting handlers into the chain by using the handlers property. Let’s say that we want
to log ALL errors and ignore them.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handlers = log <a id="CO110-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO110-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log handler
</p></td></tr></table></div><p>With the above configuration, the handler list now looks like the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Drop and Log Handler
</li><li class="listitem">
Abort on Failure Handler
</li></ol></div><p>As described above, the built-in <code class="literal">log</code> error handler has a required setting: What to use for the logger name. The logger
used will respect whatever logging configuration you have in place, and thus needs a name for the logger to use:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handlers = log <a id="CO111-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.read.data.error.handler.log.logger.name = DeserializationErrors <a id="CO111-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifying the default Drop and Log built-in handler
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO111-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The Drop and Log built-in handler will log all errors to the <code class="literal">DeserializationErrors</code> logger
</p></td></tr></table></div><p>At this point, the Abort on Failure built-in handler is effectively ignored since the Drop and Log built-in handler will
always mark an error as consumed. This practice can prove to be hazardous, as potentially important errors may simply be
ignored. In many cases, it is preferable for users to write their own error handler to handle expected exceptions.</p><h4><a id="errorhandlers-read-json-user-handlers"></a>Writing Your Own Deserialization Error Handlers<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Let’s say that you are reading a large index of log data from Elasticsearch. In this scenario, your log data is highly
unstructured, and not all of its contents are critical to your process. Due to the volume of data being read, your job
takes a long time to complete. In this case, you might want to replace records that cannot be read with a dummy record
to mark the failure, and not interrupt your processing. The offending data should be logged and dropped.</p><p>Let’s write an error handler for this situation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.handler.ErrorCollector;
import org.elasticsearch.hadoop.serialization.handler.read.DeserializationErrorHandler;
import org.elasticsearch.hadoop.serialization.handler.read.DeserializationFailure;

public class ReturnDummyHandler extends DeserializationErrorHandler { <a id="CO112-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private static final Logger LOGGER = ...; <a id="CO112-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    private static final String DUMMY_RECORD = "..."; <a id="CO112-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>

    @Override
    public HandlerResult onError(DeserializationFailure entry, ErrorCollector&lt;byte[]&gt; collector) <a id="CO112-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
    throws Exception
    {
        BufferedReader reader = new BufferedReader(new InputStreamReader(entry.getHitContents()));
        StringBuilder hitContent = new StringBuilder();
        for (String line = reader.readLine(); line != null; line = reader.readLine()) {           <a id="CO112-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
            hitContent.append(line);
        }
        LOGGER.warn("Encountered malformed record during read. Replacing with dummy record. " +   <a id="CO112-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
                            "Malformed Data: " + hitContent, entry.getException());
        return collector.retry(DUMMY_RECORD.getBytes());                                         <a id="CO112-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We create a class and extend the DeserializationErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Create a logger using preferred logging solution
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We create a String to use for our dummy record that should be deserialized instead
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Override the <code class="literal">onError</code> method which will be invoked with the error details
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We read the contents of the failed search hit as a String
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We log the contents of the failed document, as well as the exception that details the cause of the failure
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO112-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally, we return the dummy data contents to be deserialized.
</p></td></tr></table></div><p>Before we can place this handler in the list of deserialization error handlers, we must register the handler class with a
name in the settings using <code class="literal">es.read.data.error.handler.[HANDLER-NAME]</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.read.data.error.handler.[HANDLER-NAME]</code>
</span></dt><dd>
Create a new handler named HANDLER-NAME. The value of this property must be the binary name of the class to
instantiate for this handler.
</dd></dl></div><p>In this case, lets register a handler name for our dummy record handler:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handler.returnDummy = org.myproject.myhandlers.ReturnDummyHandler</pre></div><p>Now that we have a name for the handler, we can use it in the handler list:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handlers = returnDummy
es.read.data.error.handler.returnDummy = org.myproject.myhandlers.ReturnDummyHandler</pre></div><p>Now, your dummy data error handler will be invoked whenever a deserialization failure occurs, and will instruct the
connector to use your provided dummy record instead of the malformed data.</p><h4><a id="errorhandlers-read-json-advanced"></a>Advanced Concepts<a href="https://github.com/elastic/elasticsearch-hadoop/edit/master/docs/src/reference/asciidoc/core/errorhandlers.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>What if instead of logging data and dropping it, what if you wanted to persist it somewhere for safe keeping? What if
we wanted to pass properties into our handlers to parameterize their behavior? Lets create a handler that stores error
information in a local file for later analysis.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-java">package org.myproject.myhandlers;

import ...

import org.elasticsearch.hadoop.handler.HandlerResult;
import org.elasticsearch.hadoop.handler.ErrorCollector;
import org.elasticsearch.hadoop.serialization.handler.read.DeserializationErrorHandler;
import org.elasticsearch.hadoop.serialization.handler.read.DeserializationFailure;

public class ReturnDummyAndLogToFileHandler extends DeserializationErrorHandler { <a id="CO113-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>

    private static final String DUMMY_RECORD = "...";

    private OutputStream outputStream;   <a id="CO113-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    private BufferedWriter writer;

    @Override
    public void init(Properties properties) {   <a id="CO113-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        try {
            outputStream = new FileOutputStream(properties.getProperty("filename"));   <a id="CO113-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            writer = new BufferedWriter(new OutputStreamWriter(outputStream));
        } catch (FileNotFoundException e) {
            throw new RuntimeException("Could not open file", e);
        }
    }

    @Override
    public HandlerResult onError(DeserializationFailure entry, ErrorCollector&lt;byte[]&gt; collector)   <a id="CO113-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
    throws Exception
    {
        BufferedReader reader = new BufferedReader(new InputStreamReader(entry.getHitContents()));
        StringBuilder hitContent = new StringBuilder();
        for (String line = reader.readLine(); line != null; line = reader.readLine()) {           <a id="CO113-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
            hitContent.append(line);
        }

        writer.write("Error: " + entry.getException().getMessage());
        writer.newLine();
        for (String message : entry.previousHandlerMessages()) {
            writer.write("Previous Handler: " + message);           <a id="CO113-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
            writer.newLine();
        }
        writer.write("Entry: ");
        writer.newLine();
        writer.write(hitContent.toString());
        writer.newLine();

        return collector.retry(DUMMY_RECORD.getBytes());            <a id="CO113-8"></a><span><img src="images/icons/callouts/8.png" alt="" /></span>
    }

    @Override
    public void close() {   <a id="CO113-9"></a><span><img src="images/icons/callouts/9.png" alt="" /></span>
        try {
            writer.close();
            outputStream.close();
        } catch (IOException e) {
            throw new RuntimeException("Closing file failed", e);
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Extend the DeserializationErrorHandler base class
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Some local state for writing data out to a file
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We override the <code class="literal">init</code> method. Any properties for this handler are passed in here
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We are extracting the file to write to from the properties. We’ll see how to set this property below
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Overriding the <code class="literal">onError</code> method to define our behavior
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Read the contents of the failed search hit
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Write out the error information. This highlights all the available data provided by the <code class="literal">DeserializationFailure</code> object
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-8"><span><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Perform a retry operation, using our dummy record
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO113-9"><span><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Finally, close out any internally allocated resources
</p></td></tr></table></div><p>Added to this handler are the <code class="literal">init</code> and <code class="literal">close</code> methods. The <code class="literal">init</code> method is called when the scroll query is first
created at the start of the task and the <code class="literal">close</code> method is called when the scroll query is closed when the task
concludes. The <code class="literal">init</code> method accepts a properties parameter, which contains any handler specific properties set by
using <code class="literal">es.read.data.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Setting <code class="literal">es.read.data.error.handler.[HANDLER-NAME].[PROPERTY-NAME]</code>
</span></dt><dd>
Used to pass properties into handlers. HANDLER-NAME is the handler to be configured, and PROPERTY-NAME is the property
to set for the handler.
</dd></dl></div><p>In our use case, we will configure the our file logging error handler like so:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handler.writeFile = org.myproject.myhandlers.ReturnDummyAndLogToFileHandler   <a id="CO114-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
es.read.data.error.handler.writeFile.filename = /path/to/some/output/file   <a id="CO114-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO114-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
We register our new handler with the name <code class="literal">writeFile</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO114-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Now we set a property named <code class="literal">filename</code> for the <code class="literal">writeFile</code> handler. In the <code class="literal">init</code> method of the handler, this can be picked up by using <code class="literal">filename</code> as the property key.
</p></td></tr></table></div><p>Now to bring it all together with the previous example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-ini">es.read.data.error.handlers = writeFile
es.read.data.error.handler.writeFile = org.myproject.myhandlers.ReturnDummyAndLogToFileHandler
es.read.data.error.handler.writeFile.filename = /path/to/some/output/file</pre></div><p>You now have a handler that retries replaces malformed data with dummy records, then logs those malformed records along
with their error information by writing them out to a custom file.</p></div></div><div class="navfooter"><span class="prev"><a href="mapping.html">
              « 
              Mapping and Types</a>
           
        </span><span class="next">
           
          <a href="metrics.html">Hadoop Metrics
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
					<div id="rtpcontainer" style="display: block;">
						<div class="mktg-promo">
						<h3>Getting Started Videos</h3>
						<ul class="icons">
							<li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
							<li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
							<li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
						</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

        </div>
      	


<div id="footer-subscribe" class="home-footer-subscribe">
  <div class="subscribe-wrapper">
    <div class="container">
      <div class="subscribe-form-container">
        <div class="subscribe-title col-md-12 col-lg-6">
            <h5>Be in the know with the latest and greatest from Elastic.</h5>
        </div>
        <div class="subscribe-form col-md-12 col-lg-6">
          <form class="mktoForm sb-form"></form>
        </div>
      </div>
      <div class="form_thanks hide">
        
          <p>Thanks for subscribing! We'll keep you updated with new releases.</p>
        
      </div>
    </div>
  </div>
</div>
<!--subscribe newsletter end-->

<!-- Footer Section -->
<footer class="footer-wrapper">
  <div class="container">
    <div class="row footer-content">
        
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/products">Products ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/products/elasticsearch">Elasticsearch</a></li>
                  
                
              
                
                  
                    <li><a href="/products/kibana">Kibana</a></li>
                  
                
              
                
                  
                    <li><a href="/products/beats">Beats</a></li>
                  
                
              
                
                  
                    <li><a href="/products/logstash">Logstash</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack">Stack Features (formerly X-Pack)</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/security">Security</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/alerting">Alerting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/canvas">Canvas</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/monitoring">Monitoring</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/graph">Graph</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/reporting">Reporting</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/machine-learning">Machine Learning</a></li>
                  
                
              
                
                  
                    <li><a href="/products/stack/elasticsearch-sql">Elasticsearch SQL</a></li>
                  
                
              
                
                  
                    <li><a href="/products/hadoop">Elasticsearch-Hadoop</a></li>
                  
                
              
                
                  
                    <li><a href="/products/ece">Elastic Cloud Enterprise</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/solutions">Solutions ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/solutions/logging">Logging</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/metrics">Metrics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/site-search">Site Search</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/security-analytics">Security Analytics</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/apm">APM</a></li>
                  
                
              
                
                  
                    <li><a href="/solutions/app-search">App Search</a></li>
                  
                
              
              </ul>
              
                <h3><a href="/cloud">Elastic Cloud ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/cloud/elasticsearch-service">Elasticsearch Service</a></li>
                  
                
              
                
                  
                    <li><a href="/aws-elasticsearch-service">AWS Elasticsearch Service Comparison</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/app-search-service">Elastic App Search Service</a></li>
                  
                
              
                
                  
                    <li><a href="/cloud/site-search-service">Elastic Site Search Service</a></li>
                  
                
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3>Resources</h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/blog">Blog</a></li>
                  
                
              
                
                  
                    <li><a href="https://cloud-status.elastic.co">Cloud Status</a></li>
                  
                
              
                
                  
                    <li><a href="/community">Community</a></li>
                  
                
              
                
                  
                    <li><a href="/use-cases">Customers & Use Cases</a></li>
                  
                
              
                
                  
                    <li><a href="/guide">Documentation</a></li>
                  
                
              
                
                  
                    <li><a href="/elasticon">Elastic{ON} Events</a></li>
                  
                
              
                
                  
                    <li><a href="https://discuss.elastic.co/">Forums</a></li>
                  
                
              
                
                  
                    <li><a href="/community/meetups">Meetups</a></li>
                  
                
              
                
                  
                    <li><a href="/subscriptions">Subscriptions</a></li>
                  
                
              
                
                  
                    <li><a href="https://support.elastic.co">Support Portal</a></li>
                  
                
              
                
                  
                    <li><a href="/videos">Videos & Webinars</a></li>
                  
                
              
                
                  
                    <li><a href="/training">Training</a></li>
                  
                
              
              </ul>
              
                <h3></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
      
          <div class="col-xs-6 col-sm-3 col-md-3">
              
                <h3><a href="/about">About ></a></h3>
              
              
              
              <ul class="">
              
                
                  
                    <li><a href="/about/careers">Careers/Jobs</a></li>
                  
                
              
                
                  
                    <li><a href="/about/our-source-code">Our Source Code</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams">Teams</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/board">Board of Directors</a></li>
                  
                
              
                
                  
                    <li><a href="/about/teams/leadership">Leadership</a></li>
                  
                
              
                
                  
                    <li><a href="/contact">Contact</a></li>
                  
                
              
                
                  
                    <li><a href="/about/history-of-elasticsearch">Our Story</a></li>
                  
                
              
                
                  
                    <li><a href="/about/why-open-source">Why Open Source</a></li>
                  
                
              
                
                  
                    <li><a href="/about/distributed">Distributed by Intention</a></li>
                  
                
              
                
                  
                    <li><a href="/about/partners">Partners</a></li>
                  
                
              
                
                  
                    <li><a href="/about/press">Media</a></li>
                  
                
              
                
                  
                    <li><a href="https://ir.elastic.co">Investor Relations</a></li>
                  
                
              
                
                  
                    <li><a href="https://www.elastic.shop">Elastic Store</a></li>
                  
                
              
              </ul>
              
                <h3><a href=""></a></h3>
              
              
              
              <ul class="">
              
              </ul>
          </div>    
       
    </div>
     <!-- Social Media Section -->
    <div class="row social-icon">
      <div class="col-xs-12 col-sm-12 col-md-6 col-md-offset-3">
	    <div class="row">
		     <div class="follow-us col-xs-12 col-sm-12 col-md-12">
			    <div class="social-label">FOLLOW US</div>
			    <ul class="social-icon-list">
          
          		 	<li class="Facebook"><a id="footer_facebook" href="https://www.facebook.com/elastic.co">Facebook</a></li>
          
          		 	<li class="Twitter"><a id="footer_twitter" href="https://www.twitter.com/elastic">Twitter</a></li>
          
          		 	<li class="LinkedIn"><a id="footer_linkedin" href="https://www.linkedin.com/company/elastic-co">LinkedIn</a></li>
          
          		 	<li class="Xing"><a id="footer_xing" href="https://www.xing.com/companies/elastic.co">Xing</a></li>
          
          		 	<li class="YouTube"><a id="footer_youtube" href="https://www.youtube.com/user/elasticsearch">YouTube</a></li>
          
		  		</ul>
		     </div>
	    </div>
      </div>
    </div>
    <!-- Social Media Section end-->
    <div class="row">
	<div class="col-xs-12 col-sm-12 col-md-11">
		<div class="copyright">
			<ul>
				<li><a href="/legal/trademarks">Trademarks</a></li>
				<li><a href="/legal/terms-of-use">Terms of Use</a></li>
				<li><a href="/legal/privacy-statement">Privacy</a></li>
				<li><a href="/brand">Brand</a></li>
			</ul>
			<div class="copyright-content">
				<div class="footer-text">
					<p>© 2018. Elasticsearch B.V. All Rights Reserved
					</p>
					<p>Elasticsearch is a trademark of Elasticsearch B.V., registered in the U.S. and in other countries.
					</p>
					<p>Apache, Apache Lucene, Apache Hadoop, Hadoop, HDFS and the yellow elephant logo are trademarks of the <a href="http://www.apache.org/">Apache Software Foundation</a> in the United States and/or other countries.
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-2 col-xs-offset-5 col-sm-1 col-sm-offset-5 col-md-1 col-md-offset-0">
		<div class="footer-logo"><a href="/"><img src="/static/images/svg/logo-elastic-footer-stacked-999.svg" class="img-responsive"></a>
		</div>
	</div>
</div>
  </div>
</footer>
<!-- Footer Section end-->

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
