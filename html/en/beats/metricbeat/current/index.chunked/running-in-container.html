<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Running Metricbeat in a Container
        | Metricbeat Reference [5.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Metricbeat Reference [5.3]" /><link rel="up" href="index.html" title="Metricbeat Reference [5.3]" /><link rel="prev" href="key-features.html" title="Key Metricbeat Features" /><link rel="next" href="configuring-howto-metricbeat.html" title="Configuring Metricbeat" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Metricbeat/Reference/5.3" /></head><body><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Metricbeat Reference
      [5.3]
    </a></span> » <span class="breadcrumb-node">Running Metricbeat in a Container</span></div><div xmlns="" class="navheader"><span class="prev"><a href="key-features.html">
              « 
              Key Metricbeat Features</a>
           
        </span><span class="next">
           
          <a href="configuring-howto-metricbeat.html">Configuring Metricbeat
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="running-in-container"></a>Running Metricbeat in a Container<a xmlns="" href="https://github.com/elastic/beats/edit/5.3/metricbeat/docs/metricbeat-in-a-container.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p>Elastic does not provide any official container images for Metricbeat. The
examples on this page assume you are using your own Metricbeat container image.</p><p>When executing Metricbeat in a container, there are some important
things to be aware of if you want to monitor the host machine or other
containers. Let’s walk-through some examples using Docker as our container
orchestration tool.</p><h3><a id="monitoring-host"></a>Monitoring the Host Machine<a xmlns="" href="https://github.com/elastic/beats/edit/5.3/metricbeat/docs/metricbeat-in-a-container.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>This example highlights the changes required to make the system module
work properly inside of a container. This enables Metricbeat to monitor the
host machine from within the container.</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo docker run \
  --volume=/proc:/hostfs/proc:ro \ <a id="CO3-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
  --volume=/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro \ <a id="CO3-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span>
  --volume=/:/hostfs:ro \ <a id="CO3-3"></a><span xmlns=""><img src="images/icons/callouts/3.png" alt="" /></span>
  --net=host <a id="CO3-4"></a><span xmlns=""><img src="images/icons/callouts/4.png" alt="" /></span>
  my/metricbeat:latest -system.hostfs=/hostfs</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Metricbeat’s <a class="link" href="metricbeat-module-system.html" title="System Module">system module</a> collects much of its data through the Linux proc
filesystem, which is normally located at <code class="literal">/proc</code>. Because containers
are isolated as much as possible from the host, the data inside of the
container’s <code class="literal">/proc</code> is different than the host’s <code class="literal">/proc</code>. To account for this, you
can mount the host’s <code class="literal">/proc</code> filesystem inside of the container and tell
Metricbeat to look inside the <code class="literal">/hostfs</code> directory when looking for <code class="literal">/proc</code> by
using the <code class="literal">-system.hostfs=/hostfs</code> CLI flag.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If cgroup reporting is enabled for the
<a class="link" href="metricbeat-metricset-system-process.html" title="System Process Metricset">system process metricset</a>, then you need
to mount the host’s cgroup mountpoints within the container. They need to be
mounted inside the directory specified by the <code class="literal">-system.hostfs</code> CLI flag.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-3"><span xmlns=""><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If you want to be able to monitor filesystems from the host by using the
<a class="link" href="metricbeat-metricset-system-filesystem.html" title="System Filesystem Metricset">system filesystem metricset</a>, then those filesystems need to be mounted inside
of the container. They can be mounted at any location.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-4"><span xmlns=""><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <a class="link" href="metricbeat-metricset-system-network.html" title="System Network Metricset">system network metricset</a> uses data from <code class="literal">/proc/net/dev</code>, or
<code class="literal">/hostfs/proc/net/dev</code> when using <code class="literal">-system.hostfs=/hostfs</code>. The only way
to make this file contain the host’s network devices is to use the <code class="literal">--net=host</code>
flag. This is due to Linux namespacing; simply bind mounting the host’s <code class="literal">/proc</code>
to <code class="literal">/hostfs/proc</code> is not sufficient.
</p></td></tr></table></div><h3><a id="monitoring-service"></a>Monitoring a Service in Another Container<a xmlns="" href="https://github.com/elastic/beats/edit/5.3/metricbeat/docs/metricbeat-in-a-container.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Next let’s look at an example of monitoring a containerized service from a
Metricbeat container.</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo docker run \
  --link some-mysql:mysql \ <a id="CO4-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
  -e MYSQL_PASSWORD=secret \ <a id="CO4-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span>
  my/metricbeat:latest</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Linking the containers enables Metricbeat access the exposed ports of the
mysql container, and it makes the hostname <code class="literal">mysql</code> resolvable to Metricbeat.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
If you do not want to hardcode certain values into your Metricbeat
configuration, then you can pass them into the container either as environment
variables or as command line flags to Metricbeat (see the <code class="literal">-E</code> CLI flag in <a class="xref" href="command-line-options.html" title="Command Line Options">Command Line Options</a>).
</p></td></tr></table></div><p>The mysql module configuration would look like this:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">metricbeat.modules:
- module: mysql
  metricsets: ["status"]
  hosts: ["mysql:3306"] <a id="CO5-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
  username: root
  password: ${MYSQL_PASSWORD} <a id="CO5-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">mysql</code> hostname will resolve to the <code class="literal">some-mysql</code> container’s address.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">MYSQL_PASSWORD</code> variable will be evaluated at startup. If the variable
is not set, this will lead to an error at startup.
</p></td></tr></table></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="key-features.html">
              « 
              Key Metricbeat Features</a>
           
        </span><span class="next">
           
          <a href="configuring-howto-metricbeat.html">Configuring Metricbeat
               »
            </a></span></div></body></html>